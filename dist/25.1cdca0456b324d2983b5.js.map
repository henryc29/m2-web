{"version":3,"sources":["webpack:///./components/authorize/authorize.jsx","webpack:///./components/authorize/index.js","webpack:///./components/form_error.tsx"],"names":["Authorize","React","PureComponent","propTypes","location","PropTypes","object","isRequired","actions","shape","getOAuthAppInfo","func","allowOAuth2","constructor","props","searchParams","URLSearchParams","search","params","responseType","get","clientId","redirectUri","state","scope","then","data","error","redirect","window","href","setState","message","startsWith","browserHistory","replace","componentDidMount","blocker","document","getElementById","parentNode","removeChild","test","app","render","icon","icon_url","icon50","appName","name","handleDeny","handleAllow","mapDispatchToProps","dispatch","bindActionCreators","connect","FormError","errors","iconClassName","margin","textClassName","type","length","err"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEe,MAAMA,SAAN,SAAwBC,4CAAK,CAACC,aAA9B,CAA4C;AACvD,aAAWC,SAAX,GAAuB;AACnB,WAAO;AACHC,cAAQ,EAAEC,iDAAS,CAACC,MAAV,CAAiBC,UADxB;AAEHC,aAAO,EAAEH,iDAAS,CAACI,KAAV,CAAgB;AACrBC,uBAAe,EAAEL,iDAAS,CAACM,IAAV,CAAeJ,UADX;AAErBK,mBAAW,EAAEP,iDAAS,CAACM,IAAV,CAAeJ;AAFP,OAAhB,EAGNA;AALA,KAAP;AAOH;;AAEDM,aAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;;AADe,yCAyBL,MAAM;AAChB,YAAMC,YAAY,GAAG,IAAIC,eAAJ,CAAoB,KAAKF,KAAL,CAAWV,QAAX,CAAoBa,MAAxC,CAArB;AACA,YAAMC,MAAM,GAAG;AACXC,oBAAY,EAAEJ,YAAY,CAACK,GAAb,CAAiB,eAAjB,CADH;AAEXC,gBAAQ,EAAEN,YAAY,CAACK,GAAb,CAAiB,WAAjB,CAFC;AAGXE,mBAAW,EAAEP,YAAY,CAACK,GAAb,CAAiB,cAAjB,CAHF;AAIXG,aAAK,EAAER,YAAY,CAACK,GAAb,CAAiB,OAAjB,CAJI;AAKXI,aAAK,EAAET,YAAY,CAACK,GAAb,CAAiB,OAAjB;AALI,OAAf;AAQA,WAAKN,KAAL,CAAWN,OAAX,CAAmBI,WAAnB,CAA+BM,MAA/B,EAAuCO,IAAvC,CACI,CAAC;AAACC,YAAD;AAAOC;AAAP,OAAD,KAAmB;AACf,YAAID,IAAI,IAAIA,IAAI,CAACE,QAAjB,EAA2B;AACvBC,gBAAM,CAACzB,QAAP,CAAgB0B,IAAhB,GAAuBJ,IAAI,CAACE,QAA5B;AACH,SAFD,MAEO,IAAID,KAAJ,EAAW;AACd,eAAKI,QAAL,CAAc;AAACJ,iBAAK,EAAEA,KAAK,CAACK;AAAd,WAAd;AACH;AACJ,OAPL;AASH,KA5CkB;;AAAA,wCA8CN,MAAM;AACf,YAAMV,WAAW,GAAI,IAAIN,eAAJ,CAAoB,KAAKF,KAAL,CAAWV,QAAX,CAAoBa,MAAxC,CAAD,CAAkDG,GAAlD,CAAsD,cAAtD,CAApB;;AACA,UAAIE,WAAW,CAACW,UAAZ,CAAuB,UAAvB,KAAsCX,WAAW,CAACW,UAAZ,CAAuB,SAAvB,CAA1C,EAA6E;AACzEJ,cAAM,CAACzB,QAAP,CAAgB0B,IAAhB,GAAuBR,WAAW,GAAG,sBAArC;AACA;AACH;;AAEDY,2EAAc,CAACC,OAAf,CAAuB,QAAvB;AACH,KAtDkB;;AAGf,SAAKZ,KAAL,GAAa,EAAb;AACH;;AAEDa,mBAAiB,GAAG;AAChB;AACA,UAAMC,OAAO,GAAGC,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAhB;;AACA,QAAIF,OAAJ,EAAa;AACTA,aAAO,CAACG,UAAR,CAAmBC,WAAnB,CAA+BJ,OAA/B;AACH;;AACD,UAAMhB,QAAQ,GAAI,IAAIL,eAAJ,CAAoB,KAAKF,KAAL,CAAWV,QAAX,CAAoBa,MAAxC,CAAD,CAAkDG,GAAlD,CAAsD,WAAtD,CAAjB;;AACA,QAAI,CAAG,aAAD,CAAgBsB,IAAhB,CAAqBrB,QAArB,CAAN,EAAuC;AACnC;AACH;;AAED,SAAKP,KAAL,CAAWN,OAAX,CAAmBE,eAAnB,CAAmCW,QAAnC,EAA6CI,IAA7C,CACI,CAAC;AAACC;AAAD,KAAD,KAAY;AACR,UAAIA,IAAJ,EAAU;AACN,aAAKK,QAAL,CAAc;AAACY,aAAG,EAAEjB;AAAN,SAAd;AACH;AACJ,KALL;AAMH;;AAiCDkB,QAAM,GAAG;AACL,UAAMD,GAAG,GAAG,KAAKpB,KAAL,CAAWoB,GAAvB;;AACA,QAAI,CAACA,GAAL,EAAU;AACN,aAAO,IAAP;AACH;;AAED,QAAIE,IAAJ;;AACA,QAAIF,GAAG,CAACG,QAAR,EAAkB;AACdD,UAAI,GAAGF,GAAG,CAACG,QAAX;AACH,KAFD,MAEO;AACHD,UAAI,GAAGE,4DAAP;AACH;;AAED,QAAIpB,KAAJ;;AACA,QAAI,KAAKJ,KAAL,CAAWI,KAAf,EAAsB;AAClBA,WAAK,gBACD;AAAK,iBAAS,EAAC;AAAf,sBACI,2DAAC,6DAAD;AAAW,aAAK,EAAE,KAAKJ,KAAL,CAAWI;AAA7B,QADJ,CADJ;AAKH;;AAED,wBACI;AAAK,eAAS,EAAC;AAAf,oBACI;AAAK,eAAS,EAAC;AAAf,oBACI;AAAK,eAAS,EAAC;AAAf,oBACI;AAAK,eAAS,EAAC;AAAf,oBACI;AACI,SAAG,EAAE,aADT;AAEI,SAAG,EAAEkB,IAFT;AAGI,WAAK,EAAC,IAHV;AAII,YAAM,EAAC;AAJX,MADJ,CADJ,eASI;AAAK,eAAS,EAAC;AAAf,oBACI,2DAAC,kFAAD;AACI,QAAE,EAAC,iBADP;AAEI,oBAAc,EAAC,wEAFnB;AAGI,YAAM,EAAE;AACJG,eAAO,EAAEL,GAAG,CAACM;AADT;AAHZ,MADJ,CATJ,CADJ,eAoBI,mFACI,2DAAC,kFAAD;AACI,QAAE,EAAC,eADP;AAEI,oBAAc,EAAC,2FAFnB;AAGI,YAAM,EAAE;AACJD,eAAO,EAAEL,GAAG,CAACM;AADT;AAHZ,MADJ,CApBJ,eA6BI;AAAI,eAAS,EAAC;AAAd,oBACI,2DAAC,kFAAD;AACI,QAAE,EAAC,kBADP;AAEI,oBAAc,EAAC,6BAFnB;AAGI,YAAM,EAAE;AACJD,eAAO,EAAEL,GAAG,CAACM;AADT;AAHZ,MADJ,CA7BJ,eAsCI;AAAK,eAAS,EAAC;AAAf,oBACI;AACI,UAAI,EAAC,QADT;AAEI,eAAS,EAAC,4BAFd;AAGI,aAAO,EAAE,KAAKC;AAHlB,oBAKI,2DAAC,2DAAD;AACI,QAAE,EAAC,gBADP;AAEI,oBAAc,EAAC;AAFnB,MALJ,CADJ,eAWI;AACI,UAAI,EAAC,QADT;AAEI,eAAS,EAAC,+BAFd;AAGI,aAAO,EAAE,KAAKC;AAHlB,oBAKI,2DAAC,2DAAD;AACI,QAAE,EAAC,iBADP;AAEI,oBAAc,EAAC;AAFnB,MALJ,CAXJ,CAtCJ,EA4DKxB,KA5DL,CADJ,CADJ;AAkEH;;AA3JsD;AAAA;AAAA;AAAA;AAAA;;AAAA;;;;;;;;;;0BAAtC3B,S;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACbrB;AACA;AAEA;AACA;AAEA;AAEA;;AAEA,SAASoD,kBAAT,CAA4BC,QAA5B,EAAsC;AAClC,SAAO;AACH7C,WAAO,EAAE8C,gEAAkB,CAAC;AACxB5C,gGADwB;AAExBE,wFAAWA;AAFa,KAAD,EAGxByC,QAHwB;AADxB,GAAP;AAMH;;iBAEcE,2DAAO,CAAC,IAAD,EAAOH,kBAAP,CAAP,CAAkCpD,kDAAlC,C;;AAAA;;;;;;;;;;0BATNoD,kB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACVT;AACA;CAIA;;AAUe,MAAMI,SAAN,SAAwBvD,4CAAK,CAACC,aAA9B,CAAmD;AAKvD0C,QAAP,GAAgB;AACZ,UAAM;AAACjB,WAAK,GAAG,IAAT;AAAe8B,YAAM,GAAG,EAAxB;AAA4BC,mBAA5B;AAA2CC,YAA3C;AAAmDC,mBAAnD;AAAkEC;AAAlE,QAA0E,KAAK/C,KAArF;;AAEA,QAAI,CAACa,KAAD,IAAU8B,MAAM,CAACK,MAAP,KAAkB,CAAhC,EAAmC;AAC/B,aAAO,IAAP;AACH,KALW,CAOZ;;;AACA,QAAI9B,OAAO,GAAGL,KAAd;;AAEA,QAAI,CAACK,OAAL,EAAc;AACV,WAAK,MAAM+B,GAAX,IAAkBN,MAAlB,EAA0B;AACtB,YAAIM,GAAJ,EAAS;AACL/B,iBAAO,GAAG+B,GAAV;AACH;AACJ;AACJ;;AAED,QAAI,CAAC/B,OAAL,EAAc;AACV,aAAO,IAAP;AACH;;AAED,QAAI6B,IAAI,KAAK,OAAb,EAAsB;AAClB,0BACI;AAAK,iBAAS,EAAC;AAAf,sBACI;AAAO,iBAAS,EAAC;AAAjB,SACK7B,OADL,CADJ,CADJ;AAOH;;AAED,QAAI6B,IAAI,KAAK,WAAb,EAA0B;AACtB,0BACI;AAAK,iBAAS,EAAC;AAAf,sBACI;AAAO,iBAAS,EAAC;AAAjB,SACK7B,OADL,CADJ,CADJ;AAOH;;AAED,QAAI2B,MAAJ,EAAY;AACR,0BACI;AAAK,iBAAS,EAAC;AAAf,sBACI;AAAO,iBAAS,EAAC;AAAjB,SACK3B,OADL,CADJ,CADJ;AAOH;;AAED,wBACI;AAAK,eAAS,sBAAe4B,aAAa,IAAI,WAAhC;AAAd,oBACI;AAAO,eAAS,EAAC;AAAjB,oBACI;AAAG,eAAS,eAAQF,aAAa,IAAI,uBAAzB;AAAZ,MADJ,OACuE1B,OADvE,CADJ,CADJ;AAOH;;AAhE6D;AAAA;AAAA;AAAA;AAAA;;AAAA;;gBAA7CwB,S;AARjBK,M;AACAlC,O;AACAiC,e;AACAF,e;AACAC,Q;AACAF,Q;;;gBAGiBD,S,kBACY;AACzB7B,OAAK,EAAE,IADkB;AAEzB8B,QAAM,EAAE;AAFiB,C;;;;;;;;;;;0BADZD,S","file":"25.1cdca0456b324d2983b5.js","sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport {FormattedMessage} from 'react-intl';\n\nimport icon50 from 'images/icon50x50.png';\nimport FormError from 'components/form_error';\nimport {browserHistory} from 'utils/browser_history';\n\nimport FormattedMarkdownMessage from 'components/formatted_markdown_message.jsx';\n\nexport default class Authorize extends React.PureComponent {\n    static get propTypes() {\n        return {\n            location: PropTypes.object.isRequired,\n            actions: PropTypes.shape({\n                getOAuthAppInfo: PropTypes.func.isRequired,\n                allowOAuth2: PropTypes.func.isRequired,\n            }).isRequired,\n        };\n    }\n\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n    }\n\n    componentDidMount() {\n        // if we get to this point remove the antiClickjack blocker\n        const blocker = document.getElementById('antiClickjack');\n        if (blocker) {\n            blocker.parentNode.removeChild(blocker);\n        }\n        const clientId = (new URLSearchParams(this.props.location.search)).get('client_id');\n        if (!((/^[a-z0-9]+$/).test(clientId))) {\n            return;\n        }\n\n        this.props.actions.getOAuthAppInfo(clientId).then(\n            ({data}) => {\n                if (data) {\n                    this.setState({app: data});\n                }\n            });\n    }\n\n    handleAllow = () => {\n        const searchParams = new URLSearchParams(this.props.location.search);\n        const params = {\n            responseType: searchParams.get('response_type'),\n            clientId: searchParams.get('client_id'),\n            redirectUri: searchParams.get('redirect_uri'),\n            state: searchParams.get('state'),\n            scope: searchParams.get('store'),\n        };\n\n        this.props.actions.allowOAuth2(params).then(\n            ({data, error}) => {\n                if (data && data.redirect) {\n                    window.location.href = data.redirect;\n                } else if (error) {\n                    this.setState({error: error.message});\n                }\n            },\n        );\n    }\n\n    handleDeny = () => {\n        const redirectUri = (new URLSearchParams(this.props.location.search)).get('redirect_uri');\n        if (redirectUri.startsWith('https://') || redirectUri.startsWith('http://')) {\n            window.location.href = redirectUri + '?error=access_denied';\n            return;\n        }\n\n        browserHistory.replace('/error');\n    }\n\n    render() {\n        const app = this.state.app;\n        if (!app) {\n            return null;\n        }\n\n        let icon;\n        if (app.icon_url) {\n            icon = app.icon_url;\n        } else {\n            icon = icon50;\n        }\n\n        let error;\n        if (this.state.error) {\n            error = (\n                <div className='prompt__error form-group'>\n                    <FormError error={this.state.error}/>\n                </div>\n            );\n        }\n\n        return (\n            <div className='container-fluid'>\n                <div className='prompt'>\n                    <div className='prompt__heading'>\n                        <div className='prompt__app-icon'>\n                            <img\n                                alt={'prompt icon'}\n                                src={icon}\n                                width='50'\n                                height='50'\n                            />\n                        </div>\n                        <div className='text'>\n                            <FormattedMarkdownMessage\n                                id='authorize.title'\n                                defaultMessage='Authorize **{appName}** to Connect to Your **Mattermost** User Account'\n                                values={{\n                                    appName: app.name,\n                                }}\n                            />\n                        </div>\n                    </div>\n                    <p>\n                        <FormattedMarkdownMessage\n                            id='authorize.app'\n                            defaultMessage='The app **{appName}** would like the ability to access and modify your basic information.'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </p>\n                    <h2 className='prompt__allow'>\n                        <FormattedMarkdownMessage\n                            id='authorize.access'\n                            defaultMessage='Allow **{appName}** access?'\n                            values={{\n                                appName: app.name,\n                            }}\n                        />\n                    </h2>\n                    <div className='prompt__buttons'>\n                        <button\n                            type='submit'\n                            className='btn btn-link authorize-btn'\n                            onClick={this.handleDeny}\n                        >\n                            <FormattedMessage\n                                id='authorize.deny'\n                                defaultMessage='Deny'\n                            />\n                        </button>\n                        <button\n                            type='submit'\n                            className='btn btn-primary authorize-btn'\n                            onClick={this.handleAllow}\n                        >\n                            <FormattedMessage\n                                id='authorize.allow'\n                                defaultMessage='Allow'\n                            />\n                        </button>\n                    </div>\n                    {error}\n                </div>\n            </div>\n        );\n    }\n}\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\n\nimport {allowOAuth2, getOAuthAppInfo} from 'actions/admin_actions.jsx';\n\nimport Authorize from './authorize';\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        actions: bindActionCreators({\n            getOAuthAppInfo,\n            allowOAuth2,\n        }, dispatch),\n    };\n}\n\nexport default connect(null, mapDispatchToProps)(Authorize);\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport React from 'react';\n\n// accepts either a single error or an array of errors\ntype Props = {\n    type?: React.ReactNode;\n    error?: React.ReactNode;\n    textClassName?: string;\n    iconClassName?: string;\n    margin?: boolean;\n    errors?: React.ReactNode[];\n}\n\nexport default class FormError extends React.PureComponent<Props> {\n    public static defaultProps = {\n        error: null,\n        errors: [],\n    }\n    public render() {\n        const {error = null, errors = [], iconClassName, margin, textClassName, type} = this.props;\n\n        if (!error && errors.length === 0) {\n            return null;\n        }\n\n        // look for the first truthy error to display\n        let message = error;\n\n        if (!message) {\n            for (const err of errors) {\n                if (err) {\n                    message = err;\n                }\n            }\n        }\n\n        if (!message) {\n            return null;\n        }\n\n        if (type === 'modal') {\n            return (\n                <div className='form-group'>\n                    <label className='col-sm-12 has-error'>\n                        {message}\n                    </label>\n                </div>\n            );\n        }\n\n        if (type === 'backstage') {\n            return (\n                <div className='pull-left has-error'>\n                    <label className='control-label'>\n                        {message}\n                    </label>\n                </div>\n            );\n        }\n\n        if (margin) {\n            return (\n                <div className='form-group has-error'>\n                    <label className='control-label'>\n                        {message}\n                    </label>\n                </div>\n            );\n        }\n\n        return (\n            <div className={`col-sm-12 ${textClassName || 'has-error'}`}>\n                <label className='control-label'>\n                    <i className={`fa ${iconClassName || 'fa-exclamation-circle'}`}/> {message}\n                </label>\n            </div>\n        );\n    }\n}\n"],"sourceRoot":""}