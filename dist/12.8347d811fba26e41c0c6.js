(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1461:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var s=a(125),i=a.n(s),n=a(5),r=a.n(n),o=a(1697),l=a(1467),c=a.n(l);function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class u extends r.a.PureComponent{constructor(e){super(e),d(this,"colorPicker",void 0),d(this,"colorInput",void 0),d(this,"checkClick",e=>{this.colorPicker.current&&this.colorPicker.current.contains(e.target)||this.setState({isOpened:!1})}),d(this,"togglePicker",()=>{!this.state.isOpened&&this.colorInput.current&&this.colorInput.current.focus(),this.setState({isOpened:!this.state.isOpened})}),d(this,"handleColorChange",e=>{this.props.onChange(e.hex)}),d(this,"onChange",e=>{const t=e.target.value,a=c()(t),s="#"+a.toHex();a.isValid()&&this.props.onChange(s),this.setState({value:t})}),d(this,"onFocus",e=>{this.setState({focused:!0}),e.target&&e.target.setSelectionRange(1,e.target.value.length)}),d(this,"onBlur",()=>{const e=this.state.value,t=c()(e),a="#"+t.toHex();t.isValid()?(this.props.onChange(a),this.setState({value:a})):this.setState({value:this.props.value}),this.setState({focused:!1})}),d(this,"onKeyDown",e=>{"Enter"!==e.key&&" "!==e.key||this.togglePicker()}),this.colorPicker=r.a.createRef(),this.colorInput=r.a.createRef(),this.state={focused:!1,isOpened:!1,value:e.value}}static getDerivedStateFromProps(e,t){return t.focused||e.value===t.value?null:{value:e.value}}componentDidUpdate(e,t){const{isOpened:a}=t,{isOpened:s}=this.state;s!==a&&(s?document.addEventListener("click",this.checkClick):document.removeEventListener("click",this.checkClick))}render(){const{id:e}=this.props,{isOpened:t,value:a}=this.state;return r.a.createElement("div",{className:"color-input input-group"},r.a.createElement("input",{id:"".concat(e,"-inputColorValue"),ref:this.colorInput,className:"form-control",type:"text",value:a,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onKeyDown:this.onKeyDown,maxLength:7,disabled:this.props.isDisabled}),!this.props.isDisabled&&r.a.createElement("span",{id:"".concat(e,"-squareColorIcon"),className:"input-group-addon color-pad",onClick:this.togglePicker},r.a.createElement("i",{id:"".concat(e,"-squareColorIconValue"),className:"color-icon",style:{backgroundColor:a}})),t&&r.a.createElement("div",{ref:this.colorPicker,className:"color-popover",id:"".concat(e,"-ChromePickerModal")},r.a.createElement(o.ChromePicker,{color:a,onChange:this.handleColorChange,disableAlpha:!0})))}}d(u,"propTypes",{id:i.a.string.isRequired,onChange:i.a.func.isRequired,value:i.a.string.isRequired,isDisabled:i.a.bool})},1470:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(4),i=a(8),n=a(192),r=a(16);t.autoUpdateTimezone=function(e){var t=this;return function(a,o){return s.__awaiter(t,void 0,void 0,(function(){var t,l,c,d,u;return s.__generator(this,(function(m){return t=i.getCurrentUser(o()),l=n.getUserTimezone(o(),t.id),c=l.automaticTimezone!==e,l.useAutomaticTimezone&&c&&(d={useAutomaticTimezone:"true",automaticTimezone:e,manualTimezone:l.manualTimezone},u=s.__assign(s.__assign({},t),{timezone:d}),r.updateMe(u)(a,o)),[2]}))}))}}},1471:function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return o}));var s=a(16),i=a(8);function n(e){return(t,a)=>{const n=Object(i.getCurrentUserId)(a());return t(s.updateUserMfa(n,!0,e))}}function r(){return(e,t)=>{const a=Object(i.getCurrentUserId)(t());return e(s.updateUserMfa(a,!1))}}function o(){return(e,t)=>{const a=Object(i.getCurrentUserId)(t());return e(s.generateMfaSecret(a))}}},1478:function(e,t,a){"use strict";var s=a(264),i=a(7),n=a(16),r=a(8),o=a(10),l=a(12),c=(a(66),a(104),a(82),a(33),a(125)),d=a.n(c),u=a(5),m=a.n(u),p=a(513),h=a(1129),g=a(269),f=a(11);const b=Object(p.d)({sessionRevoked:{id:Object(f.b)("audit_table.sessionRevoked"),defaultMessage:"The session with id {sessionId} was revoked"},channelCreated:{id:Object(f.b)("audit_table.channelCreated"),defaultMessage:"Created the {channelName} channel"},establishedDM:{id:Object(f.b)("audit_table.establishedDM"),defaultMessage:"Established a direct message channel with {username}"},nameUpdated:{id:Object(f.b)("audit_table.nameUpdated"),defaultMessage:"Updated the {channelName} channel name"},headerUpdated:{id:Object(f.b)("audit_table.headerUpdated"),defaultMessage:"Updated the {channelName} channel header"},channelDeleted:{id:Object(f.b)("audit_table.channelDeleted"),defaultMessage:"Archived the channel with the URL {url}"},userAdded:{id:Object(f.b)("audit_table.userAdded"),defaultMessage:"Added {username} to the {channelName} channel"},userRemoved:{id:Object(f.b)("audit_table.userRemoved"),defaultMessage:"Removed {username} to the {channelName} channel"},attemptedRegisterApp:{id:Object(f.b)("audit_table.attemptedRegisterApp"),defaultMessage:"Attempted to register a new OAuth Application with ID {id}"},attemptedAllowOAuthAccess:{id:Object(f.b)("audit_table.attemptedAllowOAuthAccess"),defaultMessage:"Attempted to allow a new OAuth service access"},successfullOAuthAccess:{id:Object(f.b)("audit_table.successfullOAuthAccess"),defaultMessage:"Successfully gave a new OAuth service access"},failedOAuthAccess:{id:Object(f.b)("audit_table.failedOAuthAccess"),defaultMessage:"Failed to allow a new OAuth service access - the redirect URI did not match the previously registered callback"},attemptedOAuthToken:{id:Object(f.b)("audit_table.attemptedOAuthToken"),defaultMessage:"Attempted to get an OAuth access token"},successfullOAuthToken:{id:Object(f.b)("audit_table.successfullOAuthToken"),defaultMessage:"Successfully added a new OAuth service"},oauthTokenFailed:{id:Object(f.b)("audit_table.oauthTokenFailed"),defaultMessage:"Failed to get an OAuth access token - {token}"},attemptedLogin:{id:Object(f.b)("audit_table.attemptedLogin"),defaultMessage:"Attempted to login"},authenticated:{id:Object(f.b)("audit_table.authenticated"),defaultMessage:"Successfully authenticated"},successfullLogin:{id:Object(f.b)("audit_table.successfullLogin"),defaultMessage:"Successfully logged in"},failedLogin:{id:Object(f.b)("audit_table.failedLogin"),defaultMessage:"FAILED login attempt"},updatePicture:{id:Object(f.b)("audit_table.updatePicture"),defaultMessage:"Updated your profile picture"},updateGeneral:{id:Object(f.b)("audit_table.updateGeneral"),defaultMessage:"Updated the general settings of your account"},attemptedPassword:{id:Object(f.b)("audit_table.attemptedPassword"),defaultMessage:"Attempted to change password"},successfullPassword:{id:Object(f.b)("audit_table.successfullPassword"),defaultMessage:"Successfully changed password"},failedPassword:{id:Object(f.b)("audit_table.failedPassword"),defaultMessage:"Failed to change password - tried to update user password who was logged in through OAuth"},updatedRol:{id:Object(f.b)("audit_table.updatedRol"),defaultMessage:"Updated user role(s) to "},member:{id:Object(f.b)("audit_table.member"),defaultMessage:"member"},accountActive:{id:Object(f.b)("audit_table.accountActive"),defaultMessage:"Account activated"},accountInactive:{id:Object(f.b)("audit_table.accountInactive"),defaultMessage:"Account deactivated"},by:{id:Object(f.b)("audit_table.by"),defaultMessage:" by {username}"},byAdmin:{id:Object(f.b)("audit_table.byAdmin"),defaultMessage:" by an admin"},sentEmail:{id:Object(f.b)("audit_table.sentEmail"),defaultMessage:"Sent an email to {email} to reset your password"},attemptedReset:{id:Object(f.b)("audit_table.attemptedReset"),defaultMessage:"Attempted to reset password"},successfullReset:{id:Object(f.b)("audit_table.successfullReset"),defaultMessage:"Successfully reset password"},updateGlobalNotifications:{id:Object(f.b)("audit_table.updateGlobalNotifications"),defaultMessage:"Updated your global notification settings"},attemptedWebhookCreate:{id:Object(f.b)("audit_table.attemptedWebhookCreate"),defaultMessage:"Attempted to create a webhook"},succcessfullWebhookCreate:{id:Object(f.b)("audit_table.successfullWebhookCreate"),defaultMessage:"Successfully created a webhook"},failedWebhookCreate:{id:Object(f.b)("audit_table.failedWebhookCreate"),defaultMessage:"Failed to create a webhook - bad channel permissions"},attemptedWebhookDelete:{id:Object(f.b)("audit_table.attemptedWebhookDelete"),defaultMessage:"Attempted to delete a webhook"},successfullWebhookDelete:{id:Object(f.b)("audit_table.successfullWebhookDelete"),defaultMessage:"Successfully deleted a webhook"},failedWebhookDelete:{id:Object(f.b)("audit_table.failedWebhookDelete"),defaultMessage:"Failed to delete a webhook - inappropriate conditions"},logout:{id:Object(f.b)("audit_table.logout"),defaultMessage:"Logged out of your account"},verified:{id:Object(f.b)("audit_table.verified"),defaultMessage:"Successfully verified your email address"},revokedAll:{id:Object(f.b)("audit_table.revokedAll"),defaultMessage:"Revoked all current sessions for the team"},loginAttempt:{id:Object(f.b)("audit_table.loginAttempt"),defaultMessage:" (Login attempt)"},loginFailure:{id:Object(f.b)("audit_table.loginFailure"),defaultMessage:" (Login failure)"},attemptedLicenseAdd:{id:Object(f.b)("audit_table.attemptedLicenseAdd"),defaultMessage:"Attempted to add new license"},successfullLicenseAdd:{id:Object(f.b)("audit_table.successfullLicenseAdd"),defaultMessage:"Successfully added new license"},failedExpiredLicenseAdd:{id:Object(f.b)("audit_table.failedExpiredLicenseAdd"),defaultMessage:"Failed to add a new license as it has either expired or not yet been started"},failedInvalidLicenseAdd:{id:Object(f.b)("audit_table.failedInvalidLicenseAdd"),defaultMessage:"Failed to add an invalid license"},licenseRemoved:{id:Object(f.b)("audit_table.licenseRemoved"),defaultMessage:"Successfully removed a license"}});class E extends m.a.PureComponent{componentDidMount(){const e=this.props.audits.map(e=>e.user_id);this.props.actions.getMissingProfilesByIds(e)}render(){const{audits:e,showUserId:t,showIp:a,showSession:s}=this.props,i=[];for(const[n,r]of e.entries()){const e=this.formatAuditInfo(r);let o,l,c;t&&(o=m.a.createElement("td",{className:"word-break--all"},e.userId)),a&&(l=m.a.createElement("td",{className:"whitespace--nowrap word-break--all"},e.ip)),s&&(c=m.a.createElement("td",{className:"whitespace--nowrap word-break--all"},e.sessionId));let d="";-1!==e.desc.toLowerCase().indexOf("fail")&&(d=" color--error"),i[n]=m.a.createElement("tr",{key:r.id},m.a.createElement("td",{className:"whitespace--nowrap word-break--all"},e.timestamp),o,m.a.createElement("td",{className:"word-break--all"+d},e.desc),l,c)}let n,r,o;return t&&(n=m.a.createElement("th",null,m.a.createElement(h.a,{id:"audit_table.userId",defaultMessage:"User ID"}))),a&&(r=m.a.createElement("th",null,m.a.createElement(h.a,{id:"audit_table.ip",defaultMessage:"IP Address"}))),s&&(o=m.a.createElement("th",null,m.a.createElement(h.a,{id:"audit_table.session",defaultMessage:"Session ID"}))),m.a.createElement("table",{className:"table"},m.a.createElement("thead",null,m.a.createElement("tr",null,m.a.createElement("th",null,m.a.createElement(h.a,{id:"audit_table.timestamp",defaultMessage:"Timestamp"})),n,m.a.createElement("th",null,m.a.createElement(h.a,{id:"audit_table.action",defaultMessage:"Action"})),r,o)),m.a.createElement("tbody",{"data-testid":"auditTableBody"},i))}formatAuditInfo(e){const{formatMessage:t}=this.props.intl,a=e.action.replace(/\/api\/v[1-9]/,"");let s="";if(0===a.indexOf("/channels")){const i=e.extra_info.split(" "),n=i[0].split("=");let r,o="",l="";switch(n.indexOf("name")>=0&&(o=n[n.indexOf("name")+1],r=this.props.getByName(o),l=r?r.display_name:o),a){case"/channels/create":s=t(b.channelCreated,{channelName:l});break;case"/channels/create_direct":r&&(s=t(b.establishedDM,{username:this.props.getDirectTeammate(r.id).username}));break;case"/channels/update":s=t(b.nameUpdated,{channelName:l});break;case"/channels/update_desc":case"/channels/update_header":s=t(b.headerUpdated,{channelName:l});break;default:{let e=[],n="",r="";if(i[1]&&(e=i[1].split("="),e.indexOf("user_id")>=0)){n=e[e.indexOf("user_id")+1];const t=this.props.getUser(n);t&&(r=t.username)}/\/channels\/[A-Za-z0-9]+\/delete/.test(a)?s=t(b.channelDeleted,{url:o}):/\/channels\/[A-Za-z0-9]+\/add/.test(a)?s=t(b.userAdded,{username:r,channelName:l}):/\/channels\/[A-Za-z0-9]+\/remove/.test(a)&&(s=t(b.userRemoved,{username:r,channelName:l}));break}}}else if(0===a.indexOf("/oauth")){const i=e.extra_info.split(" ");switch(a){case"/oauth/register":{const e=i[0].split("=");"client_id"===e[0]&&(s=t(b.attemptedRegisterApp,{id:e[1]}));break}case"/oauth/allow":"attempt"===i[0]?s=t(b.attemptedAllowOAuthAccess):"success"===i[0]?s=t(b.successfullOAuthAccess):"fail - redirect_uri did not match registered callback"===i[0]&&(s=t(b.failedOAuthAccess));break;case"/oauth/access_token":if("attempt"===i[0])s=t(b.attemptedOAuthToken);else if("success"===i[0])s=t(b.successfullOAuthToken);else{const e=i[0].split("-");"fail"===e[0].trim()&&e[1]&&(s=t(b.oauthTokenFailed,{token:e[1].trim()}))}}}else if(0===a.indexOf("/users")){const i=e.extra_info.split(" ");switch(a){case"/users/login":"attempt"===i[0]?s=t(b.attemptedLogin):"success"===i[0]?s=t(b.successfullLogin):"authenticated"===i[0]?s=t(b.authenticated):i[0]&&(s=t(b.failedLogin));break;case"/users/revoke_session":s=t(b.sessionRevoked,{sessionId:i[0].split("=")[1]});break;case"/users/newimage":s=t(b.updatePicture);break;case"/users/update":s=t(b.updateGeneral);break;case"/users/newpassword":"attempted"===i[0]?s=t(b.attemptedPassword):"completed"===i[0]?s=t(b.successfullPassword):"failed - tried to update user password who was logged in through oauth"===i[0]&&(s=t(b.failedPassword));break;case"/users/update_roles":{const e=i[0].split("=")[1];s=t(b.updatedRol),e.trim()?s+=e:s+=t(b.member);break}case"/users/update_active":{const e=i[0].split("=")[0],a=i[0].split("=")[1];if("active"===e){"true"===a?s=t(b.accountActive):"false"===a&&(s=t(b.accountInactive));const e=i[1].split("=");if("session_user"===e[0]){const a=this.props.getUser(e[1]),i=this.props.currentUser;i&&a&&Object(l.hb)(i.roles)?s+=t(b.by,{username:a.username}):i&&a&&(s+=t(b.byAdmin))}}else"session_id"===e&&(s=t(b.sessionRevoked,{sessionId:a}));break}case"/users/send_password_reset":s=t(b.sentEmail,{email:i[0].split("=")[1]});break;case"/users/reset_password":"attempt"===i[0]?s=t(b.attemptedReset):"success"===i[0]&&(s=t(b.successfullReset));break;case"/users/update_notify":s=t(b.updateGlobalNotifications)}}else if(0===a.indexOf("/hooks")){const i=e.extra_info;switch(a){case"/hooks/incoming/create":"attempt"===i?s=t(b.attemptedWebhookCreate):"success"===i?s=t(b.succcessfullWebhookCreate):"fail - bad channel permissions"===i&&(s=t(b.failedWebhookCreate));break;case"/hooks/incoming/delete":"attempt"===i?s=t(b.attemptedWebhookDelete):"success"===i?s=t(b.successfullWebhookDelete):"fail - inappropriate conditions"===i&&(s=t(b.failedWebhookDelete))}}else if(0===a.indexOf("/license")){const i=e.extra_info;switch(a){case"/license/add":"attempt"===i?s=t(b.attemptedLicenseAdd):"success"===i?s=t(b.successfullLicenseAdd):"failed - expired or non-started license"===i?s=t(b.failedExpiredLicenseAdd):"failed - invalid license"===i&&(s=t(b.failedInvalidLicenseAdd));break;case"/license/remove":s=t(b.licenseRemoved)}}else if(0===a.indexOf("/admin/download_compliance_report"))s=Object(l.Bb)(e.extra_info);else switch(a){case"/logout":s=t(b.logout);break;case"/verify_email":s=t(b.verified)}if(!s)if(e.extra_info.indexOf("revoked_all=")>=0)s=t(b.revokedAll);else{let t="";a&&-1!==a.lastIndexOf("/")&&(t=a.substring(a.lastIndexOf("/")+1).replace("_"," "),t=Object(l.Bb)(t));let i="";e.extra_info&&(i=e.extra_info,-1!==i.indexOf("=")&&(i=i.substring(i.indexOf("=")+1))),s=t+" "+i}const i=new Date(e.create_at),n=m.a.createElement("div",null,m.a.createElement("div",null,m.a.createElement(p.a,{value:i,day:"2-digit",month:"short",year:"numeric"})),m.a.createElement("div",null,m.a.createElement(p.c,{value:i,hour:"2-digit",minute:"2-digit"}))),r=this.props.getUser(e.user_id);return{timestamp:n,userId:r?r.email:e.user_id,desc:s,ip:e.ip_address,sessionId:e.session_id}}}var v,S,y;v=E,S="propTypes",y={intl:d.a.any.isRequired,audits:d.a.arrayOf(d.a.any).isRequired,showUserId:d.a.bool,showIp:d.a.bool,showSession:d.a.bool,currentUser:d.a.any.isRequired,getUser:d.a.func.isRequired,getByName:d.a.func.isRequired,actions:d.a.shape({getMissingProfilesByIds:d.a.func.isRequired}).isRequired,getDirectTeammate:d.a.func.isRequired},S in v?Object.defineProperty(v,S,{value:y,enumerable:!0,configurable:!0,writable:!0}):v[S]=y;var _=Object(g.c)(E);t.a=Object(s.connect)((function(e){return{currentUser:Object(r.getCurrentUser)(e),getUser:t=>Object(r.getUser)(e,t),getByName:t=>Object(o.getChannelByName)(e,t),getDirectTeammate:t=>Object(l.x)(e,t)}}),(function(e){return{actions:Object(i.bindActionCreators)({getMissingProfilesByIds:n.getMissingProfilesByIds},e)}}))(_)},2288:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(9);t.getEmailInterval=function(e,t,a){var i=s.Preferences.INTERVAL_NEVER,n=s.Preferences.INTERVAL_IMMEDIATE,r=s.Preferences.INTERVAL_FIFTEEN_MINUTES,o=s.Preferences.INTERVAL_HOUR,l=[n,i];return e?t&&-1===[n,i,r,o].indexOf(a)?r:t||-1!==l.indexOf(a)?e&&a===i?n:a:n:i}},2301:function(e,t,a){"use strict";a.r(t);var s=a(264),i=a(8),n=a(125),r=a.n(n),o=a(5),l=a.n(o),c=a(7),d=a(13),u=a(20),m=a(83),p=a(16),h=a(0),g=(a(56),a(33),a(1129)),f=a(1144),b=a(12),E=a(11),v=a(1164),S=a(1182),y=a(1150),_=a(1291),O=a(9);function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class N extends l.a.PureComponent{constructor(e){super(e),M(this,"handleOnChange",e=>{const t=e.currentTarget.value;this.setState({joinLeaveState:t})}),M(this,"handleUpdateSection",e=>{e||this.setState({joinLeaveState:this.props.joinLeave}),this.props.onUpdateSection(e)}),M(this,"handleSubmit",()=>{const{actions:e,currentUserId:t,onUpdateSection:a}=this.props,s={category:O.Preferences.CATEGORY_ADVANCED_SETTINGS,user_id:t,name:O.Preferences.ADVANCED_FILTER_JOIN_LEAVE,value:this.state.joinLeaveState};e.savePreferences(t,[s]),a()}),this.state={joinLeaveState:e.joinLeave}}render(){const{joinLeaveState:e}=this.state;return this.props.activeSection===h.g.JOIN_LEAVE?l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),inputs:[l.a.createElement("fieldset",{key:"joinLeaveSetting"},l.a.createElement("legend",{className:"form-legend hidden-label"},l.a.createElement(g.a,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"joinLeaveOn",type:"radio",value:"true",name:h.g.JOIN_LEAVE,checked:"true"===e,onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.advance.on",defaultMessage:"On"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"joinLeaveOff",type:"radio",value:"false",name:h.g.JOIN_LEAVE,checked:"false"===e,onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.advance.off",defaultMessage:"Off"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.advance.joinLeaveDesc",defaultMessage:'When "On", System Messages saying a user has joined or left a channel will be visible. When "Off", the System Messages about joining or leaving a channel will be hidden. A message will still show up when you are added to a channel, so you can receive a notification.'})))],setting:h.g.JOIN_LEAVE,submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),describe:this.props.renderOnOffLabel(e),section:h.g.JOIN_LEAVE,updateSection:this.handleUpdateSection})}}M(N,"propTypes",{activeSection:r.a.string,currentUserId:r.a.string.isRequired,joinLeave:r.a.string,onUpdateSection:r.a.func.isRequired,renderOnOffLabel:r.a.func.isRequired,actions:r.a.shape({savePreferences:r.a.func.isRequired}).isRequired});var k=Object(s.connect)((function(e){const t=Object(u.get)(e,O.Preferences.CATEGORY_ADVANCED_SETTINGS,O.Preferences.ADVANCED_FILTER_JOIN_LEAVE,"true");return{currentUserId:Object(i.getCurrentUserId)(e),joinLeave:t}}),(function(e){return{actions:Object(c.bindActionCreators)({savePreferences:m.savePreferences},e)}}))(N);function C(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const A=h.Z.PRE_RELEASE_FEATURES;class T extends l.a.PureComponent{constructor(e){super(e),C(this,"getStateFromProps",()=>{const e=this.props.advancedSettingsCategory,t={send_on_ctrl_enter:this.props.sendOnCtrlEnter,code_block_ctrl_enter:this.props.codeBlockOnCtrlEnter,formatting:this.props.formatting,join_leave:this.props.joinLeave},a=Object.keys(A);let s=0;for(const i of e)for(const e of a){const a=A[e];i.name===h.Z.FeatureTogglePrefix+a.label&&(t[i.name]=i.value,"true"===i.value&&(s+=1))}const i=this.props.enablePreviewFeatures;return{preReleaseFeatures:A,settings:t,preReleaseFeaturesKeys:a,enabledFeatures:s,isSaving:!1,previewFeaturesEnabled:i,showDeactivateAccountModal:!1}}),C(this,"updateSetting",(e,t)=>{const a=this.state.settings;a[e]=t,this.setState(a)}),C(this,"toggleFeature",(e,t)=>{const a=this.state.settings;a[h.Z.FeatureTogglePrefix+e]=String(t);let s=0;Object.keys(this.state.settings).forEach(e=>{0===e.lastIndexOf(h.Z.FeatureTogglePrefix)&&"true"===this.state.settings[e]&&s++}),this.setState({settings:a,enabledFeatures:s})}),C(this,"saveEnabledFeatures",()=>{const e=[];Object.keys(this.state.settings).forEach(t=>{0===t.lastIndexOf(h.Z.FeatureTogglePrefix)&&e.push(t)}),this.handleSubmit(e)}),C(this,"handleSubmit",async e=>{const t=[],{actions:a,currentUser:s}=this.props,i=s.id;(Array.isArray(e)?e:[e]).forEach(e=>{t.push({user_id:i,category:h.Z.Preferences.CATEGORY_ADVANCED_SETTINGS,name:e,value:this.state.settings[e]})}),this.setState({isSaving:!0}),await a.savePreferences(i,t),this.handleUpdateSection("")}),C(this,"handleDeactivateAccountSubmit",async()=>{const e=this.props.currentUser.id;this.setState({isSaving:!0}),this.props.actions.updateUserActive(e,!1).then(({error:e})=>{e&&this.setState({serverError:e.message})});const{data:t,error:a}=await this.props.actions.revokeAllSessionsForUser(e);t?Object(f.e)():a&&this.setState({serverError:a.message})}),C(this,"handleShowDeactivateAccountModal",()=>{this.setState({showDeactivateAccountModal:!0})}),C(this,"handleHideDeactivateAccountModal",()=>{this.setState({showDeactivateAccountModal:!1})}),C(this,"handleUpdateSection",e=>{e||this.setState(this.getStateFromProps()),this.setState({isSaving:!1}),this.props.updateSection(e)}),C(this,"getCtrlSendText",()=>{const e={default:{id:Object(E.b)("user.settings.advance.sendDesc"),defaultMessage:"When enabled, CTRL + ENTER will send the message and ENTER inserts a new line."},mac:{id:Object(E.b)("user.settings.advance.sendDesc.mac"),defaultMessage:"When enabled, ⌘ + ENTER will send the message and ENTER inserts a new line."}},t={default:{id:Object(E.b)("user.settings.advance.sendTitle"),defaultMessage:"Send Messages on CTRL+ENTER"},mac:{id:Object(E.b)("user.settings.advance.sendTitle.mac"),defaultMessage:"Send Messages on ⌘+ENTER"}};return b.eb()?{ctrlSendTitle:t.mac,ctrlSendDesc:e.mac}:{ctrlSendTitle:t.default,ctrlSendDesc:e.default}}),C(this,"renderFormattingSection",()=>"formatting"===this.props.activeSection?l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),inputs:[l.a.createElement("fieldset",{key:"formattingSetting"},l.a.createElement("legend",{className:"form-legend hidden-label"},l.a.createElement(g.a,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"postFormattingOn",type:"radio",name:"formatting",checked:"false"!==this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","true")}),l.a.createElement(g.a,{id:"user.settings.advance.on",defaultMessage:"On"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"postFormattingOff",type:"radio",name:"formatting",checked:"false"===this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","false")}),l.a.createElement(g.a,{id:"user.settings.advance.off",defaultMessage:"Off"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.advance.formattingDesc",defaultMessage:"If enabled, posts will be formatted to create links, show emoji, style the text, and add line breaks. By default, this setting is enabled."})))],setting:"formatting",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),describe:this.renderOnOffLabel(this.state.settings.formatting),section:"formatting",updateSection:this.handleUpdateSection})),this.state=this.getStateFromProps()}renderOnOffLabel(e){return"false"===e?l.a.createElement(g.a,{id:"user.settings.advance.off",defaultMessage:"Off"}):l.a.createElement(g.a,{id:"user.settings.advance.on",defaultMessage:"On"})}renderCtrlEnterLabel(){const e=this.state.settings.send_on_ctrl_enter,t=this.state.settings.code_block_ctrl_enter;return"false"===e&&"false"===t?l.a.createElement(g.a,{id:"user.settings.advance.off",defaultMessage:"Off"}):"true"===e&&"true"===t?l.a.createElement(g.a,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"}):l.a.createElement(g.a,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})}renderFeatureLabel(e){switch(e){case"MARKDOWN_PREVIEW":return l.a.createElement(g.a,{id:"user.settings.advance.markdown_preview",defaultMessage:"Show markdown preview option in message input box"});default:return null}}render(){const e=this.state.serverError||null;let t;const{ctrlSendTitle:a,ctrlSendDesc:s}=this.getCtrlSendText();if("advancedCtrlSend"===this.props.activeSection){const i=["true"===this.state.settings.send_on_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"true"===this.state.settings.code_block_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter&&"false"===this.state.settings.code_block_ctrl_enter],n=[l.a.createElement("fieldset",{key:"ctrlSendSetting"},l.a.createElement("legend",{className:"form-legend hidden-label"},l.a.createElement(g.a,a)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"ctrlSendOn",type:"radio",name:"sendOnCtrlEnter",checked:i[0],onChange:()=>{this.updateSetting("send_on_ctrl_enter","true"),this.updateSetting("code_block_ctrl_enter","true")}}),l.a.createElement(g.a,{id:"user.settings.advance.onForAllMessages",defaultMessage:"On for all messages"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"ctrlSendOnForCode",type:"radio",name:"sendOnCtrlEnter",checked:i[1],onChange:()=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","true")}}),l.a.createElement(g.a,{id:"user.settings.advance.onForCode",defaultMessage:"On only for code blocks starting with ```"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"ctrlSendOff",type:"radio",name:"sendOnCtrlEnter",checked:i[2],onChange:()=>{this.updateSetting("send_on_ctrl_enter","false"),this.updateSetting("code_block_ctrl_enter","false")}}),l.a.createElement(g.a,{id:"user.settings.advance.off",defaultMessage:"Off"})),l.a.createElement("br",null)),l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement(g.a,s)))];t=l.a.createElement(v.a,{title:l.a.createElement(g.a,a),inputs:n,submit:this.handleSubmit.bind(this,["send_on_ctrl_enter","code_block_ctrl_enter"]),saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else t=l.a.createElement(S.a,{title:l.a.createElement(g.a,a),describe:this.renderCtrlEnterLabel(),section:"advancedCtrlSend",updateSection:this.handleUpdateSection});const i=this.renderFormattingSection();let n,r,o=null;if(i&&(o=l.a.createElement("div",{className:"divider-light"})),this.state.previewFeaturesEnabled&&this.state.preReleaseFeaturesKeys.length>0)if(r=l.a.createElement("div",{className:"divider-light"}),"advancedPreviewFeatures"===this.props.activeSection){const t=[];this.state.preReleaseFeaturesKeys.forEach(e=>{const a=this.state.preReleaseFeatures[e];t.push(l.a.createElement("div",{key:"advancedPreviewFeatures_"+a.label},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"advancedPreviewFeatures"+a.label,type:"checkbox",checked:"true"===this.state.settings[h.Z.FeatureTogglePrefix+a.label],onChange:e=>{this.toggleFeature(a.label,e.target.checked)}}),this.renderFeatureLabel(e)))))}),t.push(l.a.createElement("div",{key:"advancedPreviewFeatures_helptext"},l.a.createElement("br",null),l.a.createElement(g.a,{id:"user.settings.advance.preReleaseDesc",defaultMessage:"Check any pre-released features you'd like to preview.  You may also need to refresh the page before the setting will take effect."}))),n=l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.preReleaseTitle",defaultMessage:"Preview Pre-release Features"}),inputs:t,submit:this.saveEnabledFeatures,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else n=l.a.createElement(S.a,{title:b.ob("user.settings.advance.preReleaseTitle","Preview Pre-release Features"),describe:l.a.createElement(g.a,{id:"user.settings.advance.enabledFeatures",defaultMessage:"{count, number} {count, plural, one {Feature} other {Features}} Enabled",values:{count:this.state.enabledFeatures}}),section:"advancedPreviewFeatures",updateSection:this.handleUpdateSection});let c="",d="";if(""===this.props.currentUser.auth_service&&this.props.enableUserDeactivation){c="deactivateAccount"===this.props.activeSection?l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),inputs:[l.a.createElement("div",{key:"formattingSetting"},l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement(g.a,{id:"user.settings.advance.deactivateDesc",defaultMessage:"Deactivating your account removes your ability to log in to this server and disables all email and mobile notifications. To reactivate your account, contact your System Administrator."})))],saveButtonText:"Deactivate",setting:"deactivateAccount",submit:this.handleShowDeactivateAccountModal,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.handleUpdateSection}):l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.advance.deactivateAccountTitle",defaultMessage:"Deactivate Account"}),describe:l.a.createElement(g.a,{id:"user.settings.advance.deactivateDescShort",defaultMessage:"Click 'Edit' to deactivate your account"}),section:"deactivateAccount",updateSection:this.handleUpdateSection});const e="btn btn-danger",t=l.a.createElement(g.a,{id:"user.settings.advance.deactivate_member_modal.deactivateButton",defaultMessage:"Yes, deactivate my account"});d=l.a.createElement(y.a,{show:this.state.showDeactivateAccountModal,title:l.a.createElement(g.a,{id:"user.settings.advance.confirmDeactivateAccountTitle",defaultMessage:"Confirm Deactivation"}),message:l.a.createElement(g.a,{id:"user.settings.advance.confirmDeactivateDesc",defaultMessage:"Are you sure you want to deactivate your account? This can only be reversed by your System Administrator."}),confirmButtonClass:e,confirmButtonText:t,onConfirm:this.handleDeactivateAccountSubmit,onCancel:this.handleHideDeactivateAccountModal})}return l.a.createElement("div",null,l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×")),l.a.createElement("h4",{className:"modal-title",ref:"title"},l.a.createElement("div",{className:"modal-back"},l.a.createElement("span",{onClick:this.props.collapseModal},l.a.createElement(_.a,null))),l.a.createElement(g.a,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"}))),l.a.createElement("div",{className:"user-settings"},l.a.createElement("h3",{className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})),l.a.createElement("div",{className:"divider-dark first"}),t,o,i,l.a.createElement("div",{className:"divider-light"}),l.a.createElement(k,{activeSection:this.props.activeSection,onUpdateSection:this.handleUpdateSection,renderOnOffLabel:this.renderOnOffLabel}),r,n,o,c,l.a.createElement("div",{className:"divider-dark"}),d))}}C(T,"propTypes",{currentUser:r.a.object.isRequired,advancedSettingsCategory:r.a.array.isRequired,sendOnCtrlEnter:r.a.string.isRequired,codeBlockOnCtrlEnter:r.a.bool,formatting:r.a.string.isRequired,joinLeave:r.a.string.isRequired,updateSection:r.a.func,activeSection:r.a.string,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired,enablePreviewFeatures:r.a.bool,enableUserDeactivation:r.a.bool,actions:r.a.shape({savePreferences:r.a.func.isRequired,updateUserActive:r.a.func.isRequired,revokeAllSessionsForUser:r.a.func.isRequired}).isRequired});var w=Object(s.connect)((function(){const e=Object(u.makeGetCategory)();return t=>{const a=Object(d.getConfig)(t),s="true"===a.EnablePreviewFeatures,n="true"===a.EnableUserDeactivation;return{advancedSettingsCategory:e(t,h.F.CATEGORY_ADVANCED_SETTINGS),sendOnCtrlEnter:Object(u.get)(t,h.F.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter","false"),codeBlockOnCtrlEnter:Object(u.get)(t,h.F.CATEGORY_ADVANCED_SETTINGS,"code_block_ctrl_enter","true"),formatting:Object(u.get)(t,h.F.CATEGORY_ADVANCED_SETTINGS,"formatting","true"),joinLeave:Object(u.get)(t,h.F.CATEGORY_ADVANCED_SETTINGS,"join_leave","true"),currentUser:Object(i.getCurrentUser)(t),enablePreviewFeatures:s,enableUserDeactivation:n}}}),(function(e){return{actions:Object(c.bindActionCreators)({savePreferences:m.savePreferences,updateUserActive:p.updateUserActive,revokeAllSessionsForUser:p.revokeAllSessionsForUser},e)}}))(T),R=a(518),P=a(1470),I=a(192),j=a(193),D=(a(514),a(194)),L=a(197),U=a(19),x=(a(182),a(1148)),F=a.n(x),q=a(147),z=a.n(q),G=a(1403),B=a(513),V=a(1),H=a(1170),Y=a(1140),W=a(1219),K=a(1461);function Z(e){return l.a.createElement(l.a.Fragment,null,l.a.createElement("label",{className:"custom-label"},e.label),l.a.createElement(K.a,{id:e.id,value:e.value,onChange:t=>{var a;null===(a=e.onChange)||void 0===a||a.call(e,e.id,t)}}))}function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){Q(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Z.propTypes={id:r.a.string.isRequired,label:r.a.node.isRequired,value:r.a.string.isRequired,onChange:r.a.func};const $=Object(B.d)({sidebarBg:{id:Object(E.b)("user.settings.custom_theme.sidebarBg"),defaultMessage:"Sidebar BG"},sidebarText:{id:Object(E.b)("user.settings.custom_theme.sidebarText"),defaultMessage:"Sidebar Text"},sidebarHeaderBg:{id:Object(E.b)("user.settings.custom_theme.sidebarHeaderBg"),defaultMessage:"Sidebar Header BG"},sidebarHeaderTextColor:{id:Object(E.b)("user.settings.custom_theme.sidebarHeaderTextColor"),defaultMessage:"Sidebar Header Text"},sidebarUnreadText:{id:Object(E.b)("user.settings.custom_theme.sidebarUnreadText"),defaultMessage:"Sidebar Unread Text"},sidebarTextHoverBg:{id:Object(E.b)("user.settings.custom_theme.sidebarTextHoverBg"),defaultMessage:"Sidebar Text Hover BG"},sidebarTextActiveBorder:{id:Object(E.b)("user.settings.custom_theme.sidebarTextActiveBorder"),defaultMessage:"Sidebar Text Active Border"},sidebarTextActiveColor:{id:Object(E.b)("user.settings.custom_theme.sidebarTextActiveColor"),defaultMessage:"Sidebar Text Active Color"},onlineIndicator:{id:Object(E.b)("user.settings.custom_theme.onlineIndicator"),defaultMessage:"Online Indicator"},awayIndicator:{id:Object(E.b)("user.settings.custom_theme.awayIndicator"),defaultMessage:"Away Indicator"},dndIndicator:{id:Object(E.b)("user.settings.custom_theme.dndIndicator"),defaultMessage:"Do Not Disturb Indicator"},mentionBg:{id:Object(E.b)("user.settings.custom_theme.mentionBg"),defaultMessage:"Mention Jewel BG"},mentionColor:{id:Object(E.b)("user.settings.custom_theme.mentionColor"),defaultMessage:"Mention Jewel Text"},centerChannelBg:{id:Object(E.b)("user.settings.custom_theme.centerChannelBg"),defaultMessage:"Center Channel BG"},centerChannelColor:{id:Object(E.b)("user.settings.custom_theme.centerChannelColor"),defaultMessage:"Center Channel Text"},newMessageSeparator:{id:Object(E.b)("user.settings.custom_theme.newMessageSeparator"),defaultMessage:"New Message Separator"},linkColor:{id:Object(E.b)("user.settings.custom_theme.linkColor"),defaultMessage:"Link Color"},buttonBg:{id:Object(E.b)("user.settings.custom_theme.buttonBg"),defaultMessage:"Button BG"},buttonColor:{id:Object(E.b)("user.settings.custom_theme.buttonColor"),defaultMessage:"Button Text"},errorTextColor:{id:Object(E.b)("user.settings.custom_theme.errorTextColor"),defaultMessage:"Error Text Color"},mentionHighlightBg:{id:Object(E.b)("user.settings.custom_theme.mentionHighlightBg"),defaultMessage:"Mention Highlight BG"},mentionHighlightLink:{id:Object(E.b)("user.settings.custom_theme.mentionHighlightLink"),defaultMessage:"Mention Highlight Link"},codeTheme:{id:Object(E.b)("user.settings.custom_theme.codeTheme"),defaultMessage:"Code Theme"}});class ee extends l.a.PureComponent{constructor(e){super(e),Q(this,"handleColorChange",(e,t)=>{const{updateTheme:a,theme:s}=this.props;if(s[e]!==t){const i=X(X({},s),{},{type:"custom",[e]:t});"mentionBg"===e&&(i.mentionBj=t),a(i);const n=this.setCopyTheme(i);this.setState({copyTheme:n})}}),Q(this,"pasteBoxChange",e=>{let t,a="";if(a=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.clipboardData.getData("Text"),0!==a.length){try{t=JSON.parse(a)}catch(e){return}Object(V.setThemeDefaults)(t),this.setState({copyTheme:JSON.stringify(t)}),t.type="custom",this.props.updateTheme(t)}}),Q(this,"onChangeHandle",e=>{e.stopPropagation()}),Q(this,"selectTheme",()=>{const e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.state.copyTheme.length)}),Q(this,"toggleSidebarStyles",e=>{e.preventDefault(),this.refs.sidebarStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.sidebarStyles)}),Q(this,"toggleCenterChannelStyles",e=>{e.preventDefault(),this.refs.centerChannelStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.centerChannelStyles)}),Q(this,"toggleLinkAndButtonStyles",e=>{e.preventDefault(),this.refs.linkAndButtonStylesHeader.classList.toggle("open"),this.toggleSection(this.refs.linkAndButtonStyles)}),Q(this,"onCodeThemeChange",e=>{const t=X(X({},this.props.theme),{},{type:"custom",codeTheme:e.target.value});this.props.updateTheme(t)}),Q(this,"copyTheme",()=>{this.selectTheme(),document.execCommand("copy"),this.showCopySuccess()}),Q(this,"showCopySuccess",()=>{const e=document.querySelector(".copy-theme-success");e.style.display="inline-block",setTimeout(()=>{e.style.display="none"},3e3)});const t=this.setCopyTheme(this.props.theme);this.state={copyTheme:t}}setCopyTheme(e){const t=Object.assign({},e);return delete t.type,delete t.image,JSON.stringify(t)}toggleSection(e){e.classList.toggle("open"),e.ontransitionend=()=>{e.classList.contains("open")?e.style.overflowY="inherit":e.style.overflowY="hidden"}}render(){const e=this.props.theme,t=[],a=[],s=[];h.Z.THEME_ELEMENTS.forEach((i,n)=>{if("codeTheme"===i.id){const t=[];let s="";i.themes.forEach((a,n)=>{a.id===e[i.id]&&(s=a.iconURL),t.push(l.a.createElement("option",{key:"code-theme-key"+n,value:a.id},a.uiName))});var r=l.a.createElement(W.a,{popoverStyle:"info",id:"code-popover",className:"code-popover"},l.a.createElement("img",{width:"200",alt:"code theme image",src:s}));a.push(l.a.createElement("div",{className:"col-sm-6 form-group",key:"custom-theme-key"+n},l.a.createElement("label",{className:"custom-label"},l.a.createElement(g.a,$[i.id])),l.a.createElement("div",{className:"input-group theme-group group--code dropdown",id:i.id},l.a.createElement("select",{id:"codeThemeSelect",className:"form-control",type:"text",defaultValue:e[i.id],onChange:this.onCodeThemeChange},t),l.a.createElement(Y.a,{placement:"top",overlay:r,ref:"headerOverlay"},l.a.createElement("span",{className:"input-group-addon"},l.a.createElement("img",{alt:"code theme image",src:s}))))))}else if("centerChannelElements"===i.group)a.push(l.a.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},l.a.createElement(Z,{id:i.id,label:l.a.createElement(g.a,$[i.id]),value:e[i.id],onChange:this.handleColorChange})));else if("sidebarElements"===i.group){let a=e[i.id];a||"mentionBg"!==i.id||(a=e.mentionBj),t.push(l.a.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},l.a.createElement(Z,{id:i.id,label:l.a.createElement(g.a,$[i.id]),value:a,onChange:this.handleColorChange})))}else s.push(l.a.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+n},l.a.createElement(Z,{id:i.id,label:l.a.createElement(g.a,$[i.id]),value:e[i.id],onChange:this.handleColorChange})))});const i=l.a.createElement("div",{className:"col-sm-12"},l.a.createElement("label",{className:"custom-label"},l.a.createElement(g.a,{id:"user.settings.custom_theme.copyPaste",defaultMessage:"Copy to share or paste theme colors here:"})),l.a.createElement("textarea",{ref:"textarea",className:"form-control",id:"pasteBox",value:this.state.copyTheme,onCopy:this.showCopySuccess,onPaste:this.pasteBoxChange,onChange:this.onChangeHandle,onClick:this.selectTheme}),l.a.createElement("div",{className:"mt-3"},l.a.createElement("button",{className:"btn btn-link copy-theme-button",onClick:this.copyTheme},l.a.createElement(g.a,{id:"user.settings.custom_theme.copyThemeColors",defaultMessage:"Copy Theme Colors"})),l.a.createElement("span",{className:"alert alert-success copy-theme-success",role:"alert",style:{display:"none"}},l.a.createElement(g.a,{id:"user.settings.custom_theme.copied",defaultMessage:"✔ Copied"}))));return l.a.createElement("div",{className:"appearance-section pt-2"},l.a.createElement("div",{className:"theme-elements row"},l.a.createElement("div",{ref:"sidebarStylesHeader",id:"sidebarStyles",className:"theme-elements__header",onClick:this.toggleSidebarStyles},l.a.createElement(g.a,{id:"user.settings.custom_theme.sidebarTitle",defaultMessage:"Sidebar Styles"}),l.a.createElement("div",{className:"header__icon"},l.a.createElement(H.a,{className:"fa fa-plus",title:{id:Object(E.b)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),l.a.createElement(H.a,{className:"fa fa-minus",title:{id:Object(E.b)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),l.a.createElement("div",{ref:"sidebarStyles",className:"theme-elements__body"},t)),l.a.createElement("div",{className:"theme-elements row"},l.a.createElement("div",{ref:"centerChannelStylesHeader",id:"centerChannelStyles",className:"theme-elements__header",onClick:this.toggleCenterChannelStyles},l.a.createElement(g.a,{id:"user.settings.custom_theme.centerChannelTitle",defaultMessage:"Center Channel Styles"}),l.a.createElement("div",{className:"header__icon"},l.a.createElement(H.a,{className:"fa fa-plus",title:{id:Object(E.b)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),l.a.createElement(H.a,{className:"fa fa-minus",title:{id:Object(E.b)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),l.a.createElement("div",{ref:"centerChannelStyles",id:"centerChannelStyles",className:"theme-elements__body"},a)),l.a.createElement("div",{className:"theme-elements row"},l.a.createElement("div",{ref:"linkAndButtonStylesHeader",id:"linkAndButtonsStyles",className:"theme-elements__header",onClick:this.toggleLinkAndButtonStyles},l.a.createElement(g.a,{id:"user.settings.custom_theme.linkButtonTitle",defaultMessage:"Link and Button Styles"}),l.a.createElement("div",{className:"header__icon"},l.a.createElement(H.a,{className:"fa fa-plus",title:{id:Object(E.b)("generic_icons.expand"),defaultMessage:"Expand Icon"}}),l.a.createElement(H.a,{className:"fa fa-minus",title:{id:Object(E.b)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}}))),l.a.createElement("div",{ref:"linkAndButtonStyles",className:"theme-elements__body"},s)),l.a.createElement("div",{className:"row mt-3"},i))}}Q(ee,"propTypes",{theme:r.a.object.isRequired,updateTheme:r.a.func.isRequired});a(104),a(66),a(82);class te extends l.a.PureComponent{render(){const e=this.props.theme,t=[],a=this.props.allowedThemes,s=a.length>1||a[0]&&a[0].trim().length>0;for(const i in h.Z.THEMES)if(h.Z.THEMES.hasOwnProperty(i)){if(s&&a.indexOf(i)<0)continue;const n=Object.assign({},h.Z.THEMES[i]);let r="";n.type===e.type&&(r="active"),t.push(l.a.createElement("div",{className:"col-xs-6 col-sm-3 premade-themes",key:"premade-theme-key"+i},l.a.createElement("div",{id:"premadeTheme".concat(n.type.replace(" ","")),className:r,onClick:()=>this.props.updateTheme(n)},l.a.createElement("label",null,l.a.createElement("img",{alt:"premade theme "+i,className:"img-responsive",src:n.image}),l.a.createElement("div",{className:"theme-label"},b.Bb(n.type))))))}return l.a.createElement("div",{className:"row appearance-section"},l.a.createElement("div",{className:"clearfix"},t))}}te.propTypes={theme:r.a.object.isRequired,updateTheme:r.a.func.isRequired,allowedThemes:r.a.arrayOf(r.a.string)},te.defaultProps={allowedThemes:[]};var ae=Object(s.connect)((function(e){const t=Object(d.getConfig)(e);return{allowedThemes:t.AllowedThemes&&t.AllowedThemes.split(",")||[]}}))(te);function se(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function ie(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?se(Object(a),!0).forEach((function(t){ne(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):se(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class re extends l.a.PureComponent{constructor(e){super(e),ne(this,"submitTheme",async()=>{const e=this.state.applyToAllTeams?"":this.props.currentTeamId;this.setState({isSaving:!0}),await this.props.actions.saveTheme(e,this.state.theme),this.state.applyToAllTeams&&await this.props.actions.deleteTeamSpecificThemes(),this.props.setRequireConfirm(!1),this.originalTheme=Object.assign({},this.state.theme),this.props.updateSection(""),this.setState({isSaving:!1})}),ne(this,"updateTheme",e=>{let t=this.state.theme.length===e.length;if(!t)for(const a in e)if(e.hasOwnProperty(a)&&this.state.theme[a]!==e[a]){t=!0;break}this.props.setRequireConfirm(t),this.setState({theme:e}),b.d(e)}),ne(this,"resetFields",()=>{const e=this.getStateFromProps();e.serverError=null,this.setState(e),b.d(e.theme),this.props.setRequireConfirm(!1)}),ne(this,"handleImportModal",()=>{G.a.handleViewAction({type:h.f.TOGGLE_IMPORT_THEME_MODAL,value:!0,callback:this.updateTheme}),this.props.setEnforceFocus(!1)}),ne(this,"handleUpdateSection",e=>{this.props.updateSection(e)}),this.state=ie(ie({},this.getStateFromProps(e)),{},{isSaving:!1}),this.originalTheme=Object.assign({},this.state.theme)}componentDidMount(){this.props.selected&&F()(z.a.findDOMNode(this.refs[this.state.theme])).addClass("active-border")}componentDidUpdate(e){e.selected&&!this.props.selected&&this.resetFields(),this.props.selected&&(F()(".color-btn").removeClass("active-border"),F()(z.a.findDOMNode(this.refs[this.state.theme])).addClass("active-border"))}componentWillUnmount(){this.props.selected&&b.d(this.props.theme)}getStateFromProps(e=this.props){const t=ie({},e.theme);return t.codeTheme||(t.codeTheme=h.l.DEFAULT_CODE_THEME),{theme:t,type:t.type||"premade",showAllTeamsCheckbox:e.showAllTeamsCheckbox,applyToAllTeams:e.applyToAllTeams}}updateType(e){this.setState({type:e})}render(){let e;this.state.serverError&&(e=this.state.serverError);const t="custom"===this.state.type;let a,s,i;if(t&&this.props.allowCustomThemes?a=l.a.createElement("div",{key:"customThemeChooser"},l.a.createElement(ee,{theme:this.state.theme,updateTheme:this.updateTheme})):s=l.a.createElement("div",{key:"premadeThemeChooser"},l.a.createElement("br",null),l.a.createElement(ae,{theme:this.state.theme,updateTheme:this.updateTheme})),this.props.selected){const n=[];this.props.allowCustomThemes&&n.push(l.a.createElement("div",{className:"radio",key:"premadeThemeColorLabel"},l.a.createElement("label",null,l.a.createElement("input",{id:"standardThemes",type:"radio",name:"theme",checked:!t,onChange:this.updateType.bind(this,"premade")}),l.a.createElement(g.a,{id:"user.settings.display.theme.themeColors",defaultMessage:"Theme Colors"})),l.a.createElement("br",null))),n.push(s),this.props.allowCustomThemes&&(n.push(l.a.createElement("div",{className:"radio",key:"customThemeColorLabel"},l.a.createElement("label",null,l.a.createElement("input",{id:"customThemes",type:"radio",name:"theme",checked:t,onChange:this.updateType.bind(this,"custom")}),l.a.createElement(g.a,{id:"user.settings.display.theme.customTheme",defaultMessage:"Custom Theme"})))),n.push(a),n.push(l.a.createElement("div",{key:"otherThemes"},l.a.createElement("br",null),l.a.createElement("a",{id:"otherThemes",href:"http://docs.mattermost.com/help/settings/theme-colors.html#custom-theme-examples",target:"_blank",rel:"noopener noreferrer"},l.a.createElement(g.a,{id:"user.settings.display.theme.otherThemes",defaultMessage:"See other themes"})))),n.push(l.a.createElement("div",{key:"importSlackThemeButton",className:"pt-2"},l.a.createElement("button",{id:"slackImportTheme",className:"theme style--none color--link",onClick:this.handleImportModal},l.a.createElement(g.a,{id:"user.settings.display.theme.import",defaultMessage:"Import theme colors from Slack"})))));let r=null;this.state.showAllTeamsCheckbox&&(r=l.a.createElement("div",{className:"checkbox user-settings__submit-checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"applyThemeToAllTeams",type:"checkbox",checked:this.state.applyToAllTeams,onChange:e=>this.setState({applyToAllTeams:e.target.checked})}),l.a.createElement(g.a,{id:"user.settings.display.theme.applyToAllTeams",defaultMessage:"Apply new theme to all my teams"})))),i=l.a.createElement(v.a,{inputs:n,submitExtra:r,submit:this.submitTheme,disableEnterSubmit:!0,saving:this.state.isSaving,server_error:e,width:"full",updateSection:this.handleUpdateSection})}else i=l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),describe:l.a.createElement(g.a,{id:"user.settings.display.theme.describe",defaultMessage:"Open to manage your theme"}),section:"theme",updateSection:this.handleUpdateSection,focused:this.props.focused});return i}}ne(re,"propTypes",{actions:r.a.shape({saveTheme:r.a.func.isRequired,deleteTeamSpecificThemes:r.a.func.isRequired}).isRequired,currentTeamId:r.a.string.isRequired,theme:r.a.object,selected:r.a.bool.isRequired,updateSection:r.a.func.isRequired,setRequireConfirm:r.a.func.isRequired,setEnforceFocus:r.a.func.isRequired,allowCustomThemes:r.a.bool,focused:r.a.bool.isRequired});var oe=Object(s.connect)((function(){const e=Object(u.makeGetCategory)();return t=>({currentTeamId:Object(U.getCurrentTeamId)(t),theme:Object(u.getTheme)(t),applyToAllTeams:e(t,h.F.CATEGORY_THEME).length<=1,showAllTeamsCheckbox:Object(U.getMyTeamsCount)(t)>1})}),(function(e){return{actions:Object(c.bindActionCreators)({saveTheme:m.saveTheme,deleteTeamSpecificThemes:m.deleteTeamSpecificThemes},e)}}))(re),le=(a(94),a(1229)),ce=a(1215),de=a(1178),ue=a(1179);class me extends ue.a{render(){const{item:e,isSelection:t}=this.props,a=e;let s="mentions__name";return t&&(s+=" suggestion--selected"),l.a.createElement("div",Object.assign({onClick:this.handleClick,className:s,ref:e=>{this.node=e}},ue.a.baseProps),a)}}class pe extends de.a{handlePretextChanged(e,t){return 0===e.length?(this.displayAllTimezones(t,e),!0):!!e&&(this.filterTimezones(t,e),!0)}async displayAllTimezones(e){e({matchedPretext:"",terms:Object(D.d)(),items:Object(D.d)(),component:me})}async filterTimezones(e,t){const a=Object(D.d)().filter(e=>Object(j.getTimezoneRegion)(e).toLowerCase().indexOf(t)>=0||e.toLowerCase().indexOf(t)>=0);e({matchedPretext:t,terms:a,items:a,component:me})}}function he(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function ge(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?he(Object(a),!0).forEach((function(t){fe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):he(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function fe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class be extends l.a.PureComponent{constructor(e){super(e),fe(this,"onChange",e=>{this.setState({manualTimezoneInput:e.target.value})}),fe(this,"handleTimezoneSelected",e=>{e&&this.setState({manualTimezone:e,manualTimezoneInput:e})}),fe(this,"timezoneNotChanged",()=>{const{useAutomaticTimezone:e,automaticTimezone:t,manualTimezone:a}=this.state,{useAutomaticTimezone:s,automaticTimezone:i,manualTimezone:n}=this.props;return e===s&&t===i&&a===n}),fe(this,"changeTimezone",()=>{this.timezoneNotChanged()?this.props.updateSection(""):this.submitUser()}),fe(this,"submitUser",()=>{const{user:e,actions:t}=this.props,{useAutomaticTimezone:a,automaticTimezone:s,manualTimezone:i}=this.state,n={useAutomaticTimezone:a.toString(),automaticTimezone:s,manualTimezone:i},r=ge(ge({},e),{},{timezone:n});t.updateMe(r).then(e=>{if("data"in e)this.props.updateSection("");else if("error"in e){const{error:t}=e;let a;a=t instanceof Error?t.message:t,this.setState({serverError:a,isSaving:!1})}})}),fe(this,"handleAutomaticTimezone",e=>{const t=e.target.checked;let a="";t&&(a=Object(D.a)()),this.setState({useAutomaticTimezone:t,automaticTimezone:a})}),fe(this,"handleManualTimezone",e=>{this.setState({manualTimezone:e.target.value})}),this.state={useAutomaticTimezone:e.useAutomaticTimezone,automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,manualTimezoneInput:e.manualTimezone,isSaving:!1}}render(){const{timezones:e}=this.props,{useAutomaticTimezone:t,automaticTimezone:a}=this.state;let s;this.state.serverError&&(s=l.a.createElement("label",{className:"has-error"},this.state.serverError));const i=[],n=l.a.createElement("div",{className:"section-describe pt-2"},t&&Object(j.getTimezoneRegion)(a)),r=0===e.length,o=l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"automaticTimezoneInput",type:"checkbox",checked:t,onChange:this.handleAutomaticTimezone,disabled:r}),l.a.createElement(g.a,{id:"user.settings.timezones.automatic",defaultMessage:"Set automatically"}),n)),c=[new pe],d=l.a.createElement("div",{key:"changeTimezone"},l.a.createElement("label",{className:"control-label"},l.a.createElement(g.a,{id:"user.settings.timezones.change",defaultMessage:"Change timezone"})),l.a.createElement("div",{className:"pt-2"},l.a.createElement(le.a,{className:"form-control focused",type:"search",onChange:this.onChange,value:this.state.manualTimezoneInput,onItemSelected:this.handleTimezoneSelected,listComponent:ce.a,maxLength:"64",requiredCharacters:0,providers:c,listStyle:"bottom",completeOnTab:!1,renderDividers:!1,openOnFocus:!0,disabled:r}),s));return i.push(o),t||i.push(d),i.push(l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement(g.a,{id:"user.settings.timezones.promote",defaultMessage:"Select the time zone used for timestamps in the user interface and email notifications."}))),l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),containerStyle:"timezone-container",width:"medium",submit:this.changeTimezone,saving:this.state.isSaving,inputs:i,updateSection:this.props.updateSection})}}fe(be,"propTypes",{user:r.a.any.isRequired,updateSection:r.a.func.isRequired,useAutomaticTimezone:r.a.bool.isRequired,automaticTimezone:r.a.string.isRequired,manualTimezone:r.a.string.isRequired,timezones:r.a.arrayOf(r.a.string).isRequired,actions:r.a.shape({updateMe:r.a.func.isRequired}).isRequired});var Ee=Object(s.connect)(null,(function(e){return{actions:Object(c.bindActionCreators)({updateMe:p.updateMe},e)}}))(be),ve=a(1220),Se=a(1134);function ye(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function _e(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(a),!0).forEach((function(t){Oe(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ye(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Oe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Me extends l.a.PureComponent{constructor(e){super(e),Oe(this,"reactSelectContainer",void 0),Oe(this,"handleContainerKeyDown",e=>{const t=document.querySelector(".modal-body");Object(b.cb)(e,h.Z.KeyCodes.ESCAPE)&&this.state.openMenu&&(null==t||t.classList.remove("no-scroll"),this.setState({openMenu:!1}),e.stopPropagation())}),Oe(this,"handleKeyDown",e=>{const t=document.querySelector(".modal-body");Object(b.cb)(e,h.Z.KeyCodes.ENTER)&&(null==t||t.classList.add("no-scroll"),this.setState({openMenu:!0}))}),Oe(this,"setLanguage",e=>{e&&"value"in e&&this.setState({locale:e.value,selectedOption:e})}),Oe(this,"changeLanguage",()=>{this.props.user.locale===this.state.locale?this.props.updateSection(""):this.submitUser(_e(_e({},this.props.user),{},{locale:this.state.locale}))}),Oe(this,"submitUser",e=>{this.setState({isSaving:!0}),this.props.actions.updateMe(e).then(e=>{if("data"in e);else if("error"in e){let t;const{error:a}=e;t=a instanceof Error?a.message:a,this.setState({serverError:t,isSaving:!1})}})}),Oe(this,"handleMenuClose",()=>{const e=document.querySelector(".modal-body");e&&e.classList.remove("no-scroll"),this.setState({openMenu:!1})}),Oe(this,"handleMenuOpen",()=>{const e=document.querySelector(".modal-body");e&&e.classList.add("no-scroll"),this.setState({openMenu:!0})});const t=L.d(),a=e.locale,s={value:t[a].value,label:t[a].name};this.reactSelectContainer=l.a.createRef(),this.state={locale:e.locale,selectedOption:s,isSaving:!1,openMenu:!1}}componentDidMount(){const e=this.reactSelectContainer.current;e&&e.addEventListener("keydown",this.handleContainerKeyDown)}componentWillUnmount(){this.reactSelectContainer.current&&this.reactSelectContainer.current.removeEventListener("keydown",this.handleContainerKeyDown)}render(){let e;this.state.serverError&&(e=l.a.createElement("label",{className:"has-error"},this.state.serverError));const t=[],a=L.d();Object.keys(a).map(e=>({value:a[e].value,name:a[e].name,order:a[e].order})).sort((e,t)=>e.order-t.order).forEach(e=>{t.push({value:e.value,label:e.name})});const s={menuPortal:e=>_e(_e({},e),{},{zIndex:9999})},i=l.a.createElement("div",{key:"changeLanguage"},l.a.createElement("br",null),l.a.createElement("label",{className:"control-label",id:"changeInterfaceLanguageLabel"},l.a.createElement(g.a,{id:"user.settings.languages.change",defaultMessage:"Change interface language"})),l.a.createElement("div",{ref:this.reactSelectContainer,className:"pt-2"},l.a.createElement(ve.b,{className:"react-select react-select-top",classNamePrefix:"react-select",id:"displayLanguage",menuIsOpen:this.state.openMenu,menuPortalTarget:document.body,styles:s,options:t,clearable:!1,onChange:this.setLanguage,onKeyDown:this.handleKeyDown,value:this.state.selectedOption,onMenuClose:this.handleMenuClose,onMenuOpen:this.handleMenuOpen,"aria-labelledby":"changeInterfaceLanguageLabel"}),e),l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement(Se.b,{id:"user.settings.languages.promote",defaultMessage:"Select which language Mattermost displays in the user interface.\\n \\nWould you like to help with translations? Join the [Mattermost Translation Server](!http://translate.mattermost.com/) to contribute."})));return l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",submit:this.changeLanguage,saving:this.state.isSaving,inputs:[i],updateSection:this.props.updateSection})}}Oe(Me,"propTypes",{user:r.a.any.isRequired,locale:r.a.string.isRequired,updateSection:r.a.func.isRequired,actions:r.a.shape({updateMe:r.a.func.isRequired}).isRequired});var Ne=Object(s.connect)(null,(function(e){return{actions:Object(c.bindActionCreators)({updateMe:p.updateMe},e)}}))(Me);function ke(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function Ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(a),!0).forEach((function(t){Ae(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ke(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Te=h.Z.Preferences;function we(e){return{militaryTime:e.militaryTime,teammateNameDisplay:e.teammateNameDisplay,channelDisplayMode:e.channelDisplayMode,messageDisplay:e.messageDisplay,collapseDisplay:e.collapseDisplay,linkPreviewDisplay:e.linkPreviewDisplay}}class Re extends l.a.PureComponent{constructor(e){super(e),Ae(this,"prevSections",void 0),Ae(this,"handleSubmit",async()=>{const e=this.props.user.id,t={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.USE_MILITARY_TIME,value:this.state.militaryTime},a={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.NAME_NAME_FORMAT,value:this.state.teammateNameDisplay},s={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.CHANNEL_DISPLAY_MODE,value:this.state.channelDisplayMode},i={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.MESSAGE_DISPLAY,value:this.state.messageDisplay},n={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.COLLAPSE_DISPLAY,value:this.state.collapseDisplay},r={user_id:e,category:Te.CATEGORY_DISPLAY_SETTINGS,name:Te.LINK_PREVIEW_DISPLAY,value:this.state.linkPreviewDisplay};this.setState({isSaving:!0});const o=[t,s,i,n,r,a];await this.props.actions.savePreferences(e,o),this.updateSection("")}),Ae(this,"handleClockRadio",e=>{this.setState({militaryTime:e})}),Ae(this,"handleTeammateNameDisplayRadio",e=>{this.setState({teammateNameDisplay:e})}),Ae(this,"updateSection",e=>{this.updateState(),this.props.updateSection(e)}),Ae(this,"updateState",()=>{const e=we(this.props);b.e(e,this.state)||this.setState(e),this.setState({isSaving:!1})}),this.state=Ce(Ce({},we(e)),{},{isSaving:!1}),0===e.timezones.length&&e.actions.getSupportedTimezones(),this.prevSections={theme:"dummySectionName",clock:"theme",linkpreview:"clock",message_display:"linkpreview",channel_display_mode:"message_display",languages:"channel_display_mode"}}componentDidMount(){const{actions:e,enableTimezone:t,shouldAutoUpdateTimezone:a}=this.props;t&&a&&e.autoUpdateTimezone(Object(D.a)())}componentDidUpdate(e){this.props.teammateNameDisplay!==e.teammateNameDisplay&&this.updateState()}handleChannelDisplayModeRadio(e){this.setState({channelDisplayMode:e})}handlemessageDisplayRadio(e){this.setState({messageDisplay:e})}handleCollapseRadio(e){this.setState({collapseDisplay:e})}handleLinkPreviewRadio(e){this.setState({linkPreviewDisplay:e})}handleOnChange(e){this.setState(Ce({},e))}createSection(e){const{section:t,display:a,value:s,title:i,firstOption:n,secondOption:r,thirdOption:o,description:c,disabled:d}=e;let u=null,m=this.handleSubmit;const p=l.a.createElement(g.a,{id:n.radionButtonText.id,defaultMessage:n.radionButtonText.message});let h,f;n.radionButtonText.moreId&&(h=": ",f=l.a.createElement("span",{className:"font-weight--normal"},l.a.createElement(g.a,{id:n.radionButtonText.moreId,defaultMessage:n.radionButtonText.moreMessage})));const b=l.a.createElement(g.a,{id:r.radionButtonText.id,defaultMessage:r.radionButtonText.message});let E,y;r.radionButtonText.moreId&&(E=l.a.createElement("span",{className:"font-weight--normal"},l.a.createElement(g.a,{id:r.radionButtonText.moreId,defaultMessage:r.radionButtonText.moreMessage}))),o&&(y=l.a.createElement(g.a,{id:o.radionButtonText.id,defaultMessage:o.radionButtonText.message}));const _=l.a.createElement(g.a,{id:i.id,defaultMessage:i.message}),O=l.a.createElement(g.a,{id:c.id,defaultMessage:c.message});if(this.props.activeSection===t){const e=[!1,!1,!1];s===n.value?e[0]=!0:s===r.value?e[1]=!0:e[2]=!0;const i=t+"Format",c=t+"UserDisplay",S={[a]:n.value},M={[a]:r.value};let N;if(o&&y){const t={[a]:o.value};N=l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:i+"C",type:"radio",name:i,checked:e[2],onChange:()=>this.handleOnChange(t)}),y),l.a.createElement("br",null))}let k=[l.a.createElement("fieldset",{key:c},l.a.createElement("legend",{className:"form-legend hidden-label"},_),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:i+"A",type:"radio",name:i,checked:e[0],onChange:()=>this.handleOnChange(S)}),p,h,f),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:i+"B",type:"radio",name:i,checked:e[1],onChange:()=>this.handleOnChange(M)}),b,h,E),l.a.createElement("br",null)),N,l.a.createElement("div",null,l.a.createElement("br",null),O))];return"teammateNameDisplay"===a&&d&&(u=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.display.teammateNameDisplay",defaultMessage:"This field is handled through your System Administrator. If you want to change it, you need to do so through your System Administrator."})),m=null,k=[]),l.a.createElement("div",null,l.a.createElement(v.a,{title:_,inputs:k,submit:m,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection,extraInfo:u}),l.a.createElement("div",{className:"divider-dark"}))}let M;return M=s===n.value?p:s===r.value?b:y,l.a.createElement("div",null,l.a.createElement(S.a,{title:_,describe:M,section:t,updateSection:this.updateSection}),l.a.createElement("div",{className:"divider-dark"}))}render(){const e=this.createSection({section:"collapse",display:"collapseDisplay",value:this.state.collapseDisplay,defaultDisplay:"false",title:{id:Object(E.b)("user.settings.display.collapseDisplay"),message:"Default Appearance of Image Previews"},firstOption:{value:"false",radionButtonText:{id:Object(E.b)("user.settings.display.collapseOn"),message:"On"}},secondOption:{value:"true",radionButtonText:{id:Object(E.b)("user.settings.display.collapseOff"),message:"Off"}},description:{id:Object(E.b)("user.settings.display.collapseDesc"),message:"Set whether previews of image links and image attachment thumbnails show as expanded or collapsed by default. This setting can also be controlled using the slash commands /expand and /collapse."}});let t=null;this.props.enableLinkPreviews?(t=this.createSection({section:"linkpreview",display:"linkPreviewDisplay",value:this.state.linkPreviewDisplay,defaultDisplay:"true",title:{id:Object(E.b)("user.settings.display.linkPreviewDisplay"),message:"Website Link Previews"},firstOption:{value:"true",radionButtonText:{id:Object(E.b)("user.settings.display.linkPreviewOn"),message:"On"}},secondOption:{value:"false",radionButtonText:{id:Object(E.b)("user.settings.display.linkPreviewOff"),message:"Off"}},description:{id:Object(E.b)("user.settings.display.linkPreviewDesc"),message:"When available, the first web link in a message will show a preview of the website content below the message."}}),this.prevSections.message_display="linkpreview"):this.prevSections.message_display=this.prevSections.linkpreview;const a=this.createSection({section:"clock",display:"militaryTime",value:this.state.militaryTime,defaultDisplay:"false",title:{id:Object(E.b)("user.settings.display.clockDisplay"),message:"Clock Display"},firstOption:{value:"false",radionButtonText:{id:Object(E.b)("user.settings.display.normalClock"),message:"12-hour clock (example: 4:00 PM)"}},secondOption:{value:"true",radionButtonText:{id:Object(E.b)("user.settings.display.militaryClock"),message:"24-hour clock (example: 16:00)"}},description:{id:Object(E.b)("user.settings.display.preferTime"),message:"Select how you prefer time displayed."}}),s=this.createSection({section:Te.NAME_NAME_FORMAT,display:"teammateNameDisplay",value:this.props.lockTeammateNameDisplay?this.props.configTeammateNameDisplay:this.state.teammateNameDisplay,defaultDisplay:this.props.configTeammateNameDisplay,title:{id:Object(E.b)("user.settings.display.teammateNameDisplayTitle"),message:"Teammate Name Display"},firstOption:{value:h.Z.TEAMMATE_NAME_DISPLAY.SHOW_USERNAME,radionButtonText:{id:Object(E.b)("user.settings.display.teammateNameDisplayUsername"),message:"Show username"}},secondOption:{value:h.Z.TEAMMATE_NAME_DISPLAY.SHOW_NICKNAME_FULLNAME,radionButtonText:{id:Object(E.b)("user.settings.display.teammateNameDisplayNicknameFullname"),message:"Show nickname if one exists, otherwise show first and last name"}},thirdOption:{value:h.Z.TEAMMATE_NAME_DISPLAY.SHOW_FULLNAME,radionButtonText:{id:Object(E.b)("user.settings.display.teammateNameDisplayFullname"),message:"Show first and last name"}},description:{id:Object(E.b)("user.settings.display.teammateNameDisplayDescription"),message:"Set how to display other user's names in posts and the Direct Messages list."},disabled:this.props.lockTeammateNameDisplay});let i;if(this.props.enableTimezone&&!this.props.shouldAutoUpdateTimezone){const e=this.props.userTimezone;i="timezone"===this.props.activeSection?l.a.createElement("div",null,l.a.createElement(Ee,{user:this.props.user,timezones:this.props.timezones,useAutomaticTimezone:Boolean(e.useAutomaticTimezone),automaticTimezone:e.automaticTimezone,manualTimezone:e.manualTimezone,updateSection:this.updateSection}),l.a.createElement("div",{className:"divider-dark"})):l.a.createElement("div",null,l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.display.timezone",defaultMessage:"Timezone"}),describe:Object(j.getTimezoneRegion)(this.props.currentUserTimezone),section:"timezone",updateSection:this.updateSection}),l.a.createElement("div",{className:"divider-dark"}))}const n=this.createSection({section:Te.MESSAGE_DISPLAY,display:"messageDisplay",value:this.state.messageDisplay,defaultDisplay:Te.MESSAGE_DISPLAY_CLEAN,title:{id:Object(E.b)("user.settings.display.messageDisplayTitle"),message:"Message Display"},firstOption:{value:Te.MESSAGE_DISPLAY_CLEAN,radionButtonText:{id:Object(E.b)("user.settings.display.messageDisplayClean"),message:"Standard",moreId:Object(E.b)("user.settings.display.messageDisplayCleanDes"),moreMessage:"Easy to scan and read."}},secondOption:{value:Te.MESSAGE_DISPLAY_COMPACT,radionButtonText:{id:Object(E.b)("user.settings.display.messageDisplayCompact"),message:"Compact",moreId:Object(E.b)("user.settings.display.messageDisplayCompactDes"),moreMessage:"Fit as many messages on the screen as we can."}},description:{id:Object(E.b)("user.settings.display.messageDisplayDescription"),message:"Select how messages in a channel should be displayed."}}),r=this.createSection({section:Te.CHANNEL_DISPLAY_MODE,display:"channelDisplayMode",value:this.state.channelDisplayMode,defaultDisplay:Te.CHANNEL_DISPLAY_MODE_FULL_SCREEN,title:{id:Object(E.b)("user.settings.display.channelDisplayTitle"),message:"Channel Display"},firstOption:{value:Te.CHANNEL_DISPLAY_MODE_FULL_SCREEN,radionButtonText:{id:Object(E.b)("user.settings.display.fullScreen"),message:"Full width"}},secondOption:{value:Te.CHANNEL_DISPLAY_MODE_CENTERED,radionButtonText:{id:Object(E.b)("user.settings.display.fixedWidthCentered"),message:"Fixed width, centered"}},description:{id:Object(E.b)("user.settings.display.channeldisplaymode"),message:"Select the width of the center channel."}});let o,c,d=this.props.user.locale;if("languages"===this.props.activeSection)L.e(d)||(d=this.props.defaultClientLocale),o=l.a.createElement("div",null,l.a.createElement(Ne,{user:this.props.user,locale:d,updateSection:this.updateSection}),l.a.createElement("div",{className:"divider-dark"}));else{let e;e=L.e(d)?L.c(d).name:L.c(this.props.defaultClientLocale).name,o=l.a.createElement("div",null,l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.display.language",defaultMessage:"Language"}),describe:e,section:"languages",updateSection:this.updateSection}),l.a.createElement("div",{className:"divider-dark"}))}return 1===Object.keys(L.d()).length&&(o=null),this.props.enableThemeSelection&&(c=l.a.createElement("div",null,l.a.createElement(oe,{selected:"theme"===this.props.activeSection,updateSection:this.updateSection,setRequireConfirm:this.props.setRequireConfirm,setEnforceFocus:this.props.setEnforceFocus,allowCustomThemes:this.props.allowCustomThemes}),l.a.createElement("div",{className:"divider-dark"}))),l.a.createElement("div",{id:"displaySettings"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×")),l.a.createElement("h4",{className:"modal-title",ref:"title"},l.a.createElement("div",{className:"modal-back"},l.a.createElement("span",{onClick:this.props.collapseModal},l.a.createElement(_.a,null))),l.a.createElement(g.a,{id:"user.settings.display.title",defaultMessage:"Display Settings"}))),l.a.createElement("div",{className:"user-settings"},l.a.createElement("h3",{id:"displaySettingsTitle",className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.display.title",defaultMessage:"Display Settings"})),l.a.createElement("div",{className:"divider-dark first"}),c,a,s,i,t,e,n,r,o))}}Ae(Re,"propTypes",{user:r.a.any.isRequired,updateSection:r.a.func.isRequired,activeSection:r.a.string,closeModal:r.a.func,collapseModal:r.a.func,setRequireConfirm:r.a.func,setEnforceFocus:r.a.func,timezones:r.a.arrayOf(r.a.string).isRequired,userTimezone:r.a.any.isRequired,allowCustomThemes:r.a.bool.isRequired,enableLinkPreviews:r.a.bool.isRequired,defaultClientLocale:r.a.string.isRequired,enableThemeSelection:r.a.bool.isRequired,configTeammateNameDisplay:r.a.string.isRequired,currentUserTimezone:r.a.string.isRequired,enableTimezone:r.a.bool.isRequired,shouldAutoUpdateTimezone:r.a.bool.isRequired,lockTeammateNameDisplay:r.a.bool.isRequired,militaryTime:r.a.string.isRequired,teammateNameDisplay:r.a.string.isRequired,channelDisplayMode:r.a.string.isRequired,messageDisplay:r.a.string.isRequired,collapseDisplay:r.a.string.isRequired,linkPreviewDisplay:r.a.string.isRequired,actions:r.a.shape({savePreferences:r.a.func.isRequired,getSupportedTimezones:r.a.func.isRequired,autoUpdateTimezone:r.a.func.isRequired}).isRequired});var Pe=Object(s.connect)((function(e){const t=Object(d.getConfig)(e),a=Object(d.getSupportedTimezones)(e),s=Object(i.getCurrentUserId)(e),n=Object(I.getUserTimezone)(e,s),r=n&&n.useAutomaticTimezone&&!n.automaticTimezone,o=!n||r,l="true"===t.AllowCustomThemes,c="true"===t.EnableLinkPreviews,m=t.DefaultClientLocale,p="true"===t.EnableThemeSelection,g="true"===t.ExperimentalTimezone,f="true"===Object(d.getLicense)(e).LockTeammateNameDisplay&&"true"===t.LockTeammateNameDisplay,b=t.TeammateNameDisplay;return{lockTeammateNameDisplay:f,allowCustomThemes:l,configTeammateNameDisplay:b,enableLinkPreviews:c,defaultClientLocale:m,enableThemeSelection:p,enableTimezone:g,timezones:a,userTimezone:n,shouldAutoUpdateTimezone:o,currentUserTimezone:Object(j.getUserCurrentTimezone)(n),militaryTime:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.USE_MILITARY_TIME,h.F.USE_MILITARY_TIME_DEFAULT),teammateNameDisplay:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.NAME_NAME_FORMAT,b),channelDisplayMode:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.CHANNEL_DISPLAY_MODE,h.F.CHANNEL_DISPLAY_MODE_DEFAULT),messageDisplay:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.MESSAGE_DISPLAY,h.F.MESSAGE_DISPLAY_DEFAULT),collapseDisplay:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.COLLAPSE_DISPLAY,h.F.COLLAPSE_DISPLAY_DEFAULT),linkPreviewDisplay:Object(u.get)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.LINK_PREVIEW_DISPLAY,h.F.LINK_PREVIEW_DISPLAY_DEFAULT)}}),(function(e){return{actions:Object(c.bindActionCreators)({getSupportedTimezones:R.getSupportedTimezones,autoUpdateTimezone:P.autoUpdateTimezone,savePreferences:m.savePreferences},e)}}))(Re),Ie=a(43),je=(a(103),a(269)),De=a(48),Le=a(146),Ue=a(1615),xe=a(1168);function Fe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const qe=Object(B.d)({usernameReserved:{id:Object(E.b)("user.settings.general.usernameReserved"),defaultMessage:"This username is reserved, please choose a new one."},usernameRestrictions:{id:Object(E.b)("user.settings.general.usernameRestrictions"),defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-', and '_'."},validEmail:{id:Object(E.b)("user.settings.general.validEmail"),defaultMessage:"Please enter a valid email address."},emailMatch:{id:Object(E.b)("user.settings.general.emailMatch"),defaultMessage:"The new emails you entered do not match."},incorrectPassword:{id:Object(E.b)("user.settings.general.incorrectPassword"),defaultMessage:"Your password is incorrect."},emptyPassword:{id:Object(E.b)("user.settings.general.emptyPassword"),defaultMessage:"Please enter your current password."},validImage:{id:Object(E.b)("user.settings.general.validImage"),defaultMessage:"Only BMP, JPG or PNG images may be used for profile pictures"},imageTooLarge:{id:Object(E.b)("user.settings.general.imageTooLarge"),defaultMessage:"Unable to upload profile image. File is too large."},uploadImage:{id:Object(E.b)("user.settings.general.uploadImage"),defaultMessage:"Click 'Edit' to upload an image."},uploadImageMobile:{id:Object(E.b)("user.settings.general.mobile.uploadImage"),defaultMessage:"Click to upload an image"},fullName:{id:Object(E.b)("user.settings.general.fullName"),defaultMessage:"Full Name"},nickname:{id:Object(E.b)("user.settings.general.nickname"),defaultMessage:"Nickname"},username:{id:Object(E.b)("user.settings.general.username"),defaultMessage:"Username"},profilePicture:{id:Object(E.b)("user.settings.general.profilePicture"),defaultMessage:"Profile Picture"},close:{id:Object(E.b)("user.settings.general.close"),defaultMessage:"Close"},position:{id:Object(E.b)("user.settings.general.position"),defaultMessage:"Position"}});class ze extends l.a.Component{constructor(e){super(e),Fe(this,"submitActive",!1),Fe(this,"handleEmailResend",e=>{this.setState({resendStatus:"sending",showSpinner:!0}),this.props.actions.sendVerificationEmail(e).then(({data:e,error:t})=>{e?this.setState({resendStatus:"success"}):t&&this.setState({resendStatus:"failure"})})}),Fe(this,"createEmailResendLink",e=>l.a.createElement("span",{className:"resend-verification-wrapper"},l.a.createElement(xe.a,{loading:this.state.showSpinner,text:b.ob("user.settings.general.sending","Sending")},l.a.createElement("a",{onClick:()=>{this.handleEmailResend(e),setTimeout(()=>{this.setState({showSpinner:!1})},500)}},l.a.createElement(g.a,{id:"user.settings.general.sendAgain",defaultMessage:"Send again"}))))),Fe(this,"submitUsername",()=>{const e=Object.assign({},this.props.user),t=this.state.username.trim().toLowerCase(),{formatMessage:a}=this.props.intl,s=b.mb(t);if(s){let e;return e=s.id===h.V.RESERVED_NAME?{clientError:a(qe.usernameReserved),serverError:""}:{clientError:a(qe.usernameRestrictions,{min:h.l.MIN_USERNAME_LENGTH,max:h.l.MAX_USERNAME_LENGTH}),serverError:""},void this.setState(e)}e.username!==t?(e.username=t,Object(Le.e)("settings","user_settings_update",{field:"username"}),this.submitUser(e,!1)):this.updateSection("")}),Fe(this,"submitNickname",()=>{const e=Object.assign({},this.props.user),t=this.state.nickname.trim();e.nickname!==t?(e.nickname=t,Object(Le.e)("settings","user_settings_update",{field:"nickname"}),this.submitUser(e,!1)):this.updateSection("")}),Fe(this,"submitName",()=>{const e=Object.assign({},this.props.user),t=this.state.firstName.trim(),a=this.state.lastName.trim();e.first_name!==t||e.last_name!==a?(e.first_name=t,e.last_name=a,Object(Le.e)("settings","user_settings_update",{field:"fullname"}),this.submitUser(e,!1)):this.updateSection("")}),Fe(this,"submitEmail",()=>{const e=Object.assign({},this.props.user),t=this.state.email.trim().toLowerCase(),a=this.state.confirmEmail.trim().toLowerCase(),s=this.state.currentPassword,{formatMessage:i}=this.props.intl;t!==e.email||""!==a&&a!==e.email?""!==t&&Object(De.isEmail)(t)?t===a?""!==s?(e.email=t,e.password=s,Object(Le.e)("settings","user_settings_update",{field:"email"}),this.submitUser(e,!0)):this.setState({emailError:i(qe.emptyPassword),clientError:"",serverError:""}):this.setState({emailError:i(qe.emailMatch),clientError:"",serverError:""}):this.setState({emailError:i(qe.validEmail),clientError:"",serverError:""}):this.updateSection("")}),Fe(this,"submitUser",(e,t)=>{const{formatMessage:a}=this.props.intl;this.setState({sectionIsSaving:!0}),this.props.actions.updateMe(e).then(({data:e,error:s})=>{if(e){this.updateSection(""),this.props.actions.getMe();this.props.requireEmailVerification&&t&&(this.props.actions.clearErrors(),this.props.actions.logError({message:h.h.EMAIL_VERIFICATION_REQUIRED,type:h.i.SUCCESS},!0))}else if(s){let e;e=s.server_error_id&&"api.user.check_user_password.invalid.app_error"===s.server_error_id?a(qe.incorrectPassword):s.message?s.message:s,this.setState({serverError:e,emailError:"",clientError:"",sectionIsSaving:!1})}})}),Fe(this,"setDefaultProfilePicture",async()=>{try{await this.props.actions.setDefaultProfileImage(this.props.user.id),this.updateSection(""),this.submitActive=!1}catch(e){let t;t=e.message?e.message:e,this.setState({serverError:t,emailError:"",clientError:"",sectionIsSaving:!1})}}),Fe(this,"submitPicture",()=>{if(!this.state.pictureFile)return;if(!this.submitActive)return;Object(Le.e)("settings","user_settings_update",{field:"picture"});const{formatMessage:e}=this.props.intl,t=this.state.pictureFile;h.e.includes(t.type)?t.size>this.props.maxFileSize?this.setState({clientError:e(qe.imageTooLarge),serverError:""}):(this.setState({loadingPicture:!0}),this.props.actions.uploadProfileImage(this.props.user.id,t).then(({data:e,error:t})=>{if(e)this.updateSection(""),this.submitActive=!1;else if(t){const e=this.setupInitialState(this.props);e.serverError=t.message,this.setState(e)}})):this.setState({clientError:e(qe.validImage),serverError:""})}),Fe(this,"submitPosition",()=>{const e=Object.assign({},this.props.user),t=this.state.position.trim();e.position!==t?(e.position=t,Object(Le.e)("settings","user_settings_update",{field:"position"}),this.submitUser(e,!1)):this.updateSection("")}),Fe(this,"updateUsername",e=>{this.setState({username:e.target.value})}),Fe(this,"updateFirstName",e=>{this.setState({firstName:e.target.value})}),Fe(this,"updateLastName",e=>{this.setState({lastName:e.target.value})}),Fe(this,"updateNickname",e=>{this.setState({nickname:e.target.value})}),Fe(this,"updatePosition",e=>{this.setState({position:e.target.value})}),Fe(this,"updateEmail",e=>{this.setState({email:e.target.value})}),Fe(this,"updateConfirmEmail",e=>{this.setState({confirmEmail:e.target.value})}),Fe(this,"updateCurrentPassword",e=>{this.setState({currentPassword:e.target.value})}),Fe(this,"updatePicture",e=>{e.target.files&&e.target.files[0]?(this.setState({pictureFile:e.target.files[0]}),this.submitActive=!0,this.setState({clientError:null})):this.setState({pictureFile:null})}),Fe(this,"updateSection",e=>{this.setState(Object.assign({},this.setupInitialState(this.props),{clientError:"",serverError:"",emailError:"",sectionIsSaving:!1})),this.submitActive=!1,this.props.updateSection(e)}),this.state=this.setupInitialState(e)}setupInitialState(e){const t=e.user;return{username:t.username,firstName:t.first_name,lastName:t.last_name,nickname:t.nickname,position:t.position,originalEmail:t.email,email:"",confirmEmail:"",currentPassword:"",pictureFile:null,loadingPicture:!1,sectionIsSaving:!1,showSpinner:!1,serverError:""}}createEmailSection(){const{formatMessage:e}=this.props.intl;let t;if("email"===this.props.activeSection){const a=this.props.requireEmailVerification,s=[];let i=l.a.createElement(g.a,{id:"user.settings.general.emailHelp1",defaultMessage:"Email is used for sign-in, notifications, and password reset. Email requires verification if changed."});a||(i=l.a.createElement(g.a,{id:"user.settings.general.emailHelp3",defaultMessage:"Email is used for sign-in, notifications, and password reset."}));let n=null;""===this.props.user.auth_service?(s.push(l.a.createElement("div",{key:"currentEmailSetting"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.currentEmail",defaultMessage:"Current Email"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("label",{className:"control-label word-break--all text-left"},this.state.originalEmail))))),s.push(l.a.createElement("div",{key:"emailSetting"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.newEmail",defaultMessage:"New Email"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{autoFocus:!0,id:"primaryEmail",className:"form-control",type:"email",onChange:this.updateEmail,maxLength:h.l.MAX_EMAIL_LENGTH,value:this.state.email,"aria-label":e({id:"user.settings.general.newEmail",defaultMessage:"New Email"})}))))),s.push(l.a.createElement("div",{key:"confirmEmailSetting"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"confirmEmail",className:"form-control",type:"email",onChange:this.updateConfirmEmail,maxLength:h.l.MAX_EMAIL_LENGTH,value:this.state.confirmEmail,"aria-label":e({id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})}))))),s.push(l.a.createElement("div",{key:"currentPassword"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.currentPassword",defaultMessage:"Current Password"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"currentPassword",className:"form-control",type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":e({id:"user.settings.general.currentPassword",defaultMessage:"Current Password"})}))),i)),n=this.submitEmail):this.props.user.auth_service===h.l.GITLAB_SERVICE?s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===h.l.GOOGLE_SERVICE?s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===h.l.OFFICE365_SERVICE?s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===h.l.OPENID_SERVICE?s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailOpenIdCantUpdate",defaultMessage:"Login occurs through OpenID Connect. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)):this.props.user.auth_service===h.l.LDAP_SERVICE?s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"pb-2"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})))):this.props.user.auth_service===h.l.SAML_SERVICE&&s.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"pb-2"},l.a.createElement("div",{className:"setting-list__hint pb-3"},l.a.createElement(g.a,{id:"user.settings.general.emailSamlCantUpdate",defaultMessage:"Login occurs through SAML. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),i)),t=l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.general.email",defaultMessage:"Email"}),inputs:s,submit:n,saving:this.state.sectionIsSaving,serverError:this.state.serverError,clientError:this.state.emailError,updateSection:this.updateSection})}else{let e="";""===this.props.user.auth_service?e=this.props.user.email:this.props.user.auth_service===h.l.GITLAB_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.general.loginGitlab",defaultMessage:"Login done through GitLab ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===h.l.GOOGLE_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.general.loginGoogle",defaultMessage:"Login done through Google Apps ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===h.l.OFFICE365_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.general.loginOffice365",defaultMessage:"Login done through Office 365 ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===h.l.LDAP_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.general.loginLdap",defaultMessage:"Login done through AD/LDAP ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===h.l.SAML_SERVICE&&(e=l.a.createElement(g.a,{id:"user.settings.general.loginSaml",defaultMessage:"Login done through SAML ({email})",values:{email:this.state.originalEmail}})),t=l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.general.email",defaultMessage:"Email"}),describe:e,section:"email",updateSection:this.updateSection})}return t}render(){const e=this.props.user,{formatMessage:t}=this.props.intl;let a=null;this.state.clientError&&(a=this.state.clientError);let s,i=null;this.state.serverError&&(i=this.state.serverError);const n=[];if("name"===this.props.activeSection){let e,r=null;if(this.props.user.auth_service===h.l.LDAP_SERVICE&&(this.props.ldapFirstNameAttributeSet||this.props.ldapLastNameAttributeSet)||this.props.user.auth_service===h.l.SAML_SERVICE&&(this.props.samlFirstNameAttributeSet||this.props.samlLastNameAttributeSet)||h.l.OAUTH_SERVICES.includes(this.props.user.auth_service))e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{n.push(l.a.createElement("div",{key:"firstNameSetting",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.firstName",defaultMessage:"First Name"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"firstName",autoFocus:!0,className:"form-control",type:"text",onChange:this.updateFirstName,maxLength:h.l.MAX_FIRSTNAME_LENGTH,value:this.state.firstName,onFocus:b.qb,"aria-label":t({id:"user.settings.general.firstName",defaultMessage:"First Name"})})))),n.push(l.a.createElement("div",{key:"lastNameSetting",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.general.lastName",defaultMessage:"Last Name"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"lastName",className:"form-control",type:"text",onChange:this.updateLastName,maxLength:h.l.MAX_LASTNAME_LENGTH,value:this.state.lastName,"aria-label":t({id:"user.settings.general.lastName",defaultMessage:"Last Name"})}))));const a=e=>{e.preventDefault(),this.updateSection(""),this.props.updateTab("notifications")},s=l.a.createElement("a",{href:"#",onClick:a.bind(this)},l.a.createElement(g.a,{id:"user.settings.general.notificationsLink",defaultMessage:"Notifications"}));e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.notificationsExtra",defaultMessage:"By default, you will receive mention notifications when someone types your first name. Go to {notify} settings to change this default.",values:{notify:s}})),r=this.submitName}s=l.a.createElement(v.a,{title:t(qe.fullName),inputs:n,submit:r,saving:this.state.sectionIsSaving,serverError:i,clientError:a,updateSection:this.updateSection,extraInfo:e})}else{let a="";e.first_name&&e.last_name?a=e.first_name+" "+e.last_name:e.first_name?a=e.first_name:e.last_name?a=e.last_name:(a=l.a.createElement(g.a,{id:"user.settings.general.emptyName",defaultMessage:"Click 'Edit' to add your full name"}),b.fb()&&(a=l.a.createElement(g.a,{id:"user.settings.general.mobile.emptyName",defaultMessage:"Click to add your full name"}))),s=l.a.createElement(S.a,{title:t(qe.fullName),describe:a,section:"name",updateSection:this.updateSection})}let r,o,c;if("nickname"===this.props.activeSection){let e,s=null;if("ldap"===this.props.user.auth_service&&this.props.ldapNicknameAttributeSet||this.props.user.auth_service===h.l.SAML_SERVICE&&this.props.samlNicknameAttributeSet)e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let a=l.a.createElement(g.a,{id:"user.settings.general.nickname",defaultMessage:"Nickname"});b.fb()&&(a=""),n.push(l.a.createElement("div",{key:"nicknameSetting",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},a),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"nickname",autoFocus:!0,className:"form-control",type:"text",onChange:this.updateNickname,value:this.state.nickname,maxLength:h.l.MAX_NICKNAME_LENGTH,autoCapitalize:"off","aria-label":t({id:"user.settings.general.nickname",defaultMessage:"Nickname"})})))),e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.nicknameExtra",defaultMessage:"Use Nickname for a name you might be called that is different from your first name and username. This is most often used when two or more people have similar sounding names and usernames."})),s=this.submitNickname}r=l.a.createElement(v.a,{title:t(qe.nickname),inputs:n,submit:s,saving:this.state.sectionIsSaving,serverError:i,clientError:a,updateSection:this.updateSection,extraInfo:e})}else{let a="";e.nickname?a=e.nickname:(a=l.a.createElement(g.a,{id:"user.settings.general.emptyNickname",defaultMessage:"Click 'Edit' to add a nickname"}),b.fb()&&(a=l.a.createElement(g.a,{id:"user.settings.general.mobile.emptyNickname",defaultMessage:"Click to add a nickname"}))),r=l.a.createElement(S.a,{title:t(qe.nickname),describe:a,section:"nickname",updateSection:this.updateSection})}if("username"===this.props.activeSection){let e,s=null;if(""===this.props.user.auth_service){let a=l.a.createElement(g.a,{id:"user.settings.general.username",defaultMessage:"Username"});b.fb()&&(a=""),n.push(l.a.createElement("div",{key:"usernameSetting",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},a),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"username",autoFocus:!0,maxLength:h.l.MAX_USERNAME_LENGTH,className:"form-control",type:"text",onChange:this.updateUsername,value:this.state.username,autoCapitalize:"off",onFocus:b.qb,"aria-label":t({id:"user.settings.general.username",defaultMessage:"Username"})})))),e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.usernameInfo",defaultMessage:"Pick something easy for teammates to recognize and recall."})),s=this.submitUsername}else e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));o=l.a.createElement(v.a,{title:t(qe.username),inputs:n,submit:s,saving:this.state.sectionIsSaving,serverError:i,clientError:a,updateSection:this.updateSection,extraInfo:e})}else o=l.a.createElement(S.a,{title:t(qe.username),describe:this.props.user.username,section:"username",updateSection:this.updateSection});if("position"===this.props.activeSection){let e,s=null;if(this.props.user.auth_service===h.l.LDAP_SERVICE&&this.props.ldapPositionAttributeSet||this.props.user.auth_service===h.l.SAML_SERVICE&&this.props.samlPositionAttributeSet)e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{let a=l.a.createElement(g.a,{id:"user.settings.general.position",defaultMessage:"Position"});b.fb()&&(a=""),n.push(l.a.createElement("div",{key:"positionSetting",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},a),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"position",autoFocus:!0,className:"form-control",type:"text",onChange:this.updatePosition,value:this.state.position,maxLength:h.l.MAX_POSITION_LENGTH,autoCapitalize:"off",onFocus:b.qb,"aria-label":t({id:"user.settings.general.position",defaultMessage:"Position"})})))),e=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.positionExtra",defaultMessage:"Use Position for your role or job title. This will be shown in your profile popover."})),s=this.submitPosition}c=l.a.createElement(v.a,{title:t(qe.position),inputs:n,submit:s,saving:this.state.sectionIsSaving,serverError:i,clientError:a,updateSection:this.updateSection,extraInfo:e})}else{let a="";e.position?a=e.position:(a=l.a.createElement(g.a,{id:"user.settings.general.emptyPosition",defaultMessage:"Click 'Edit' to add your job title / position"}),b.fb()&&(a=l.a.createElement(g.a,{id:"user.settings.general.mobile.emptyPosition",defaultMessage:"Click to add your job title / position"}))),c=l.a.createElement(S.a,{title:t(qe.position),describe:a,section:"position",updateSection:this.updateSection})}const d=this.createEmailSection();let u;if("picture"===this.props.activeSection){let s=null,n=null,r=null,o=null;this.props.user.auth_service!==h.l.LDAP_SERVICE&&this.props.user.auth_service!==h.l.SAML_SERVICE||!this.props.ldapPictureAttributeSet?(s=this.submitPicture,n=e.last_picture_update>0?this.setDefaultProfilePicture:null,o=b.R(e.id,e.last_picture_update),r=l.a.createElement(g.a,{id:"setting_picture.help.profile",defaultMessage:"Upload a picture in BMP, JPG or PNG format. Maximum file size: {max}",values:{max:b.p(this.props.maxFileSize)}})):r=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})),u=l.a.createElement(Ue.a,{title:t(qe.profilePicture),onSubmit:s,onSetDefault:n,src:o,defaultImageSrc:b.k(e.id),serverError:i,clientError:a,updateSection:e=>{this.updateSection(""),e.preventDefault()},file:this.state.pictureFile,onFileChange:this.updatePicture,submitActive:this.submitActive,loadingPicture:this.state.loadingPicture,maxFileSize:this.props.maxFileSize,helpText:r})}else{let a=t(qe.uploadImage);b.fb()&&(a=t(qe.uploadImageMobile)),e.last_picture_update&&(a=l.a.createElement(g.a,{id:"user.settings.general.imageUpdated",defaultMessage:"Image last updated {date}",values:{date:l.a.createElement(B.a,{value:new Date(e.last_picture_update),day:"2-digit",month:"short",year:"numeric"})}})),u=l.a.createElement(S.a,{title:t(qe.profilePicture),describe:a,section:"picture",updateSection:this.updateSection})}return l.a.createElement("div",{id:"generalSettings"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{id:"closeUserSettings",type:"button",className:"close","data-dismiss":"modal","aria-label":t(qe.close),onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×")),l.a.createElement("h4",{className:"modal-title",ref:"title"},l.a.createElement("div",{className:"modal-back"},l.a.createElement(g.a,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},e=>l.a.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal}))),l.a.createElement(g.a,{id:"user.settings.general.title",defaultMessage:"General Settings"}))),l.a.createElement("div",{className:"user-settings"},l.a.createElement("h3",{id:"generalSettingsTitle",className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.general.title",defaultMessage:"General Settings"})),l.a.createElement("div",{className:"divider-dark first"}),s,l.a.createElement("div",{className:"divider-light"}),o,l.a.createElement("div",{className:"divider-light"}),r,l.a.createElement("div",{className:"divider-light"}),c,l.a.createElement("div",{className:"divider-light"}),d,l.a.createElement("div",{className:"divider-light"}),u,l.a.createElement("div",{className:"divider-dark"})))}}Fe(ze,"propTypes",{intl:r.a.any.isRequired,user:r.a.any.isRequired,updateSection:r.a.func.isRequired,updateTab:r.a.func.isRequired,activeSection:r.a.string,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired,maxFileSize:r.a.number.isRequired,actions:r.a.shape({logError:r.a.func.isRequired,clearErrors:r.a.func.isRequired,getMe:r.a.func.isRequired,updateMe:r.a.func.isRequired,sendVerificationEmail:r.a.func.isRequired,setDefaultProfileImage:r.a.func.isRequired,uploadProfileImage:r.a.func.isRequired}).isRequired,requireEmailVerification:r.a.bool,ldapFirstNameAttributeSet:r.a.bool,ldapLastNameAttributeSet:r.a.bool,samlFirstNameAttributeSet:r.a.bool,samlLastNameAttributeSet:r.a.bool,ldapNicknameAttributeSet:r.a.bool,samlNicknameAttributeSet:r.a.bool,ldapPositionAttributeSet:r.a.bool,samlPositionAttributeSet:r.a.bool,ldapPictureAttributeSet:r.a.bool});var Ge=Object(je.c)(ze);var Be=Object(s.connect)((function(e){const t=Object(d.getConfig)(e);return{requireEmailVerification:"true"===t.RequireEmailVerification,maxFileSize:parseInt(t.MaxFileSize,10),ldapFirstNameAttributeSet:"true"===t.LdapFirstNameAttributeSet,ldapLastNameAttributeSet:"true"===t.LdapLastNameAttributeSet,samlFirstNameAttributeSet:"true"===t.SamlFirstNameAttributeSet,samlLastNameAttributeSet:"true"===t.SamlLastNameAttributeSet,ldapNicknameAttributeSet:"true"===t.LdapNicknameAttributeSet,samlNicknameAttributeSet:"true"===t.SamlNicknameAttributeSet,samlPositionAttributeSet:"true"===t.SamlPositionAttributeSet,ldapPositionAttributeSet:"true"===t.LdapPositionAttributeSet,ldapPictureAttributeSet:"true"===t.LdapPictureAttributeSet}}),(function(e){return{actions:Object(c.bindActionCreators)({logError:Ie.logError,clearErrors:Ie.clearErrors,getMe:p.getMe,updateMe:p.updateMe,sendVerificationEmail:p.sendVerificationEmail,setDefaultProfileImage:p.setDefaultProfileImage,uploadProfileImage:p.uploadProfileImage},e)}}))(Ge),Ve=a(196),He=a.n(Ve),Ye=a(15);function We(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ke extends l.a.PureComponent{constructor(e){super(e),We(this,"handleMinUpdateSection",e=>{this.props.updateSection(e),this.props.cancel()}),We(this,"handleMaxUpdateSection",e=>{this.props.updateSection(e)}),We(this,"handleOnChange",e=>{const t=e.currentTarget.getAttribute("data-key"),a=e.currentTarget.getAttribute("data-value");this.props.setParentState(t,a)}),We(this,"setDesktopNotificationSound",e=>{this.props.setParentState("desktopNotificationSound",e.value),this.setState({selectedOption:e}),b.Cb(e.value)}),We(this,"buildMaximizedSetting",()=>{const e=[],t=[!1,!1,!1];let a,s;if(this.props.activity===h.z.MENTION?t[1]=!0:this.props.activity===h.z.NONE?t[2]=!0:t[0]=!0,this.props.activity!==h.z.NONE){const e=[!1,!1];if("false"===this.props.sound?e[1]=!0:e[0]=!0,"true"===this.props.sound){const e=Array.from(b.rb.keys()).map(e=>({value:e,label:e}));(!Object(Ye.e)()||window.desktop&&He.a.gte(window.desktop.version,"4.6.0"))&&(s=l.a.createElement("div",{className:"pt-2"},l.a.createElement(ve.b,{className:"react-select notification-sound-dropdown",classNamePrefix:"react-select",id:"displaySoundNotification",options:e,clearable:!1,onChange:this.setDesktopNotificationSound,value:this.state.selectedOption,isSearchable:!1,ref:this.dropdownSoundRef})))}a=b.P()?l.a.createElement("fieldset",null,l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"soundOn",type:"radio",name:"notificationSounds",checked:e[0],"data-key":"desktopSound","data-value":"true",onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.notifications.on",defaultMessage:"On"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"soundOff",type:"radio",name:"notificationSounds",checked:e[1],"data-key":"desktopSound","data-value":"false",onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.notifications.off",defaultMessage:"Off"})),l.a.createElement("br",null)),s,l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.notifications.sounds_info",defaultMessage:"Notification sounds are available on Firefox, Edge, Safari, Chrome and Mattermost Desktop Apps."}))):l.a.createElement("fieldset",null,l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),l.a.createElement("br",null),l.a.createElement(g.a,{id:"user.settings.notifications.soundConfig",defaultMessage:"Please configure notification sounds in your browser settings"}))}return e.push(l.a.createElement("div",{key:"userNotificationLevelOption"},l.a.createElement("fieldset",null,l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.notifications.desktop",defaultMessage:"Send desktop notifications"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"desktopNotificationAllActivity",type:"radio",name:"desktopNotificationLevel",checked:t[0],"data-key":"desktopActivity","data-value":h.z.ALL,onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.notifications.allActivity",defaultMessage:"For all activity"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"desktopNotificationMentions",type:"radio",name:"desktopNotificationLevel",checked:t[1],"data-key":"desktopActivity","data-value":h.z.MENTION,onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.notifications.onlyMentions",defaultMessage:"Only for mentions and direct messages"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"desktopNotificationNever",type:"radio",name:"desktopNotificationLevel",checked:t[2],"data-key":"desktopActivity","data-value":h.z.NONE,onChange:this.handleOnChange}),l.a.createElement(g.a,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.notifications.info",defaultMessage:"Desktop notifications are available on Edge, Firefox, Safari, Chrome and Mattermost Desktop Apps."}))),l.a.createElement("hr",null),a)),l.a.createElement(v.a,{title:b.ob("user.settings.notifications.desktop.title","Desktop Notifications"),inputs:e,submit:this.props.submit,saving:this.props.saving,server_error:this.props.error,updateSection:this.handleMaxUpdateSection})}),We(this,"buildMinimizedSetting",()=>{let e;const t=b.P();return e=this.props.activity===h.z.MENTION?t&&"false"!==this.props.sound?{id:Object(E.b)("user.settings.notifications.desktop.mentionsSound"),defaultMessage:"For mentions and direct messages, with sound"}:t&&"false"===this.props.sound?{id:Object(E.b)("user.settings.notifications.desktop.mentionsNoSound"),defaultMessage:"For mentions and direct messages, without sound"}:{id:Object(E.b)("user.settings.notifications.desktop.mentionsSoundHidden"),defaultMessage:"For mentions and direct messages"}:this.props.activity===h.z.NONE?{id:Object(E.b)("user.settings.notifications.off"),defaultMessage:"Off"}:t&&"false"!==this.props.sound?{id:Object(E.b)("user.settings.notifications.desktop.allSound"),defaultMessage:"For all activity, with sound"}:t&&"false"===this.props.sound?{id:Object(E.b)("user.settings.notifications.desktop.allNoSound"),defaultMessage:"For all activity, without sound"}:{id:Object(E.b)("user.settings.notifications.desktop.allSoundHidden"),defaultMessage:"For all activity"},l.a.createElement(S.a,{title:b.ob("user.settings.notifications.desktop.title","Desktop Notifications"),describe:l.a.createElement(g.a,e),focused:this.props.focused,section:"desktop",updateSection:this.handleMinUpdateSection})});const t={value:e.selectedSound,label:e.selectedSound};this.state={selectedOption:t,blurDropdown:!1},this.dropdownSoundRef=l.a.createRef()}blurDropdown(){this.state.blurDropdown||(this.setState({blurDropdown:!0}),this.dropdownSoundRef.current&&this.dropdownSoundRef.current.blur())}componentDidUpdate(){this.blurDropdown()}render(){return this.props.active?this.buildMaximizedSetting():this.buildMinimizedSetting()}}Ke.propTypes={activity:r.a.string.isRequired,sound:r.a.string.isRequired,updateSection:r.a.func,setParentState:r.a.func,submit:r.a.func,cancel:r.a.func,error:r.a.string,active:r.a.bool,saving:r.a.bool,focused:r.a.bool,selectedSound:r.a.string};var Ze=a(108),Je=a(2288);function Xe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Qe extends l.a.PureComponent{constructor(e){super(e),Xe(this,"handleChange",e=>{const t=e.currentTarget.getAttribute("data-enable-email"),a=parseInt(e.currentTarget.getAttribute("data-email-interval"),10);this.setState({enableEmail:t,newInterval:a}),this.props.onChange(t)}),Xe(this,"handleSubmit",async()=>{const{newInterval:e}=this.state;if(this.props.emailInterval===e&&this.props.enableEmail===this.state.enableEmail)this.props.updateSection("");else{const{currentUserId:t,actions:a}=this.props,s={user_id:t,category:h.F.CATEGORY_NOTIFICATIONS,name:h.F.EMAIL_INTERVAL,value:e.toString()};await a.savePreferences(t,[s]),this.props.onSubmit()}}),Xe(this,"handleUpdateSection",e=>{e?this.props.updateSection(e):(this.props.updateSection(""),this.setState({enableEmail:this.props.enableEmail,newInterval:this.props.emailInterval}),this.props.onCancel())}),Xe(this,"renderMinSettingView",()=>{const{enableEmail:e,sendEmailNotifications:t}=this.props,{newInterval:a}=this.state;let s;if(t)if(e)switch(a){case h.F.INTERVAL_IMMEDIATE:s=l.a.createElement(g.a,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"});break;case h.F.INTERVAL_HOUR:s=l.a.createElement(g.a,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"});break;case h.F.INTERVAL_FIFTEEN_MINUTES:s=l.a.createElement(g.a,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count, plural, one {minute} other {{count, number} minutes}}",values:{count:a/60}});break;default:s=l.a.createElement(g.a,{id:"user.settings.notifications.email.never",defaultMessage:"Never"})}else s=l.a.createElement(g.a,{id:"user.settings.notifications.email.never",defaultMessage:"Never"});else s=l.a.createElement(g.a,{id:"user.settings.notifications.email.disabled",defaultMessage:"Email notifications are not enabled"});return l.a.createElement(S.a,{title:Object(b.ob)("user.settings.notifications.emailNotifications","Email Notifications"),describe:s,section:"email",updateSection:this.handleUpdateSection})}),Xe(this,"renderMaxSettingView",()=>{if(!this.props.sendEmailNotifications)return l.a.createElement(v.a,{title:Object(b.ob)("user.settings.notifications.emailNotifications","Email Notifications"),inputs:[l.a.createElement("div",{key:"oauthEmailInfo",className:"pt-2"},l.a.createElement(g.a,{id:"user.settings.notifications.email.disabled_long",defaultMessage:"Email notifications have not been enabled by your System Administrator."}))],server_error:this.props.serverError,section:"email",updateSection:this.handleUpdateSection});const{newInterval:e}=this.state;let t=null,a=null;return this.props.enableEmailBatching&&(t=l.a.createElement("fieldset",null,l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"emailNotificationMinutes",type:"radio",name:"emailNotifications",checked:e===h.F.INTERVAL_FIFTEEN_MINUTES,"data-enable-email":"true","data-email-interval":h.F.INTERVAL_FIFTEEN_MINUTES,onChange:this.handleChange}),l.a.createElement(g.a,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count} minutes",values:{count:h.F.INTERVAL_FIFTEEN_MINUTES/60}}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"emailNotificationHour",type:"radio",name:"emailNotifications",checked:e===h.F.INTERVAL_HOUR,"data-enable-email":"true","data-email-interval":h.F.INTERVAL_HOUR,onChange:this.handleChange}),l.a.createElement(g.a,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"})))),a=l.a.createElement(g.a,{id:"user.settings.notifications.emailBatchingInfo",defaultMessage:"Notifications received over the time period selected are combined and sent in a single email."})),l.a.createElement(v.a,{title:Object(b.ob)("user.settings.notifications.emailNotifications","Email Notifications"),inputs:[l.a.createElement("fieldset",{key:"userNotificationEmailOptions"},l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.notifications.email.send",defaultMessage:"Send email notifications"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"emailNotificationImmediately",type:"radio",name:"emailNotifications",checked:e===h.F.INTERVAL_IMMEDIATE,"data-enable-email":"true","data-email-interval":h.F.INTERVAL_IMMEDIATE,onChange:this.handleChange}),l.a.createElement(g.a,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"}))),t,l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"emailNotificationNever",type:"radio",name:"emailNotifications",checked:e===h.F.INTERVAL_NEVER,"data-enable-email":"false","data-email-interval":h.F.INTERVAL_NEVER,onChange:this.handleChange}),l.a.createElement(g.a,{id:"user.settings.notifications.email.never",defaultMessage:"Never"}))),l.a.createElement("div",{className:"mt-3"},l.a.createElement(g.a,{id:"user.settings.notifications.emailInfo",defaultMessage:"Email notifications are sent for mentions and direct messages when you are offline or away for more than 5 minutes."})," ",a))],submit:this.handleSubmit,saving:this.props.saving,server_error:this.props.serverError,updateSection:this.handleUpdateSection})});const{emailInterval:t,enableEmail:a,enableEmailBatching:s,sendEmailNotifications:i,activeSection:n}=e;this.state={activeSection:n,emailInterval:t,enableEmail:a,enableEmailBatching:s,sendEmailNotifications:i,newInterval:Object(Je.getEmailInterval)(JSON.parse(a)&&i,s,t)}}static getDerivedStateFromProps(e,t){const{emailInterval:a,enableEmail:s,enableEmailBatching:i,sendEmailNotifications:n,activeSection:r}=e;return"email"===r&&"email"!==t.activeSection||n!==t.sendEmailNotifications||i!==t.enableEmailBatching||a!==t.emailInterval||r!==t.activeSection?{activeSection:r,emailInterval:a,enableEmail:s,enableEmailBatching:i,sendEmailNotifications:n,newInterval:Object(Je.getEmailInterval)(JSON.parse(s)&&n,i,a)}:null}render(){return"email"!==this.props.activeSection?this.renderMinSettingView():this.renderMaxSettingView()}}Xe(Qe,"propTypes",{currentUserId:r.a.string.isRequired,activeSection:r.a.string.isRequired,updateSection:r.a.func.isRequired,enableEmail:r.a.string.isRequired,emailInterval:r.a.number.isRequired,onSubmit:r.a.func.isRequired,onCancel:r.a.func.isRequired,onChange:r.a.func.isRequired,serverError:r.a.string,saving:r.a.bool,sendEmailNotifications:r.a.bool.isRequired,enableEmailBatching:r.a.bool.isRequired,actions:r.a.shape({savePreferences:r.a.func.isRequired}).isRequired});var $e=Object(s.connect)((function(e){const t=Object(d.getConfig)(e),a=parseInt(Object(u.get)(e,O.Preferences.CATEGORY_NOTIFICATIONS,O.Preferences.EMAIL_INTERVAL,O.Preferences.INTERVAL_NOT_SET.toString()),10);return{currentUserId:Object(Ze.getCurrentUserId)(e),emailInterval:a,enableEmailBatching:"true"===t.EnableEmailBatching,sendEmailNotifications:"true"===t.SendEmailNotifications}}),(function(e){return{actions:Object(c.bindActionCreators)({savePreferences:m.savePreferences},e)}}))(Qe),et=a(1389);function tt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class at extends l.a.PureComponent{constructor(...e){super(...e),tt(this,"handleAutoResponderChecked",e=>{this.props.setParentState("autoResponderActive",e.target.checked)}),tt(this,"onMessageChanged",e=>{this.props.setParentState("autoResponderMessage",e.target.value)})}render(){const{autoResponderActive:e,autoResponderMessage:t}=this.props;let a;this.props.error&&(a=l.a.createElement("label",{className:"has-error"},this.props.error));const s=[],i=l.a.createElement("div",{id:"autoResponderCheckbox",key:"autoResponderCheckbox",className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"autoResponderActive",type:"checkbox",checked:e,onChange:this.handleAutoResponderChecked}),l.a.createElement(g.a,{id:"user.settings.notifications.autoResponderEnabled",defaultMessage:"Enabled"}))),n=l.a.createElement("div",{id:"autoResponderMessage",key:"autoResponderMessage"},l.a.createElement("div",{className:"pt-2"},l.a.createElement(et.a,{style:{resize:"none"},id:"autoResponderMessageInput",className:"form-control",rows:"5",placeholder:Object(b.ob)("user.settings.notifications.autoResponderPlaceholder","Message"),value:t,maxLength:200,onChange:this.onMessageChanged}),a));return s.push(i),e&&s.push(n),s.push(l.a.createElement("div",{key:"autoResponderHint",className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.notifications.autoResponderHint",defaultMessage:"Set a custom message that will be automatically sent in response to Direct Messages. Mentions in Public and Private Channels will not trigger the automated reply. Enabling Automatic Replies sets your status to Out of Office and disables email and push notifications."}))),l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.notifications.autoResponder",defaultMessage:"Automatic Direct Message Replies"}),width:"medium",shiftEnter:!0,submit:this.props.submit,saving:this.props.saving,inputs:s,updateSection:this.props.updateSection})}}function st(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function it(e){const t=e.user;let a=h.z.MENTION,s="true",i="Bing",n="never",r="true",o=h.z.MENTION,l=h.Z.UserStatuses.AWAY,c=!1,d=b.ob("user.settings.notifications.autoResponderDefault","Hello, I am out of office and unable to respond to messages.");t.notify_props&&(t.notify_props.desktop&&(a=t.notify_props.desktop),t.notify_props.desktop_sound&&(s=t.notify_props.desktop_sound),t.notify_props.desktop_notification_sound&&(i=t.notify_props.desktop_notification_sound),t.notify_props.comments&&(n=t.notify_props.comments),t.notify_props.email&&(r=t.notify_props.email),t.notify_props.push&&(o=t.notify_props.push),t.notify_props.push_status&&(l=t.notify_props.push_status),t.notify_props.auto_responder_active&&(c="true"===t.notify_props.auto_responder_active),t.notify_props.auto_responder_message&&(d=t.notify_props.auto_responder_message));let u=!1,m="",p=!1,g=!1;if(t.notify_props){if(t.notify_props.mention_keys){const e=t.notify_props.mention_keys.split(",");-1===e.indexOf(t.username)?u=!1:(u=!0,e.splice(e.indexOf(t.username),1),-1!==e.indexOf("@".concat(t.username))&&e.splice(e.indexOf("@".concat(t.username)),1)),m=e.join(",")}t.notify_props.first_name&&(p="true"===t.notify_props.first_name),t.notify_props.channel&&(g="true"===t.notify_props.channel)}return{desktopActivity:a,enableEmail:r,pushActivity:o,pushStatus:l,desktopSound:s,desktopNotificationSound:i,usernameKey:u,customKeys:m,customKeysChecked:m.length>0,firstNameKey:p,channelKey:g,autoResponderActive:c,autoResponderMessage:d,notifyCommentsLevel:n,isSaving:!1}}tt(at,"propTypes",{autoResponderActive:r.a.bool.isRequired,autoResponderMessage:r.a.string.isRequired,updateSection:r.a.func.isRequired,setParentState:r.a.func.isRequired,submit:r.a.func.isRequired,saving:r.a.bool.isRequired,error:r.a.string});class nt extends l.a.PureComponent{constructor(e){super(e),st(this,"handleSubmit",()=>{const e={};e.email=this.state.enableEmail,e.desktop_sound=this.state.desktopSound,(!Object(Ye.e)()||window.desktop&&He.a.gte(window.desktop.version,"4.6.0"))&&(e.desktop_notification_sound=this.state.desktopNotificationSound),e.desktop=this.state.desktopActivity,e.push=this.state.pushActivity,e.push_status=this.state.pushStatus,e.comments=this.state.notifyCommentsLevel,e.auto_responder_active=this.state.autoResponderActive.toString(),e.auto_responder_message=this.state.autoResponderMessage,e.auto_responder_message&&""!==e.auto_responder_message||(e.auto_responder_message=b.ob("user.settings.notifications.autoResponderDefault","Hello, I am out of office and unable to respond to messages."));const t=[];this.state.usernameKey&&t.push(this.props.user.username);let a=t.join(",");this.state.customKeys.length>0&&this.state.customKeysChecked&&(a+=","+this.state.customKeys),e.mention_keys=a,e.first_name=this.state.firstNameKey.toString(),e.channel=this.state.channelKey.toString(),this.setState({isSaving:!0}),this.props.actions.updateMe({notify_props:e}).then(({data:e,error:t})=>{e?(this.handleUpdateSection(""),this.setState(it(this.props))):t&&this.setState({serverError:t.message,isSaving:!1})})}),st(this,"handleCancel",e=>{e&&e.preventDefault(),this.setState(it(this.props))}),st(this,"handleUpdateSection",e=>{e?this.props.updateSection(e):this.props.updateSection(""),this.setState({isSaving:!1}),this.handleCancel()}),st(this,"setStateValue",(e,t)=>{const a={};a[e]=t,this.setState(a)}),st(this,"handleEmailRadio",e=>{this.setState({enableEmail:e})}),st(this,"updateUsernameKey",e=>{this.setState({usernameKey:e})}),st(this,"updateFirstNameKey",e=>{this.setState({firstNameKey:e})}),st(this,"updateChannelKey",e=>{this.setState({channelKey:e})}),st(this,"updateCustomMentionKeys",()=>{if(this.customCheckRef.current.checked){const e=this.customMentionsRef.current.value;this.setState({customKeys:e.replace(/ /g,""),customKeysChecked:!0})}else this.setState({customKeys:"",customKeysChecked:!1})}),st(this,"onCustomChange",()=>{this.customCheckRef.current.checked=!0,this.updateCustomMentionKeys()}),st(this,"createPushNotificationSection",()=>{if("push"===this.props.activeSection){const e=[];let t=null,a=null;if(this.props.sendPushNotifications){const s=[!1,!1,!1];this.state.pushActivity===h.z.ALL?s[0]=!0:this.state.pushActivity===h.z.NONE?s[2]=!0:s[1]=!0;const i=[!1,!1,!1];let n;this.state.pushStatus===h.Z.UserStatuses.ONLINE?i[0]=!0:this.state.pushStatus===h.Z.UserStatuses.AWAY?i[1]=!0:i[2]=!0,this.state.pushActivity!==h.z.NONE&&(n=l.a.createElement("fieldset",null,l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.notifications.push_notification.status",defaultMessage:"Trigger push notifications when"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationOnline",type:"radio",name:"pushNotificationStatus",checked:i[0],onChange:this.handlePushStatusRadio.bind(this,h.Z.UserStatuses.ONLINE)}),l.a.createElement(g.a,{id:"user.settings.push_notification.online",defaultMessage:"Online, away or offline"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationAway",type:"radio",name:"pushNotificationStatus",checked:i[1],onChange:this.handlePushStatusRadio.bind(this,h.Z.UserStatuses.AWAY)}),l.a.createElement(g.a,{id:"user.settings.push_notification.away",defaultMessage:"Away or offline"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationOffline",type:"radio",name:"pushNotificationStatus",checked:i[2],onChange:this.handlePushStatusRadio.bind(this,h.Z.UserStatuses.OFFLINE)}),l.a.createElement(g.a,{id:"user.settings.push_notification.offline",defaultMessage:"Offline"})))),t=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.push_notification.status_info",defaultMessage:"Notification alerts are only pushed to your mobile device when your online status matches the selection above."}))),e.push(l.a.createElement("div",null,l.a.createElement("fieldset",{key:"userNotificationLevelOption"},l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.push_notification.send",defaultMessage:"Send mobile push notifications"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationAllActivity",type:"radio",name:"pushNotificationLevel",checked:s[0],onChange:this.handlePushRadio.bind(this,h.z.ALL)}),l.a.createElement(g.a,{id:"user.settings.push_notification.allActivity",defaultMessage:"For all activity"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationMentions",type:"radio",name:"pushNotificationLevel",checked:s[1],onChange:this.handlePushRadio.bind(this,h.z.MENTION)}),l.a.createElement(g.a,{id:"user.settings.push_notification.onlyMentions",defaultMessage:"For mentions and direct messages"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"pushNotificationNever",type:"radio",name:"pushNotificationLevel",checked:s[2],onChange:this.handlePushRadio.bind(this,h.z.NONE)}),l.a.createElement(g.a,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.push_notification.info",defaultMessage:"Notification alerts are pushed to your mobile device when there is activity in Mattermost."}))),l.a.createElement("hr",null),n)),a=this.handleSubmit}else e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"pt-2"},l.a.createElement(g.a,{id:"user.settings.push_notification.disabled_long",defaultMessage:"Push notifications have not been enabled by your System Administrator."})));return l.a.createElement(v.a,{title:b.ob("user.settings.notifications.push","Mobile Push Notifications"),extraInfo:t,inputs:e,submit:a,server_error:this.state.serverError,updateSection:this.handleUpdateSection})}let e="";return e=this.state.pushActivity===h.z.ALL?this.state.pushStatus===h.Z.UserStatuses.AWAY?l.a.createElement(g.a,{id:"user.settings.push_notification.allActivityAway",defaultMessage:"For all activity when away or offline"}):this.state.pushStatus===h.Z.UserStatuses.OFFLINE?l.a.createElement(g.a,{id:"user.settings.push_notification.allActivityOffline",defaultMessage:"For all activity when offline"}):l.a.createElement(g.a,{id:"user.settings.push_notification.allActivityOnline",defaultMessage:"For all activity when online, away or offline"}):this.state.pushActivity===h.z.NONE?l.a.createElement(g.a,{id:"user.settings.notifications.never",defaultMessage:"Never"}):this.props.sendPushNotifications?this.state.pushStatus===h.Z.UserStatuses.AWAY?l.a.createElement(g.a,{id:"user.settings.push_notification.onlyMentionsAway",defaultMessage:"For mentions and direct messages when away or offline"}):this.state.pushStatus===h.Z.UserStatuses.OFFLINE?l.a.createElement(g.a,{id:"user.settings.push_notification.onlyMentionsOffline",defaultMessage:"For mentions and direct messages when offline"}):l.a.createElement(g.a,{id:"user.settings.push_notification.onlyMentionsOnline",defaultMessage:"For mentions and direct messages when online, away or offline"}):l.a.createElement(g.a,{id:"user.settings.push_notification.disabled",defaultMessage:"Push notifications are not enabled"}),l.a.createElement(S.a,{title:b.ob("user.settings.notifications.push","Mobile Push Notifications"),describe:e,section:"push",updateSection:this.handleUpdateSection})}),this.state=it(e),this.customCheckRef=l.a.createRef(),this.customMentionsRef=l.a.createRef(),this.drawerRef=l.a.createRef(),this.wrapperRef=l.a.createRef()}handleNotifyCommentsRadio(e){this.setState({notifyCommentsLevel:e})}handlePushRadio(e){this.setState({pushActivity:e})}handlePushStatusRadio(e){this.setState({pushStatus:e})}render(){const e=this.state.serverError,t=this.props.user;let a,s,i;if("keys"===this.props.activeSection){const s=[];if(t.first_name){const e=e=>{this.updateFirstNameKey(e.target.checked)};s.push(l.a.createElement("div",{key:"userNotificationFirstNameOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationTriggerFirst",type:"checkbox",checked:this.state.firstNameKey,onChange:e}),l.a.createElement(g.a,{id:"user.settings.notifications.sensitiveName",defaultMessage:'Your case sensitive first name "{first_name}"',values:{first_name:t.first_name}})))))}const i=e=>{this.updateUsernameKey(e.target.checked)};s.push(l.a.createElement("div",{key:"userNotificationUsernameOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationTriggerUsername",type:"checkbox",checked:this.state.usernameKey,onChange:i}),l.a.createElement(g.a,{id:"user.settings.notifications.sensitiveUsername",defaultMessage:'Your non case-sensitive username "{username}"',values:{username:t.username}})))));const n=e=>{this.updateChannelKey(e.target.checked)};s.push(l.a.createElement("div",{key:"userNotificationChannelOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationTriggerShouts",type:"checkbox",checked:this.state.channelKey,onChange:n}),l.a.createElement(g.a,{id:"user.settings.notifications.channelWide",defaultMessage:'Channel-wide mentions "@channel", "@all", "@here"'}))))),s.push(l.a.createElement("div",{key:"userNotificationCustomOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationTriggerCustom",ref:this.customCheckRef,type:"checkbox",checked:this.state.customKeysChecked,onChange:this.updateCustomMentionKeys}),l.a.createElement(g.a,{id:"user.settings.notifications.sensitiveWords",defaultMessage:"Other non-case sensitive words, separated by commas:"}))),l.a.createElement("input",{id:"notificationTriggerCustomText",autoFocus:this.state.customKeysChecked,ref:this.customMentionsRef,className:"form-control mentions-input",type:"text",defaultValue:this.state.customKeys,onChange:this.onCustomChange,onFocus:b.qb,"aria-labelledby":"notificationTriggerCustom"})));const r=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.notifications.mentionsInfo",defaultMessage:"Mentions trigger when someone sends a message that includes your username (@{username}) or any of the options selected above.",values:{username:t.username}}));a=l.a.createElement(v.a,{title:b.ob("user.settings.notifications.wordsTrigger","Words That Trigger Mentions"),inputs:s,submit:this.handleSubmit,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection,extraInfo:r})}else{let e=["@"+t.username];this.state.firstNameKey&&e.push(t.first_name),this.state.usernameKey&&e.push(t.username),this.state.channelKey&&(e.push("@channel"),e.push("@all"),e.push("@here")),this.state.customKeys.length>0&&(e=e.concat(this.state.customKeys.split(",")));let s="";for(let t=0;t<e.length;t++)""!==e[t]&&(s+='"'+e[t]+'", ');s=s.length>0?s.substring(0,s.length-2):l.a.createElement(g.a,{id:"user.settings.notifications.noWords",defaultMessage:"No words configured"}),a=l.a.createElement(S.a,{title:b.ob("user.settings.notifications.wordsTrigger","Words That Trigger Mentions"),describe:s,section:"keys",updateSection:this.handleUpdateSection})}if("comments"===this.props.activeSection){const t=[!1,!1,!1];"never"===this.state.notifyCommentsLevel?t[2]=!0:"root"===this.state.notifyCommentsLevel?t[1]=!0:t[0]=!0;const a=[];a.push(l.a.createElement("fieldset",{key:"userNotificationLevelOption"},l.a.createElement("legend",{className:"form-legend hidden-label"},b.ob("user.settings.notifications.comments","Reply notifications")),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationCommentsAny",type:"radio",name:"commentsNotificationLevel",checked:t[0],onChange:this.handleNotifyCommentsRadio.bind(this,"any")}),l.a.createElement(g.a,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationCommentsRoot",type:"radio",name:"commentsNotificationLevel",checked:t[1],onChange:this.handleNotifyCommentsRadio.bind(this,"root")}),l.a.createElement(g.a,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"})),l.a.createElement("br",null)),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"notificationCommentsNever",type:"radio",name:"commentsNotificationLevel",checked:t[2],onChange:this.handleNotifyCommentsRadio.bind(this,"never")}),l.a.createElement(g.a,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"})))));const i=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.notifications.commentsInfo",defaultMessage:"In addition to notifications for when you're mentioned, select if you would like to receive notifications on reply threads."}));s=l.a.createElement(v.a,{title:b.ob("user.settings.notifications.comments","Reply notifications"),extraInfo:i,inputs:a,submit:this.handleSubmit,saving:this.state.isSaving,server_error:e,updateSection:this.handleUpdateSection})}else{let e="";e="never"===this.state.notifyCommentsLevel?l.a.createElement(g.a,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"}):"root"===this.state.notifyCommentsLevel?l.a.createElement(g.a,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"}):l.a.createElement(g.a,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"}),s=l.a.createElement(S.a,{title:b.ob("user.settings.notifications.comments","Reply notifications"),describe:e,section:"comments",updateSection:this.handleUpdateSection})}if(this.props.enableAutoResponder)if("auto-responder"===this.props.activeSection)i=l.a.createElement("div",null,l.a.createElement(at,{autoResponderActive:this.state.autoResponderActive,autoResponderMessage:this.state.autoResponderMessage,updateSection:this.handleUpdateSection,setParentState:this.setStateValue,submit:this.handleSubmit,error:this.state.serverError,saving:this.state.isSaving}),l.a.createElement("div",{className:"divider-dark"}));else{const e=this.state.autoResponderActive?l.a.createElement(g.a,{id:"user.settings.notifications.autoResponderEnabled",defaultMessage:"Enabled"}):l.a.createElement(g.a,{id:"user.settings.notifications.autoResponderDisabled",defaultMessage:"Disabled"});i=l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.notifications.autoResponder",defaultMessage:"Automatic Direct Message Replies"}),width:"medium",describe:e,section:"auto-responder",updateSection:this.handleUpdateSection})}const n=this.createPushNotificationSection();return l.a.createElement("div",{id:"notificationSettings"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal",onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×")),l.a.createElement("h4",{className:"modal-title",ref:this.drawerRef},l.a.createElement("div",{className:"modal-back"},l.a.createElement(g.a,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},e=>l.a.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal}))),l.a.createElement(g.a,{id:"user.settings.notifications.title",defaultMessage:"Notification Settings"}))),l.a.createElement("div",{ref:this.wrapperRef,className:"user-settings"},l.a.createElement("h3",{id:"notificationSettingsTitle",className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.notifications.header",defaultMessage:"Notifications"})),l.a.createElement("div",{className:"divider-dark first"}),l.a.createElement(Ke,{activity:this.state.desktopActivity,sound:this.state.desktopSound,updateSection:this.handleUpdateSection,setParentState:this.setStateValue,submit:this.handleSubmit,saving:this.state.isSaving,cancel:this.handleCancel,error:this.state.serverError,active:"desktop"===this.props.activeSection,selectedSound:this.state.desktopNotificationSound}),l.a.createElement("div",{className:"divider-light"}),l.a.createElement($e,{activeSection:this.props.activeSection,updateSection:this.handleUpdateSection,enableEmail:"true"===this.state.enableEmail,onSubmit:this.handleSubmit,onCancel:this.handleCancel,onChange:this.handleEmailRadio,saving:this.state.isSaving,serverError:this.state.serverError}),l.a.createElement("div",{className:"divider-light"}),n,l.a.createElement("div",{className:"divider-light"}),a,l.a.createElement("div",{className:"divider-light"}),s,l.a.createElement("div",{className:"divider-light"}),i,l.a.createElement("div",{className:"divider-dark"})))}}st(nt,"propTypes",{user:r.a.object,updateSection:r.a.func,activeSection:r.a.string,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired,sendPushNotifications:r.a.bool,enableAutoResponder:r.a.bool,actions:r.a.shape({updateMe:r.a.func.isRequired}).isRequired}),st(nt,"defaultProps",{user:null,activeSection:"",activeTab:""});var rt=Object(s.connect)((function(e){const t=Object(d.getConfig)(e);return{sendPushNotifications:"true"===t.SendPushNotifications,enableAutoResponder:"true"===t.ExperimentalEnableAutomaticReplies}}),(function(e){return{actions:Object(c.bindActionCreators)({updateMe:p.updateMe},e)}}))(nt),ot=a(1167),lt=a(39),ct=a(1127),dt=a(280),ut=a(1483),mt=a(1478),pt=a(1145);function ht(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class gt extends l.a.PureComponent{constructor(e){super(e),ht(this,"onShow",()=>{this.props.actions.getUserAudits(this.props.currentUserId,0,200)}),ht(this,"onHide",()=>{this.setState({show:!1})}),this.state={show:!0}}componentDidMount(){this.onShow()}render(){let e;return e=0===this.props.userAudits.length?l.a.createElement(pt.a,null):l.a.createElement(mt.a,{audits:this.props.userAudits,showIp:!0,showSession:!0}),l.a.createElement(ut.a,{dialogClassName:"a11y__modal modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large",role:"dialog","aria-labelledby":"accessHistoryModalLabel"},l.a.createElement(ut.a.Header,{closeButton:!0},l.a.createElement(ut.a.Title,{componentClass:"h1",id:"accessHistoryModalLabel"},l.a.createElement(g.a,{id:"access_history.title",defaultMessage:"Access History"}))),l.a.createElement(ut.a.Body,null,e),l.a.createElement(ut.a.Footer,{className:"modal-footer--invisible"},l.a.createElement("button",{id:"closeModalButton",type:"button",className:"btn btn-link"},l.a.createElement(g.a,{id:"general_button.close",defaultMessage:"Close"}))))}}ht(gt,"propTypes",{onHide:r.a.func.isRequired,actions:r.a.shape({getUserAudits:r.a.func.isRequired}).isRequired,userAudits:r.a.arrayOf(r.a.any).isRequired,currentUserId:r.a.string.isRequired});var ft=Object(s.connect)((function(e){return{currentUserId:Object(i.getCurrentUserId)(e),userAudits:Object(i.getUserAudits)(e)||[]}}),(function(e){return{actions:Object(c.bindActionCreators)({getUserAudits:p.getUserAudits},e)}}))(gt),bt=a(188);a(127);function Et(e){const{locale:t,currentSession:a,handleMoreInfo:s,moreInfo:i}=e;if(i){const e=new Date(a.create_at);return l.a.createElement("div",null,l.a.createElement("div",null,l.a.createElement(g.a,{id:"activity_log.firstTime",defaultMessage:"First time active: {date}, {time}",values:{date:l.a.createElement(B.a,{value:e,day:"2-digit",month:Object(E.a)(t),year:"numeric"}),time:l.a.createElement(B.c,{value:e,hour:"2-digit",minute:"2-digit"})}})),l.a.createElement("div",null,l.a.createElement(g.a,{id:"activity_log.os",defaultMessage:"OS: {os}",values:{os:a.props.os}})),l.a.createElement("div",null,l.a.createElement(g.a,{id:"activity_log.browser",defaultMessage:"Browser: {browser}",values:{browser:a.props.browser}})),l.a.createElement("div",null,l.a.createElement(g.a,{id:"activity_log.sessionId",defaultMessage:"Session ID: {id}",values:{id:a.id}})))}return l.a.createElement("a",{className:"theme",href:"#",onClick:s},l.a.createElement(g.a,{id:"activity_log.moreInfo",defaultMessage:"More info"}))}function vt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Et.propTypes={locale:r.a.string.isRequired,currentSession:r.a.shape({props:r.a.shape({os:r.a.string.isRequired,platform:r.a.string.isRequired,browser:r.a.string.isRequired}).isRequired,create_at:r.a.number.isRequired,last_activity_at:r.a.number.isRequired,id:r.a.string.isRequired}).isRequired,handleMoreInfo:r.a.func.isRequired,moreInfo:r.a.bool.isRequired};class St extends l.a.PureComponent{constructor(e){super(e),vt(this,"handleMoreInfo",()=>{this.setState({moreInfo:!0})}),vt(this,"submitRevoke",e=>{this.props.submitRevoke(this.props.currentSession.id,e)}),vt(this,"isMobileSession",e=>e.device_id&&(e.device_id.includes("apple")||e.device_id.includes("android"))),vt(this,"mobileSessionInfo",e=>{let t,a,s,i;return e.device_id.includes("apple")?(s="fa fa-apple",i=Object(b.ob)("device_icons.apple","Apple Icon"),t=Object(E.b)("activity_log_modal.iphoneNativeClassicApp"),a="iPhone Native Classic App",e.device_id.includes(O.General.PUSH_NOTIFY_APPLE_REACT_NATIVE)&&(t=Object(E.b)("activity_log_modal.iphoneNativeApp"),a="iPhone Native App")):e.device_id.includes("android")&&(s="fa fa-android",i=Object(b.ob)("device_icons.android","Android Icon"),t=Object(E.b)("activity_log_modal.androidNativeClassicApp"),a="Android Native Classic App",e.device_id.includes(O.General.PUSH_NOTIFY_ANDROID_REACT_NATIVE)&&(t=Object(E.b)("activity_log_modal.androidNativeApp"),a="Android Native App")),{devicePicture:s,deviceTitle:i,devicePlatform:l.a.createElement(g.a,{id:t,defaultMessage:a})}}),this.state={moreInfo:!1}}render(){const{index:e,locale:t,currentSession:a}=this.props,s=new Date(a.last_activity_at);let i=a.props.platform,n="",r="";if("Windows"===a.props.platform)n="fa fa-windows",r=Object(b.ob)("device_icons.windows","Windows Icon");else if(this.isMobileSession(a)){const e=this.mobileSessionInfo(a);n=e.devicePicture,i=e.devicePlatform}else"Macintosh"===a.props.platform||"iPhone"===a.props.platform?(n="fa fa-apple",r=Object(b.ob)("device_icons.apple","Apple Icon")):"Linux"===a.props.platform?a.props.os.indexOf("Android")>=0?(i=l.a.createElement(g.a,{id:"activity_log_modal.android",defaultMessage:"Android"}),n="fa fa-android",r=Object(b.ob)("device_icons.android","Android Icon")):(n="fa fa-linux",r=Object(b.ob)("device_icons.linux","Linux Icon")):-1!==a.props.os.indexOf("Linux")&&(n="fa fa-linux",r=Object(b.ob)("device_icons.linux","Linux Icon"));return-1!==a.props.browser.indexOf("Desktop App")&&(i=l.a.createElement(g.a,{id:"activity_log_modal.desktop",defaultMessage:"Native Desktop App"})),l.a.createElement("div",{key:"activityLogEntryKey"+e,className:"activity-log__table"},l.a.createElement("div",{className:"activity-log__report"},l.a.createElement("div",{className:"report__platform"},l.a.createElement("i",{className:n,title:r}),i),l.a.createElement("div",{className:"report__info"},l.a.createElement("div",null,l.a.createElement(g.a,{id:"activity_log.lastActivity",defaultMessage:"Last activity: {date}, {time}",values:{date:l.a.createElement(B.a,{value:s,day:"2-digit",month:Object(E.a)(t),year:"numeric"}),time:l.a.createElement(B.c,{value:s,hour:"2-digit",minute:"2-digit"})}})),l.a.createElement(Et,{locale:t,currentSession:a,moreInfo:this.state.moreInfo,handleMoreInfo:this.handleMoreInfo}))),l.a.createElement("div",{className:"activity-log__action"},l.a.createElement("button",{onClick:this.submitRevoke,className:"btn btn-primary"},l.a.createElement(g.a,{id:"activity_log.logout",defaultMessage:"Log Out"}))))}}function yt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}vt(St,"propTypes",{index:r.a.number.isRequired,locale:r.a.string.isRequired,currentSession:r.a.object.isRequired,submitRevoke:r.a.func.isRequired});class _t extends l.a.PureComponent{constructor(e){super(e),yt(this,"submitRevoke",(e,t)=>{t.preventDefault();var a=F()(t.target).closest(".modal-content");a.addClass("animation--highlight"),setTimeout(()=>{a.removeClass("animation--highlight")},1500),this.props.actions.revokeSession(this.props.currentUserId,e).then(()=>{this.props.actions.getSessions(this.props.currentUserId)})}),yt(this,"onShow",()=>{this.props.actions.getSessions(this.props.currentUserId)}),yt(this,"onHide",()=>{this.setState({show:!1})}),this.state={show:!0}}componentDidMount(){this.onShow()}render(){let e;if(this.props.sessions.loading)e=l.a.createElement(pt.a,null);else{const t=this.props.sessions.reduce((e,t,a)=>("UserAccessToken"===t.props.type||e.push(l.a.createElement(St,{key:t.id,index:a,locale:this.props.locale,currentSession:t,submitRevoke:this.submitRevoke})),e),[]);e=l.a.createElement("form",{role:"form"},t)}return l.a.createElement(ut.a,{dialogClassName:"a11y__modal modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large",role:"dialog","aria-labelledby":"activityLogModalLabel"},l.a.createElement(ut.a.Header,{closeButton:!0},l.a.createElement(ut.a.Title,{componentClass:"h1",id:"activityLogModalLabel"},l.a.createElement(g.a,{id:"activity_log.activeSessions",defaultMessage:"Active Sessions"}))),l.a.createElement(ut.a.Body,null,l.a.createElement("p",{className:"session-help-text"},l.a.createElement(g.a,{id:"activity_log.sessionsDescription",defaultMessage:"Sessions are created when you log in through a new browser on a device. Sessions let you use Mattermost without having to log in again for a time period specified by the system administrator. To end the session sooner, use the 'Log Out' button."})),e),l.a.createElement(ut.a.Footer,{className:"modal-footer--invisible"},l.a.createElement("button",{id:"closeModalButton",type:"button",className:"btn btn-link"},l.a.createElement(g.a,{id:"general_button.close",defaultMessage:"Close"}))))}}yt(_t,"propTypes",{currentUserId:r.a.string.isRequired,sessions:r.a.oneOfType([r.a.array,r.a.object]).isRequired,locale:r.a.string.isRequired,onHide:r.a.func.isRequired,actions:r.a.shape({getSessions:r.a.func.isRequired,revokeSession:r.a.func.isRequired}).isRequired});var Ot=Object(s.connect)((function(e){return{currentUserId:Object(i.getCurrentUserId)(e),sessions:Object(i.getUserSessions)(e),locale:Object(bt.a)(e)}}),(function(e){return{actions:Object(c.bindActionCreators)({getSessions:p.getSessions,revokeSession:p.revokeSession},e)}}))(_t),Mt=a(1211),Nt=a(1471),kt=a(93);function Ct(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class At extends l.a.PureComponent{constructor(e){super(e),Ct(this,"setupMfa",e=>{e.preventDefault(),kt.a.push("/mfa/setup")}),Ct(this,"removeMfa",async e=>{e.preventDefault();const{error:t}=await this.props.actions.deactivateMfa();t?this.setState({serverError:t.message}):this.props.mfaEnforced?kt.a.push("/mfa/setup"):(this.props.updateSection(""),this.setState({serverError:null}))}),Ct(this,"renderTitle",()=>l.a.createElement(g.a,{id:"user.settings.mfa.title",defaultMessage:"Multi-factor Authentication"})),Ct(this,"renderDescription",()=>this.props.mfaActive?l.a.createElement(g.a,{id:"user.settings.security.active",defaultMessage:"Active"}):l.a.createElement(g.a,{id:"user.settings.security.inactive",defaultMessage:"Inactive"})),Ct(this,"renderContent",()=>{let e;if(this.props.mfaActive){let t;t=this.props.mfaEnforced?l.a.createElement(g.a,{id:"user.settings.mfa.reset",defaultMessage:"Reset MFA on Account"}):l.a.createElement(g.a,{id:"user.settings.mfa.remove",defaultMessage:"Remove MFA from Account"}),e=l.a.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.removeMfa},t)}else e=l.a.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.setupMfa},l.a.createElement(g.a,{id:"user.settings.mfa.add",defaultMessage:"Add MFA to Account"}));return l.a.createElement("div",{className:"pt-2"},e,l.a.createElement("br",null))}),Ct(this,"renderHelpText",()=>this.props.mfaActive?this.props.mfaEnforced?l.a.createElement(g.a,{id:"user.settings.mfa.requiredHelp",defaultMessage:"Multi-factor authentication is required on this server. Resetting is only recommended when you need to switch code generation to a new mobile device. You will be required to set it up again immediately."}):l.a.createElement(g.a,{id:"user.settings.mfa.removeHelp",defaultMessage:"Removing multi-factor authentication means you will no longer require a phone-based passcode to sign-in to your account."}):l.a.createElement(g.a,{id:"user.settings.mfa.addHelp",defaultMessage:"Adding multi-factor authentication will make your account more secure by requiring a code from your mobile phone each time you sign in."})),this.state={serverError:null}}render(){const e=this.renderTitle();return this.props.mfaAvailable?this.props.active?l.a.createElement(v.a,{title:e,inputs:this.renderContent(),extraInfo:this.renderHelpText(),serverError:this.state.serverError,updateSection:this.props.updateSection,width:"medium"}):l.a.createElement(S.a,{title:e,describe:this.renderDescription(),section:"mfa",updateSection:this.props.updateSection}):null}}Ct(At,"propTypes",{active:r.a.bool.isRequired,mfaActive:r.a.bool.isRequired,mfaAvailable:r.a.bool.isRequired,mfaEnforced:r.a.bool.isRequired,updateSection:r.a.func.isRequired,actions:r.a.shape({deactivateMfa:r.a.func.isRequired}).isRequired});var Tt=Object(s.connect)((function(e){const t=Object(d.getLicense)(e),a=Object(d.getConfig)(e),s=t&&"true"===t.IsLicensed&&"true"===t.MFA,n="true"===a.EnableMultifactorAuthentication,r=s&&"true"===a.EnforceMultifactorAuthentication,o=Object(i.getCurrentUser)(e);let l=!1,c=!1;return o&&(l=o.mfa_active,c=n&&(""===o.auth_service||o.auth_service===h.Z.LDAP_SERVICE)),{mfaActive:l,mfaAvailable:c,mfaEnforced:r}}),(function(e){return{actions:Object(c.bindActionCreators)({deactivateMfa:Nt.b},e)}}))(At),wt=a(1173),Rt=a(1201);function Pt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class It extends l.a.PureComponent{constructor(e){super(e),Pt(this,"newtokendescriptionRef",void 0),Pt(this,"startCreatingToken",()=>{this.setState({tokenCreationState:"creating"})}),Pt(this,"stopCreatingToken",()=>{this.setState({tokenCreationState:"not_creating",saving:!1})}),Pt(this,"handleCreateToken",async()=>{this.handleCancelConfirm();const e=this.newtokendescriptionRef?this.newtokendescriptionRef.current.value:"";if(""===e)return void this.setState({tokenError:b.ob("user.settings.tokens.nameRequired","Please enter a description.")});this.setState({tokenError:"",saving:!0}),this.props.setRequireConfirm(!0,this.confirmCopyToken);const t=this.props.user?this.props.user.id:"",{data:a,error:s}=await this.props.actions.createUserAccessToken(t,e);a&&"creating"===this.state.tokenCreationState?this.setState({tokenCreationState:"created",newToken:a,saving:!1}):s&&this.setState({serverError:s.message,saving:!1})}),Pt(this,"confirmCopyToken",e=>{this.setState({showConfirmModal:!0,confirmTitle:l.a.createElement(g.a,{id:"user.settings.tokens.confirmCopyTitle",defaultMessage:"Copied Your Token?"}),confirmMessage:e=>l.a.createElement("div",null,l.a.createElement(g.a,{id:"user.settings.tokens.confirmCopyMessage",defaultMessage:"Make sure you have copied and saved the access token below. You won't be able to see it again!"}),l.a.createElement("br",null),l.a.createElement("br",null),"creating"===e.tokenCreationState?l.a.createElement("div",null,l.a.createElement("strong",{className:"word-break--all"},l.a.createElement(g.a,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "})),l.a.createElement(g.a,{id:"user.settings.tokens.tokenLoading",defaultMessage:"Loading..."})):l.a.createElement("strong",{className:"word-break--all"},l.a.createElement(g.a,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),e.newToken.token)),confirmButton:l.a.createElement(g.a,{id:"user.settings.tokens.confirmCopyButton",defaultMessage:"Yes, I have copied the token"}),confirmComplete:()=>{this.handleCancelConfirm(),e()},confirmHideCancel:!0})}),Pt(this,"handleCancelConfirm",()=>{this.setState({showConfirmModal:!1,confirmTitle:null,confirmMessage:null,confirmButton:null,confirmComplete:null,confirmHideCancel:!1})}),Pt(this,"confirmCreateToken",()=>{lt.isSystemAdmin(this.props.user.roles)?this.setState({showConfirmModal:!0,confirmTitle:l.a.createElement(g.a,{id:"user.settings.tokens.confirmCreateTitle",defaultMessage:"Create System Admin Personal Access Token"}),confirmMessage:()=>l.a.createElement("div",{className:"alert alert-danger"},l.a.createElement(g.a,{id:"user.settings.tokens.confirmCreateMessage",defaultMessage:"You are generating a personal access token with System Admin permissions. Are you sure want to create this token?"})),confirmButton:l.a.createElement(g.a,{id:"user.settings.tokens.confirmCreateButton",defaultMessage:"Yes, Create"}),confirmComplete:()=>{this.handleCreateToken(),Object(Le.e)("settings","system_admin_create_user_access_token")}}):this.handleCreateToken()}),Pt(this,"saveTokenKeyPress",e=>{b.cb(e,h.Z.KeyCodes.ENTER)&&this.confirmCreateToken()}),Pt(this,"confirmRevokeToken",e=>{const t=this.props.userAccessTokens[e];this.setState({showConfirmModal:!0,confirmTitle:l.a.createElement(g.a,{id:"user.settings.tokens.confirmDeleteTitle",defaultMessage:"Delete Token?"}),confirmMessage:()=>l.a.createElement("div",{className:"alert alert-danger"},l.a.createElement(Se.b,{id:"user.settings.tokens.confirmDeleteMessage",defaultMessage:"Any integrations using this token will no longer be able to access the Mattermost API. You cannot undo this action. \\n \\nAre you sure want to delete the **{description}** token?",values:{description:t.description}})),confirmButton:l.a.createElement(g.a,{id:"user.settings.tokens.confirmDeleteButton",defaultMessage:"Yes, Delete"}),confirmComplete:()=>{this.revokeToken(e),Object(Le.e)("settings","revoke_user_access_token")}})}),Pt(this,"revokeToken",async e=>{const{error:t}=await this.props.actions.revokeUserAccessToken(e);t&&this.setState({serverError:t.message}),this.handleCancelConfirm()}),Pt(this,"activateToken",async e=>{const{error:t}=await this.props.actions.enableUserAccessToken(e);t?this.setState({serverError:t.message}):Object(Le.e)("settings","activate_user_access_token")}),Pt(this,"deactivateToken",async e=>{const{error:t}=await this.props.actions.disableUserAccessToken(e);t?this.setState({serverError:t.message}):Object(Le.e)("settings","deactivate_user_access_token")}),this.state={active:this.props.active,showConfirmModal:!1,newToken:null,tokenCreationState:"not_creating",tokenError:"",serverError:null,saving:!1},this.newtokendescriptionRef=l.a.createRef()}componentDidMount(){this.props.actions.clearUserAccessTokens();const e=this.props.user?this.props.user.id:"";this.props.actions.getUserAccessTokensForUser(e,0,200)}static getDerivedStateFromProps(e,t){return!e.active&&t.active?{active:e.active,showConfirmModal:!1,newToken:null,tokenCreationState:"not_creating",tokenError:"",serverError:null,saving:!1}:{active:e.active}}render(){let e="";if(!this.props.active){const e=b.ob("user.settings.tokens.clickToEdit","Click 'Edit' to manage your personal access tokens");return l.a.createElement(S.a,{title:b.ob("user.settings.tokens.title","Personal Access Tokens"),describe:e,section:"tokens",updateSection:this.props.updateSection})}const t=[];let a,s,i;Object.values(this.props.userAccessTokens).forEach(e=>{if(this.state.newToken&&this.state.newToken.id===e.id)return;let a,s;e.is_active?a=l.a.createElement("a",{id:e.id+"_deactivate",href:"#",onClick:t=>{t.preventDefault(),this.deactivateToken(e.id)}},l.a.createElement(g.a,{id:"user.settings.tokens.deactivate",defaultMessage:"Disable"})):(s=l.a.createElement("span",{className:"has-error setting-box__inline-error"},l.a.createElement(g.a,{id:"user.settings.tokens.deactivatedWarning",defaultMessage:"(Disabled)"})),a=l.a.createElement("a",{id:e.id+"_activate",href:"#",onClick:t=>{t.preventDefault(),this.activateToken(e.id)}},l.a.createElement(g.a,{id:"user.settings.tokens.activate",defaultMessage:"Enable"}))),t.push(l.a.createElement("div",{key:e.id,className:"setting-box__item"},l.a.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},l.a.createElement(g.a,{id:"user.settings.tokens.tokenDesc",defaultMessage:"Token Description: "}),e.description,s),l.a.createElement("div",{className:"setting-box__token-id whitespace--nowrap overflow--ellipsis"},l.a.createElement(g.a,{id:"user.settings.tokens.tokenId",defaultMessage:"Token ID: "}),e.id),l.a.createElement("div",null,a," - ",l.a.createElement("a",{id:e.id+"_delete",href:"#",onClick:t=>{t.preventDefault(),this.confirmRevokeToken(e.id)}},l.a.createElement(g.a,{id:"user.settings.tokens.delete",defaultMessage:"Delete"}))),l.a.createElement("hr",{className:"mb-3 mt-3"})))}),0===t.length&&(a=l.a.createElement(g.a,{key:"notokens",id:"user.settings.tokens.userAccessTokensNone",defaultMessage:"No personal access tokens."})),s=Object(Ye.p)()?l.a.createElement("span",null,l.a.createElement(Se.b,{id:"user.settings.tokens.description_mobile",defaultMessage:"[Personal access tokens](!https://about.mattermost.com/default-user-access-tokens) function similarly to session tokens and can be used by integrations to [authenticate against the REST API](!https://about.mattermost.com/default-api-authentication). Create new tokens on your desktop."})):l.a.createElement("span",null,l.a.createElement(Se.b,{id:"user.settings.tokens.description",defaultMessage:"[Personal access tokens](!https://about.mattermost.com/default-user-access-tokens) function similarly to session tokens and can be used by integrations to [authenticate against the REST API](!https://about.mattermost.com/default-api-authentication)."})),"creating"===this.state.tokenCreationState?i=l.a.createElement("div",{className:"pl-3"},l.a.createElement("div",{className:"row"},l.a.createElement("label",{className:"col-sm-auto control-label pr-3"},l.a.createElement(g.a,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "})),l.a.createElement("div",{className:"col-sm-5"},l.a.createElement("input",{autoFocus:!0,ref:this.newtokendescriptionRef,className:"form-control",type:"text",maxLength:64,onKeyPress:this.saveTokenKeyPress}))),l.a.createElement("div",null,l.a.createElement("div",{className:"pt-3"},l.a.createElement(g.a,{id:"user.settings.tokens.nameHelp",defaultMessage:"Enter a description for your token to remember what it does."})),l.a.createElement("div",null,l.a.createElement("label",{id:"clientError",className:"has-error mt-2 mb-2"},this.state.tokenError)),l.a.createElement(wt.a,{btnClass:"btn-primary",savingMessage:l.a.createElement(g.a,{id:"user.settings.tokens.save",defaultMessage:"Save"}),saving:this.state.saving,onClick:this.confirmCreateToken}),l.a.createElement("button",{className:"btn btn-link",onClick:this.stopCreatingToken},l.a.createElement(g.a,{id:"user.settings.tokens.cancel",defaultMessage:"Cancel"})))):"created"===this.state.tokenCreationState?(0===t.length&&(e=" hidden"),i=l.a.createElement("div",{className:"alert alert-warning"},l.a.createElement(Rt.a,{additionalClassName:"mr-2"}),l.a.createElement(g.a,{id:"user.settings.tokens.copy",defaultMessage:"Please copy the access token below. You won't be able to see it again!"}),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},l.a.createElement(g.a,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "}),this.state.newToken.description),l.a.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},l.a.createElement(g.a,{id:"user.settings.tokens.id",defaultMessage:"Token ID: "}),this.state.newToken.id),l.a.createElement("strong",{className:"word-break--all"},l.a.createElement(g.a,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),this.state.newToken.token))):i=l.a.createElement("a",{className:"btn btn-primary",href:"#",onClick:this.startCreatingToken},l.a.createElement(g.a,{id:"user.settings.tokens.create",defaultMessage:"Create Token"}));const n=[];return n.push(l.a.createElement("div",{key:"tokensSetting",className:"pt-2"},l.a.createElement("div",{key:"tokenList"},l.a.createElement("div",{className:"alert alert-transparent"+e},t,a),i))),l.a.createElement("div",null,l.a.createElement(v.a,{title:b.ob("user.settings.tokens.title","Personal Access Tokens"),inputs:n,extraInfo:s,infoPosition:"top",serverError:this.state.serverError,updateSection:this.props.updateSection,width:"full",saving:this.state.saving,cancelButtonText:l.a.createElement(g.a,{id:"user.settings.security.close",defaultMessage:"Close"})}),l.a.createElement(y.a,{title:this.state.confirmTitle,message:this.state.confirmMessage?this.state.confirmMessage(this.state):null,confirmButtonText:this.state.confirmButton,show:this.state.showConfirmModal,onConfirm:this.state.confirmComplete||(()=>null),onCancel:this.handleCancelConfirm,hideCancel:this.state.confirmHideCancel}))}}Pt(It,"propTypes",{user:r.a.any.isRequired,active:r.a.bool,updateSection:r.a.func.isRequired,userAccessTokens:r.a.objectOf(r.a.shape({description:r.a.string.isRequired,id:r.a.string.isRequired,is_active:r.a.bool.isRequired})).isRequired,setRequireConfirm:r.a.func.isRequired,actions:r.a.shape({getUserAccessTokensForUser:r.a.func.isRequired,createUserAccessToken:r.a.func.isRequired,revokeUserAccessToken:r.a.func.isRequired,enableUserAccessToken:r.a.func.isRequired,disableUserAccessToken:r.a.func.isRequired,clearUserAccessTokens:r.a.func.isRequired}).isRequired});var jt=Object(s.connect)((function(e){return{userAccessTokens:e.entities.users.myUserAccessTokens}}),(function(e){return{actions:Object(c.bindActionCreators)({getUserAccessTokensForUser:p.getUserAccessTokensForUser,createUserAccessToken:p.createUserAccessToken,revokeUserAccessToken:p.revokeUserAccessToken,enableUserAccessToken:p.enableUserAccessToken,disableUserAccessToken:p.disableUserAccessToken,clearUserAccessTokens:p.clearUserAccessTokens},e)}}))(It);function Dt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Lt extends l.a.PureComponent{constructor(e){super(e),Dt(this,"loadAuthorizedOAuthApps",async()=>{const e=await this.props.actions.getAuthorizedOAuthApps();if("data"in e){const{data:t}=e;this.setState({authorizedApps:t,serverError:null})}else if("error"in e){const{error:t}=e;this.setState({serverError:t.message})}}),Dt(this,"submitPassword",async()=>{const e=this.props.user,t=this.state.currentPassword,a=this.state.newPassword,s=this.state.confirmPassword;if(""===t)return void this.setState({passwordError:b.ob("user.settings.security.currentPasswordError","Please enter your current password."),serverError:""});const{valid:i,error:n}=b.lb(a,this.props.passwordConfig);if(!i&&n)return void this.setState({passwordError:n,serverError:""});if(a!==s){const e=Object.assign(this.getDefaultState(),{passwordError:b.ob("user.settings.security.passwordMatchError","The new passwords you entered do not match."),serverError:""});return void this.setState(e)}this.setState({savingPassword:!0});const r=await this.props.actions.updateUserPassword(e.id,t,a);if("data"in r)this.props.updateSection(""),this.props.actions.getMe(),this.setState(this.getDefaultState());else if("error"in r){const{error:e}=r,t=this.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,t.passwordError="",this.setState(t)}}),Dt(this,"updateCurrentPassword",e=>{this.setState({currentPassword:e.target.value})}),Dt(this,"updateNewPassword",e=>{this.setState({newPassword:e.target.value})}),Dt(this,"updateConfirmPassword",e=>{this.setState({confirmPassword:e.target.value})}),Dt(this,"deauthorizeApp",async e=>{e.preventDefault();const t=e.currentTarget.getAttribute("data-app"),a=await this.props.actions.deauthorizeOAuthApp(t);if("data"in a){const e=this.state.authorizedApps.filter(e=>e.id!==t);this.setState({authorizedApps:e,serverError:null})}else if("error"in a){const{error:e}=a;this.setState({serverError:e.message})}}),Dt(this,"handleUpdateSection",e=>{if(e)this.props.updateSection(e);else{switch(this.props.activeSection){case"mfa":case"signin":case"tokens":case"apps":this.setState({serverError:null});break;case"password":this.setState({currentPassword:"",newPassword:"",confirmPassword:"",serverError:null,passwordError:null})}this.props.updateSection("")}}),Dt(this,"createPasswordSection",()=>{if("password"===this.props.activeSection){const e=[];let t;return""===this.props.user.auth_service?(t=this.submitPassword,e.push(l.a.createElement("div",{key:"currentPasswordUpdateForm",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.security.currentPassword",defaultMessage:"Current Password"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"currentPassword",autoFocus:!0,className:"form-control",type:"password",onChange:this.updateCurrentPassword,value:this.state.currentPassword,"aria-label":b.ob("user.settings.security.currentPassword","Current Password")})))),e.push(l.a.createElement("div",{key:"newPasswordUpdateForm",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.security.newPassword",defaultMessage:"New Password"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"newPassword",className:"form-control",type:"password",onChange:this.updateNewPassword,value:this.state.newPassword,"aria-label":b.ob("user.settings.security.newPassword","New Password")})))),e.push(l.a.createElement("div",{key:"retypeNewPasswordUpdateForm",className:"form-group"},l.a.createElement("label",{className:"col-sm-5 control-label"},l.a.createElement(g.a,{id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"})),l.a.createElement("div",{className:"col-sm-7"},l.a.createElement("input",{id:"confirmPassword",className:"form-control",type:"password",onChange:this.updateConfirmPassword,value:this.state.confirmPassword,"aria-label":b.ob("user.settings.security.retypePassword","Retype New Password")}))))):this.props.user.auth_service===h.Z.GITLAB_SERVICE?e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"pb-3"},l.a.createElement(g.a,{id:"user.settings.security.passwordGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Password cannot be updated."})))):this.props.user.auth_service===h.Z.LDAP_SERVICE?e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"pb-3"},l.a.createElement(g.a,{id:"user.settings.security.passwordLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Password cannot be updated."})))):this.props.user.auth_service===h.Z.SAML_SERVICE?e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"pb-3"},l.a.createElement(g.a,{id:"user.settings.security.passwordSamlCantUpdate",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})))):this.props.user.auth_service===h.Z.GOOGLE_SERVICE?e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"pb-3"},l.a.createElement(g.a,{id:"user.settings.security.passwordGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Password cannot be updated."})))):this.props.user.auth_service===h.Z.OFFICE365_SERVICE&&e.push(l.a.createElement("div",{key:"oauthEmailInfo",className:"form-group"},l.a.createElement("div",{className:"pb-3"},l.a.createElement(g.a,{id:"user.settings.security.passwordOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Password cannot be updated."})))),l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.security.password",defaultMessage:"Password"}),inputs:e,submit:t,saving:this.state.savingPassword,serverError:this.state.serverError,clientError:this.state.passwordError,updateSection:this.handleUpdateSection})}let e;if(""===this.props.user.auth_service){const t=new Date(this.props.user.last_password_update);e=l.a.createElement(g.a,{id:"user.settings.security.lastUpdated",defaultMessage:"Last updated {date} at {time}",values:{date:l.a.createElement(B.a,{value:t,day:"2-digit",month:"short",year:"numeric"}),time:l.a.createElement(B.c,{value:t,hour12:!this.props.militaryTime,hour:"2-digit",minute:"2-digit"})}})}else this.props.user.auth_service===h.Z.GITLAB_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.security.loginGitlab",defaultMessage:"Login done through GitLab"}):this.props.user.auth_service===h.Z.LDAP_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.security.loginLdap",defaultMessage:"Login done through AD/LDAP"}):this.props.user.auth_service===h.Z.SAML_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.security.loginSaml",defaultMessage:"Login done through SAML"}):this.props.user.auth_service===h.Z.GOOGLE_SERVICE?e=l.a.createElement(g.a,{id:"user.settings.security.loginGoogle",defaultMessage:"Login done through Google Apps"}):this.props.user.auth_service===h.Z.OFFICE365_SERVICE&&(e=l.a.createElement(g.a,{id:"user.settings.security.loginOffice365",defaultMessage:"Login done through Office 365"}));return l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.security.password",defaultMessage:"Password"}),describe:e,section:"password",updateSection:this.handleUpdateSection})}),Dt(this,"createSignInSection",()=>{const e=this.props.user;if("signin"===this.props.activeSection){let t,a,s,i,n,r,o;if(""===e.auth_service)this.props.enableSignUpWithGitLab&&(a=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+h.Z.GITLAB_SERVICE},l.a.createElement(g.a,{id:"user.settings.security.switchGitlab",defaultMessage:"Switch to Using GitLab SSO"})),l.a.createElement("br",null))),this.props.enableSignUpWithGoogle&&(s=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+h.Z.GOOGLE_SERVICE},l.a.createElement(g.a,{id:"user.settings.security.switchGoogle",defaultMessage:"Switch to Using Google SSO"})),l.a.createElement("br",null))),this.props.enableSignUpWithOffice365&&(i=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+h.Z.OFFICE365_SERVICE},l.a.createElement(g.a,{id:"user.settings.security.switchOffice365",defaultMessage:"Switch to Using Office 365 SSO"})),l.a.createElement("br",null))),this.props.enableSignUpWithOpenId&&(n=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+h.Z.OPENID_SERVICE},l.a.createElement(g.a,{id:"user.settings.security.switchOpenId",defaultMessage:"Switch to Using OpenID SSO"})),l.a.createElement("br",null))),this.props.enableLdap&&(r=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_ldap?email="+encodeURIComponent(e.email)},l.a.createElement(g.a,{id:"user.settings.security.switchLdap",defaultMessage:"Switch to Using AD/LDAP"})),l.a.createElement("br",null))),this.props.enableSaml&&(o=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service+"&new_type="+h.Z.SAML_SERVICE},l.a.createElement(g.a,{id:"user.settings.security.switchSaml",defaultMessage:"Switch to Using SAML SSO"})),l.a.createElement("br",null)));else if(this.props.enableSignUpWithEmail){let a;a=e.auth_service===h.Z.LDAP_SERVICE?"/claim/ldap_to_email?email="+encodeURIComponent(e.email):"/claim/oauth_to_email?email="+encodeURIComponent(e.email)+"&old_type="+e.auth_service,t=l.a.createElement("div",{className:"pb-3"},l.a.createElement(ct.Link,{className:"btn btn-primary",to:a},l.a.createElement(g.a,{id:"user.settings.security.switchEmail",defaultMessage:"Switch to Using Email and Password"})),l.a.createElement("br",null))}const c=[];c.push(l.a.createElement("div",{key:"userSignInOption"},t,a,s,i,n,r,o));const d=l.a.createElement("span",null,l.a.createElement(g.a,{id:"user.settings.security.oneSignin",defaultMessage:"You may only have one sign-in method at a time. Switching sign-in method will send an email notifying you if the change was successful."}));return l.a.createElement(v.a,{title:b.ob("user.settings.security.method","Sign-in Method"),extraInfo:d,inputs:c,serverError:this.state.serverError,updateSection:this.handleUpdateSection})}let t=l.a.createElement(g.a,{id:"user.settings.security.emailPwd",defaultMessage:"Email and Password"});return this.props.user.auth_service===h.Z.GITLAB_SERVICE?t=l.a.createElement(g.a,{id:"user.settings.security.gitlab",defaultMessage:"GitLab"}):this.props.user.auth_service===h.Z.GOOGLE_SERVICE?t=l.a.createElement(g.a,{id:"user.settings.security.google",defaultMessage:"Google"}):this.props.user.auth_service===h.Z.OFFICE365_SERVICE?t=l.a.createElement(g.a,{id:"user.settings.security.office365",defaultMessage:"Office 365"}):this.props.user.auth_service===h.Z.LDAP_SERVICE?t=l.a.createElement(g.a,{id:"user.settings.security.ldap",defaultMessage:"AD/LDAP"}):this.props.user.auth_service===h.Z.SAML_SERVICE&&(t=l.a.createElement(g.a,{id:"user.settings.security.saml",defaultMessage:"SAML"})),l.a.createElement(S.a,{title:b.ob("user.settings.security.method","Sign-in Method"),describe:t,section:"signin",updateSection:this.handleUpdateSection})}),Dt(this,"createOAuthAppsSection",()=>{if("apps"===this.props.activeSection){let e;e=this.state.authorizedApps&&this.state.authorizedApps.length>0?this.state.authorizedApps.map(e=>{const t=l.a.createElement("a",{href:e.homepage,target:"_blank",rel:"noopener noreferrer"},e.homepage);return l.a.createElement("div",{key:e.id,className:"pb-3 authorized-app"},l.a.createElement("div",{className:"col-sm-10"},l.a.createElement("div",{className:"authorized-app__name"},e.name,l.a.createElement("span",{className:"authorized-app__url"}," -"," ",t)),l.a.createElement("div",{className:"authorized-app__description"},e.description),l.a.createElement("div",{className:"authorized-app__deauthorize"},l.a.createElement("a",{href:"#","data-app":e.id,onClick:this.deauthorizeApp},l.a.createElement(g.a,{id:"user.settings.security.deauthorize",defaultMessage:"Deauthorize"})))),l.a.createElement("div",{className:"col-sm-2 pull-right"},l.a.createElement("img",{alt:e.name,src:e.icon_url||dt.a})),l.a.createElement("br",null))}):l.a.createElement("div",{className:"pb-3 authorized-app"},l.a.createElement("div",{className:"setting-list__hint"},l.a.createElement(g.a,{id:"user.settings.security.noApps",defaultMessage:"No OAuth 2.0 Applications are authorized."})));const t=[];let a,s;Array.isArray(e)&&(a="authorized-apps__wrapper",s=l.a.createElement("div",{className:"authorized-apps__help"},l.a.createElement(g.a,{id:"user.settings.security.oauthAppsHelp",defaultMessage:"Applications act on your behalf to access your data based on the permissions you grant them."}))),t.push(l.a.createElement("div",{className:a,key:"authorizedApps"},e));const i=l.a.createElement("div",null,l.a.createElement(g.a,{id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),s);return l.a.createElement(v.a,{title:i,inputs:t,serverError:this.state.serverError,updateSection:this.handleUpdateSection,width:"full",cancelButtonText:l.a.createElement(g.a,{id:"user.settings.security.close",defaultMessage:"Close"})})}return l.a.createElement(S.a,{title:b.ob("user.settings.security.oauthApps","OAuth 2.0 Applications"),describe:l.a.createElement(g.a,{id:"user.settings.security.oauthAppsDescription",defaultMessage:"Click 'Edit' to manage your OAuth 2.0 Applications"}),section:"apps",updateSection:this.handleUpdateSection})}),this.state=this.getDefaultState()}getDefaultState(){return{currentPassword:"",newPassword:"",confirmPassword:"",passwordError:"",serverError:"",tokenError:"",authService:this.props.user.auth_service,savingPassword:!1,authorizedApps:[]}}componentDidMount(){this.props.enableOAuthServiceProvider&&this.loadAuthorizedOAuthApps()}render(){const e=this.props.user,t=this.createPasswordSection();let a,s,i,n=0;return n=this.props.enableSignUpWithGitLab?n+1:n,n=this.props.enableSignUpWithGoogle?n+1:n,n=this.props.enableSignUpWithOffice365?n+1:n,n=this.props.enableLdap?n+1:n,n=this.props.enableSaml?n+1:n,(this.props.enableSignUpWithEmail||""===e.auth_service)&&n>0&&this.props.experimentalEnableAuthenticationTransfer&&(a=this.createSignInSection()),this.props.enableOAuthServiceProvider&&(s=this.createOAuthAppsSection()),this.props.canUseAccessTokens&&(i=l.a.createElement(jt,{user:this.props.user,active:"tokens"===this.props.activeSection,updateSection:this.handleUpdateSection,setRequireConfirm:this.props.setRequireConfirm})),l.a.createElement("div",null,l.a.createElement("div",{className:"modal-header"},l.a.createElement(g.a,{id:"user.settings.security.close",defaultMessage:"Close"},e=>l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":e,onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×"))),l.a.createElement("h4",{className:"modal-title",ref:"title"},l.a.createElement("div",{className:"modal-back"},l.a.createElement(g.a,{id:"generic_icons.collapse",defaultMessage:"Collapse Icon"},e=>l.a.createElement("i",{className:"fa fa-angle-left",title:e,onClick:this.props.collapseModal}))),l.a.createElement(g.a,{id:"user.settings.security.title",defaultMessage:"Security Settings"}))),l.a.createElement("div",{className:"user-settings"},l.a.createElement("h3",{className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.security.title",defaultMessage:"Security Settings"})),l.a.createElement("div",{className:"divider-dark first"}),t,l.a.createElement("div",{className:"divider-light"}),l.a.createElement(Tt,{active:"mfa"===this.props.activeSection,updateSection:this.handleUpdateSection}),l.a.createElement("div",{className:"divider-light"}),s,l.a.createElement("div",{className:"divider-light"}),i,l.a.createElement("div",{className:"divider-light"}),a,l.a.createElement("div",{className:"divider-dark"}),l.a.createElement("br",null),l.a.createElement(Mt.a,{className:"security-links color--link",dialogType:ft,id:"viewAccessHistory"},l.a.createElement(g.a,{id:"user.settings.security.viewHistory.icon",defaultMessage:"Access History Icon"},e=>l.a.createElement("i",{className:"fa fa-clock-o",title:e})),l.a.createElement(g.a,{id:"user.settings.security.viewHistory",defaultMessage:"View Access History"})),l.a.createElement(Mt.a,{className:"security-links color--link mt-2",dialogType:Ot,id:"viewAndLogOutOfActiveSessions"},l.a.createElement(g.a,{id:"user.settings.security.logoutActiveSessions.icon",defaultMessage:"Active Sessions Icon"},e=>l.a.createElement("i",{className:"fa fa-clock-o",title:e})),l.a.createElement(g.a,{id:"user.settings.security.logoutActiveSessions",defaultMessage:"View and Log Out of Active Sessions"}))))}}Dt(Lt,"propTypes",{user:r.a.any.isRequired,activeSection:r.a.string,updateSection:r.a.func.isRequired,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired,setRequireConfirm:r.a.func.isRequired,canUseAccessTokens:r.a.bool.isRequired,enableOAuthServiceProvider:r.a.bool.isRequired,enableSignUpWithEmail:r.a.bool.isRequired,enableSignUpWithGitLab:r.a.bool.isRequired,enableSignUpWithGoogle:r.a.bool.isRequired,enableSignUpWithOpenId:r.a.bool.isRequired,enableLdap:r.a.bool.isRequired,enableSaml:r.a.bool.isRequired,enableSignUpWithOffice365:r.a.bool.isRequired,experimentalEnableAuthenticationTransfer:r.a.bool.isRequired,passwordConfig:r.a.any.isRequired,militaryTime:r.a.bool.isRequired,actions:r.a.shape({getMe:r.a.func.isRequired,updateUserPassword:r.a.func.isRequired,getAuthorizedOAuthApps:r.a.func.isRequired,deauthorizeOAuthApp:r.a.func.isRequired}).isRequired});var Ut,xt=Object(s.connect)((function(e,t){const a=Object(d.getConfig)(e),s="true"===a.EnableUserAccessTokens,i=lt.hasUserAccessTokenRole(t.user.roles)||lt.isSystemAdmin(t.user.roles);return{canUseAccessTokens:s&&i,enableOAuthServiceProvider:"true"===a.EnableOAuthServiceProvider,enableSignUpWithEmail:"true"===a.EnableSignUpWithEmail,enableSignUpWithGitLab:"true"===a.EnableSignUpWithGitLab,enableSignUpWithGoogle:"true"===a.EnableSignUpWithGoogle,enableSignUpWithOpenId:"true"===a.EnableSignUpWithOpenId,enableLdap:"true"===a.EnableLdap,enableSaml:"true"===a.EnableSaml,enableSignUpWithOffice365:"true"===a.EnableSignUpWithOffice365,experimentalEnableAuthenticationTransfer:"true"===a.ExperimentalEnableAuthenticationTransfer,passwordConfig:Object(b.H)(a),militaryTime:Object(u.getBool)(e,h.F.CATEGORY_DISPLAY_SETTINGS,h.F.USE_MILITARY_TIME,!1)}}),(function(e){return{actions:Object(c.bindActionCreators)({getMe:p.getMe,updateUserPassword:p.updateUserPassword,getAuthorizedOAuthApps:ot.getAuthorizedOAuthApps,deauthorizeOAuthApp:ot.deauthorizeOAuthApp},e)}}))(Lt);function Ft(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,s)}return a}function qt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(a),!0).forEach((function(t){zt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ft(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function zt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){e.CloseUnusedDirectMessages="close_unused_direct_messages",e.ChannelSwitcherSection="channel_switcher_section",e.ChannelSidebarOrganization="channel_sidebar_organization",e.Grouping="grouping",e.UnreadsAtTop="unreadsAtTop",e.FavoriteAtTop="favoriteAtTop",e.Sorting="sorting",e.NewSidebar="newSidebar",e.ChannelGrouping="channel_grouping",e.ChannelSorting="channel_sorting"}(Ut||(Ut={}));class Gt extends l.a.PureComponent{constructor(e){super(e),zt(this,"getStateFromProps",()=>{const{closeUnusedDirectMessages:e,channelSwitcherOption:t,channelSidebarOrganizationOption:a,sidebarPreference:{grouping:s,sorting:i},unreadsAtTop:n,favoriteAtTop:r}=this.props;return{settings:{close_unused_direct_messages:e,channel_switcher_section:t,channel_sidebar_organization:a,grouping:s,unreadsAtTop:n,favoriteAtTop:r,sorting:i},isSaving:!1}}),zt(this,"handleSubmit",e=>{const{actions:t,user:a}=this.props,s=[];if(e===Ut.ChannelGrouping||e===Ut.ChannelSorting){const e={grouping:this.state.settings.grouping,unreads_at_top:this.state.settings.unreadsAtTop,favorite_at_top:this.state.settings.favoriteAtTop,sorting:this.state.settings.sorting};s.push({user_id:a.id,category:h.Z.Preferences.CATEGORY_SIDEBAR_SETTINGS,name:"",value:JSON.stringify(e)}),this.trackSettingChangeIfNecessary(Ut.Grouping),this.trackSettingChangeIfNecessary(Ut.Sorting),this.trackSettingChangeIfNecessary(Ut.UnreadsAtTop),this.trackSettingChangeIfNecessary(Ut.FavoriteAtTop),this.trackSettingChangeIfNecessary(Ut.NewSidebar)}else s.push({user_id:a.id,category:h.Z.Preferences.CATEGORY_SIDEBAR_SETTINGS,name:e,value:this.state.settings[e]}),Object(Le.e)("settings","user_settings_update",{field:"sidebar."+e,value:this.state.settings[e]});this.setState({isSaving:!0}),t.savePreferences(a.id,s).then(()=>{this.updateSection("")})}),zt(this,"getPreviousSection",e=>{const{showChannelOrganization:t,channelSidebarOrganizationOption:a}=this.props;switch(e){case"autoCloseDM":return"true"===a?"channelSidebarOrganization":"channelSwitcher";case"groupChannels":case"channelSidebarOrganization":return"dummySectionName";case"channelSwitcher":return t?"groupChannels":"dummySectionName";default:return null}}),zt(this,"updateSection",e=>{this.props.updateSection&&(this.setState(this.getStateFromProps()),this.setState({isSaving:!1}),this.props.updateSection(e))}),zt(this,"renderAutoCloseDMLabel",e=>"after_seven_days"===e?l.a.createElement(g.a,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"}):l.a.createElement(g.a,{id:"user.settings.sidebar.never",defaultMessage:"Never"})),zt(this,"renderAutoCloseDMSection",()=>{let e;return e="autoCloseDM"===this.props.activeSection?l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),inputs:[l.a.createElement("fieldset",{key:"autoCloseDMSetting"},l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"autoCloseDMAfterSevenDays",type:"radio",name:"autoCloseDM",checked:"after_seven_days"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,Ut.CloseUnusedDirectMessages,"after_seven_days")}),l.a.createElement(g.a,{id:"user.settings.sidebar.after_seven_days",defaultMessage:"After 7 days with no new messages"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"autoCloseDMNever",type:"radio",name:"autoCloseDM",checked:"never"===this.state.settings.close_unused_direct_messages,onChange:this.updateSetting.bind(this,Ut.CloseUnusedDirectMessages,"never")}),l.a.createElement(g.a,{id:"user.settings.sidebar.never",defaultMessage:"Never"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.sidebar.autoCloseDMDesc",defaultMessage:"Direct Message conversations can be reopened with the “+” button in the sidebar or using the Channel Switcher (CTRL+K)."})))],setting:"close_unused_direct_messages",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection}):l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.autoCloseDMTitle",defaultMessage:"Automatically Close Direct Messages"}),describe:this.renderAutoCloseDMLabel(this.state.settings.close_unused_direct_messages),section:"autoCloseDM",updateSection:this.updateSection}),l.a.createElement(l.a.Fragment,null,e,l.a.createElement("div",{className:"divider-dark"}))}),zt(this,"renderOrganizationLabel",()=>{const{sidebarPreference:{sorting:e,grouping:t},unreadsAtTop:a,favoriteAtTop:s}=this.props,i=[];let n,r;"by_type"===t?i.push(l.a.createElement(g.a,{key:"by_type",id:"user.settings.sidebar.groupByTypeShort",defaultMessage:"Group by channel type"})):i.push(l.a.createElement(g.a,{key:"none",id:"user.settings.sidebar.groupByNoneShort",defaultMessage:"No grouping"})),"alpha"===e?(n=Object(E.b)("user.settings.sidebar.sortAlphaShort"),r="sorted alphabetically"):(n=Object(E.b)("user.settings.sidebar.sortRecentShort"),r="sorted by recency"),i.push(l.a.createElement("span",{key:"comma"},", ")),i.push(l.a.createElement(g.a,{key:"sorting",id:n,defaultMessage:r}));let o=null,c=null;return"true"===a&&"false"===s?(o=Object(E.b)("user.settings.sidebar.unreadsShort"),c="Unreads grouped separately"):"false"===a&&"true"===s?(o=Object(E.b)("user.settings.sidebar.favoritesShort"),c="Favorites grouped separately"):"true"===a&&"true"===s&&(o=Object(E.b)("user.settings.sidebar.unreadsFavoritesShort"),c="Unreads and favorites grouped separately"),o&&(i.push(l.a.createElement("br",{key:"break"})),i.push(l.a.createElement(g.a,{key:"atTop",id:o,defaultMessage:c}))),i}),zt(this,"renderChannelSwitcherLabel",e=>"true"===e?l.a.createElement(g.a,{id:"user.settings.sidebar.on",defaultMessage:"On"}):l.a.createElement(g.a,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),zt(this,"renderChannelSidebarOrganizationSection",()=>{const e=l.a.createElement(Se.b,{id:Object(E.b)("user.settings.sidebar.channelSidebarOrganizationSection.desc"),defaultMessage:"When enabled, access experimental channel sidebar features, including collapsible sections and unreads filtering. [Learn more](!https://about.mattermost.com/default-sidebar/) or [give us feedback](!https://about.mattermost.com/default-sidebar-survey/)"});let t=l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:Object(E.b)("user.settings.sidebar.channelSidebarOrganizationSectionTitle"),defaultMessage:"Experimental Sidebar Features"}),describe:this.renderChannelSwitcherLabel(this.props.channelSidebarOrganizationOption),section:"channelSidebarOrganization",updateSection:this.updateSection});return"channelSidebarOrganization"===this.props.activeSection&&(t=l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:Object(E.b)("user.settings.sidebar.channelSidebarOrganizationSectionTitle"),defaultMessage:"Experimental Sidebar Features"}),inputs:[l.a.createElement("fieldset",{key:"channelSidebarOrganizationSectionSetting"},l.a.createElement("legend",{className:"form-legend hidden-label"},l.a.createElement(g.a,{id:Object(E.b)("user.settings.sidebar.channelSidebarOrganizationSectionTitle"),defaultMessage:"Experimental Sidebar Features"})),l.a.createElement("div",{id:"channelSidebarOrganizationRadioOn",className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"channelSidebarOrganizationSectionEnabled",type:"radio",name:"channelSidebarOrganization",checked:"true"===this.state.settings.channel_sidebar_organization,onChange:this.updateSetting.bind(this,Ut.ChannelSidebarOrganization,"true")}),l.a.createElement(g.a,{id:"user.settings.sidebar.on",defaultMessage:"On"})),l.a.createElement("br",null)),l.a.createElement("div",{id:"channelSidebarOrganizationRadioOff",className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"channelSidebarOrganizationSectionOff",type:"radio",name:"channelSidebarOrganization",checked:"false"===this.state.settings.channel_sidebar_organization,onChange:this.updateSetting.bind(this,Ut.ChannelSidebarOrganization,"false")}),l.a.createElement(g.a,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),l.a.createElement("br",null)),l.a.createElement("div",{id:"channelSidebarOrganizationelpText"},l.a.createElement("br",null),e))],setting:"channel_sidebar_organization",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection})),l.a.createElement(l.a.Fragment,null,t,l.a.createElement("div",{className:"divider-light"}))}),zt(this,"renderChannelOrganizationSection",()=>{const{grouping:e,sorting:t}=this.state.settings;let a;if("groupChannels"===this.props.activeSection){const s=[];s.push(l.a.createElement("fieldset",{key:"groupingSectionSetting"},l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.sidebar.groupChannelsTitle",defaultMessage:"Channel grouping"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"byTypeOption",type:"radio",name:"groupChannels",checked:"by_type"===e,onChange:this.updateSetting.bind(this,Ut.Grouping,"by_type")}),l.a.createElement(g.a,{id:"user.settings.sidebar.groupByType",defaultMessage:"Channels grouped by type"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"noneOption",type:"radio",name:"groupChannels",checked:"none"===e,onChange:this.updateSetting.bind(this,Ut.Grouping,"none")}),l.a.createElement(g.a,{id:"user.settings.sidebar.groupByNone",defaultMessage:"Combine all channel types"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.sidebar.groupDesc",defaultMessage:"Group channels by type, or combine all types into a list."})))),s.push(l.a.createElement("hr",{key:"sortingDivider"})),s.push(l.a.createElement("fieldset",{key:"sortingOptions"},l.a.createElement("legend",{className:"form-legend"},l.a.createElement(g.a,{id:"user.settings.sidebar.sortChannelsTitle",defaultMessage:"Channel sorting"})),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"recentSectionEnabled",type:"radio",name:"sortChannels",checked:"recent"===t,onChange:this.updateSetting.bind(this,Ut.Sorting,"recent")}),l.a.createElement(g.a,{id:"user.settings.sidebar.sortRecent",defaultMessage:"Recency"}))),l.a.createElement("div",{className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"alphaSectionEnabled",type:"radio",name:"sortChannels",checked:"alpha"===t,onChange:this.updateSetting.bind(this,Ut.Sorting,"alpha")}),l.a.createElement(g.a,{id:"user.settings.sidebar.sortAlpha",defaultMessage:"Alphabetically"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.sidebar.sortDesc",defaultMessage:"Sort channels alphabetically, or by most recent post."})))),s.push(l.a.createElement("hr",{key:"divider"})),s.push(l.a.createElement("fieldset",{key:"unreadOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"unreadAtTopOption",type:"checkbox",checked:"true"===this.state.settings.unreadsAtTop,onChange:e=>this.updateSetting(Ut.UnreadsAtTop,e.target.checked.toString())}),l.a.createElement(g.a,{id:"user.settings.sidebar.unreads",defaultMessage:"Unreads grouped separately"}))),l.a.createElement("div",{className:"mt-5"},l.a.createElement(g.a,{id:"user.settings.sidebar.unreadsDesc",defaultMessage:"Group unread channels separately until read."})))),s.push(l.a.createElement("hr",{key:"groupingDivider"})),s.push(l.a.createElement("fieldset",{key:"favoriteOption"},l.a.createElement("div",{className:"checkbox"},l.a.createElement("label",null,l.a.createElement("input",{id:"favoriteAtTopOption",type:"checkbox",checked:"true"===this.state.settings.favoriteAtTop,onChange:e=>this.updateSetting(Ut.FavoriteAtTop,e.target.checked.toString())}),l.a.createElement(g.a,{id:"user.settings.sidebar.favorites",defaultMessage:"Favorites grouped separately"}))),l.a.createElement("div",null,l.a.createElement("br",null),l.a.createElement(g.a,{id:"user.settings.sidebar.favoritesDesc",defaultMessage:"Channels marked as favorites will be grouped separately."})))),a=l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.groupAndSortChannelsTitle",defaultMessage:"Channel Grouping and Sorting"}),inputs:s,setting:"channel_grouping",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection})}else a=l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.groupAndSortChannelsTitle",defaultMessage:"Channel Grouping and Sorting"}),describe:this.renderOrganizationLabel(),section:"groupChannels",updateSection:this.updateSection});return l.a.createElement(l.a.Fragment,null,a,l.a.createElement("div",{className:"divider-light"}))}),zt(this,"renderChannelSwitcherSection",()=>{let e=Object(E.b)("user.settings.sidebar.channelSwitcherSectionDesc.windows"),t="The channel switcher is shown at the bottom of the sidebar and is used to jump between channels quickly. It can also be accessed using CTRL + K.";Object(b.eb)()&&(e=Object(E.b)("user.settings.sidebar.channelSwitcherSectionDesc.mac"),t="The channel switcher is shown at the bottom of the sidebar and is used to jump between channels quickly. It can also be accessed using CMD + K.");const a=l.a.createElement(g.a,{id:e,defaultMessage:t});return"channelSwitcher"===this.props.activeSection?l.a.createElement(v.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"}),inputs:[l.a.createElement("fieldset",{key:"channelSwitcherSectionSetting"},l.a.createElement("legend",{className:"form-legend hidden-label"},l.a.createElement(g.a,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"})),l.a.createElement("div",{id:"channelSwitcherRadioOn",className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"channelSwitcherSectionEnabled",type:"radio",name:"channelSwitcher",checked:"true"===this.state.settings.channel_switcher_section,onChange:this.updateSetting.bind(this,Ut.ChannelSwitcherSection,"true")}),l.a.createElement(g.a,{id:"user.settings.sidebar.on",defaultMessage:"On"})),l.a.createElement("br",null)),l.a.createElement("div",{id:"channelSwitcherRadioOff",className:"radio"},l.a.createElement("label",null,l.a.createElement("input",{id:"channelSwitcherSectionOff",type:"radio",name:"channelSwitcher",checked:"false"===this.state.settings.channel_switcher_section,onChange:this.updateSetting.bind(this,Ut.ChannelSwitcherSection,"false")}),l.a.createElement(g.a,{id:"user.settings.sidebar.off",defaultMessage:"Off"})),l.a.createElement("br",null)),l.a.createElement("div",{id:"channelSwitcherHelpText"},l.a.createElement("br",null),a))],setting:"channel_switcher_section",submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:this.updateSection}):l.a.createElement(S.a,{title:l.a.createElement(g.a,{id:"user.settings.sidebar.channelSwitcherSectionTitle",defaultMessage:"Channel Switcher"}),describe:this.renderChannelSwitcherLabel(this.props.channelSwitcherOption),section:"channelSwitcher",updateSection:this.updateSection})}),this.state=this.getStateFromProps()}trackSettingChangeIfNecessary(e){this.state.settings[e]!==this.props.sidebarPreference[e]&&Object(Le.e)("settings","user_settings_update",{field:"sidebar."+e,value:this.state.settings[e]})}updateSetting(e,t){const a=qt(qt({},this.state.settings),{},{[e]:t});this.setState(qt(qt({},this.state),{},{settings:a}))}render(){const{showUnusedOption:e,showChannelOrganization:t,showChannelSidebarOrganization:a,channelSidebarOrganizationOption:s}=this.props,i="false"===s,n=t&&i?this.renderChannelOrganizationSection():null,r=a?this.renderChannelSidebarOrganizationSection():null,o=e?this.renderAutoCloseDMSection():null,c=i?this.renderChannelSwitcherSection():null;return l.a.createElement("div",null,l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},l.a.createElement("span",{"aria-hidden":"true"},"×")),l.a.createElement("h4",{className:"modal-title",ref:"title"},l.a.createElement("div",{className:"modal-back",onClick:this.props.collapseModal},l.a.createElement(H.a,{className:"fa fa-angle-left",title:{id:Object(E.b)("generic_icons.collapse"),defaultMessage:"Collapse Icon"}})),l.a.createElement(g.a,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"}))),l.a.createElement("div",{id:"sidebarTitle",className:"user-settings"},l.a.createElement("h3",{className:"tab-header"},l.a.createElement(g.a,{id:"user.settings.sidebar.title",defaultMessage:"Sidebar Settings"})),l.a.createElement("div",{className:"divider-dark first"}),r,n,c,e?l.a.createElement("div",{className:"divider-light"}):l.a.createElement("div",{className:"divider-dark"}),o))}}zt(Gt,"propTypes",{actions:r.a.shape({savePreferences:r.a.func.isRequired}).isRequired,user:r.a.any.isRequired,closeUnusedDirectMessages:r.a.string.isRequired,showUnusedOption:r.a.bool.isRequired,showChannelOrganization:r.a.bool.isRequired,showChannelSidebarOrganization:r.a.bool.isRequired,channelSwitcherOption:r.a.string.isRequired,channelSidebarOrganizationOption:r.a.string.isRequired,sidebarPreference:r.a.any.isRequired,unreadsAtTop:r.a.string.isRequired,favoriteAtTop:r.a.string.isRequired,updateSection:r.a.func,activeSection:r.a.string,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired});var Bt,Vt,Ht,Yt=Object(s.connect)((function(e){const t=Object(d.getConfig)(e),a=Object(u.get)(e,O.Preferences.CATEGORY_SIDEBAR_SETTINGS,"close_unused_direct_messages","after_seven_days"),s=Object(u.get)(e,O.Preferences.CATEGORY_SIDEBAR_SETTINGS,"channel_switcher_section","true"),n=Object(u.getNewSidebarPreference)(e),r=Object(u.getSidebarPreferences)(e);return{closeUnusedDirectMessages:a,sidebarPreference:r,unreadsAtTop:r.unreads_at_top,favoriteAtTop:r.favorite_at_top,channelSwitcherOption:s,channelSidebarOrganizationOption:String(n),showChannelOrganization:"true"===t.ExperimentalChannelOrganization,showChannelSidebarOrganization:"disabled"!==t.ExperimentalChannelSidebarOrganization&&"always_on"!==t.ExperimentalChannelSidebarOrganization,showUnusedOption:"true"===t.CloseUnusedDirectMessages,user:Object(i.getCurrentUser)(e)}}),(function(e){return{actions:Object(c.bindActionCreators)({savePreferences:m.savePreferences},e)}}))(Gt);class Wt extends l.a.PureComponent{render(){return"general"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(Be,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"security"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(xt,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setRequireConfirm:this.props.setRequireConfirm})):"notifications"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(rt,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"display"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(Pe,{user:this.props.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus,setRequireConfirm:this.props.setRequireConfirm})):"sidebar"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(Yt,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"advanced"===this.props.activeTab?l.a.createElement("div",null,l.a.createElement(w,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):l.a.createElement("div",null)}}Bt=Wt,Vt="propTypes",Ht={user:r.a.any.isRequired,activeTab:r.a.string,activeSection:r.a.string,updateSection:r.a.func.isRequired,updateTab:r.a.func.isRequired,closeModal:r.a.func.isRequired,collapseModal:r.a.func.isRequired,setEnforceFocus:r.a.func.isRequired,setRequireConfirm:r.a.func.isRequired},Vt in Bt?Object.defineProperty(Bt,Vt,{value:Ht,enumerable:!0,configurable:!0,writable:!0}):Bt[Vt]=Ht;t.default=Object(s.connect)((function(e){return{user:Object(i.getCurrentUser)(e)}}))(Wt)}}]);
//# sourceMappingURL=12.8347d811fba26e41c0c6.js.map